---
title: 'CA2101: укажите тип маршалинга для строковых аргументов P/Invoke (анализ кода)'
description: Дополнительные сведения о правиле анализа кода CA2101 — укажите тип маршалинга для строковых аргументов P/Invoke
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- SpecifyMarshalingForPInvokeStringArguments
- CA2101
helpviewer_keywords:
- CA2101
- SpecifyMarshalingForPInvokeStringArguments
author: gewarren
ms.author: gewarren
ms.openlocfilehash: bfd28fef3fabfde9cf81b3dab06a5438409f300d
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99630752"
---
# <a name="ca2101-specify-marshaling-for-pinvoke-string-arguments"></a>CA2101: укажите тип маршалинга для строковых аргументов P/Invoke

| | Значение |
|-|-|
| **Идентификатор правила** |CA2101|
| **Категория** |[Глобализация](globalization-warnings.md)|
| **Исправление является критическим или не критическим** |Не критическое|

## <a name="cause"></a>Причина

Элемент вызова неуправляемого кода, разрешающий вызовы с частичным доверием, содержит строковый параметр и не выполняет явное маршалирование этой строки.

## <a name="rule-description"></a>Описание правила

При преобразовании из Юникода в ANSI, возможно, не все символы Юникода могут быть представлены в определенной кодовой странице ANSI. *Наилучшее сопоставление* пытается решить эту проблему, заменяя символы, которые не могут быть представлены. Использование этой функции может привести к потенциальной уязвимости системы безопасности, поскольку вы не можете контролировать выбор символа. Например, вредоносный код может намеренно создать строку в Юникоде, содержащую символы, которых нет на определенной кодовой странице и которые преобразуются в специальные символы файловой системы, такие как ".." или "/". Проверки безопасности для специальных символов часто происходят перед преобразованием строки в ANSI.

Для неуправляемого преобразования по умолчанию, WChar в MByte, используется наилучшее соответствие. Если явно не отключить функцию наилучшего соответствия, код может содержать уязвимость системы безопасности, которую сможет использовать злоумышленник.

> [!CAUTION]
> [Управление доступом для кода](../../../framework/misc/code-access-security.md) (CAS) не следует применять в качестве границы безопасности.

## <a name="how-to-fix-violations"></a>Устранение нарушений

Чтобы устранить нарушение этого правила, следует явно маршалировать строковые типы данных.

## <a name="when-to-suppress-warnings"></a>Условия для отключения предупреждений

Для этого правила отключать вывод предупреждений не следует.

## <a name="example"></a>Пример

В следующем примере показан метод, нарушающий это правило, а затем показано, как устранить нарушение.

:::code language="csharp" source="snippets/csharp/all-rules/ca2101.cs" id="snippet1":::
