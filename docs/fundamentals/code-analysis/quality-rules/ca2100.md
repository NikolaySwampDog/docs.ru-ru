---
title: 'CA2100: проверьте запросы SQL на наличие уязвимостей системы безопасности (анализ кода)'
description: Узнайте больше о правиле CA2100 — проверьте запросы SQL на наличие уязвимостей системы безопасности
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- Review SQL queries for security vulnerabilities
- ReviewSqlQueriesForSecurityVulnerabilities
- CA2100
helpviewer_keywords:
- CA2100
- ReviewSqlQueriesForSecurityVulnerabilities
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 1ffdb8a791f391e113dcc1210ba7d2ee69c80a32
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99667126"
---
# <a name="ca2100-review-sql-queries-for-security-vulnerabilities"></a><span data-ttu-id="549fc-103">CA2100. Проверьте запросы SQL на наличие уязвимостей системы безопасности</span><span class="sxs-lookup"><span data-stu-id="549fc-103">CA2100: Review SQL queries for security vulnerabilities</span></span>

| | <span data-ttu-id="549fc-104">Значение</span><span class="sxs-lookup"><span data-stu-id="549fc-104">Value</span></span> |
|-|-|
| <span data-ttu-id="549fc-105">**Идентификатор правила**</span><span class="sxs-lookup"><span data-stu-id="549fc-105">**Rule ID**</span></span> |<span data-ttu-id="549fc-106">CA2100</span><span class="sxs-lookup"><span data-stu-id="549fc-106">CA2100</span></span>|
| <span data-ttu-id="549fc-107">**Категория**</span><span class="sxs-lookup"><span data-stu-id="549fc-107">**Category**</span></span> |[<span data-ttu-id="549fc-108">Безопасность</span><span class="sxs-lookup"><span data-stu-id="549fc-108">Security</span></span>](security-warnings.md)|
| <span data-ttu-id="549fc-109">**Исправление является критическим или не критическим**</span><span class="sxs-lookup"><span data-stu-id="549fc-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="549fc-110">Не критическое</span><span class="sxs-lookup"><span data-stu-id="549fc-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="549fc-111">Причина</span><span class="sxs-lookup"><span data-stu-id="549fc-111">Cause</span></span>

<span data-ttu-id="549fc-112">Метод задает свойство <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> с использованием строки, созданной из строкового аргумента метода.</span><span class="sxs-lookup"><span data-stu-id="549fc-112">A method sets the <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> property by using a string that is built from a string argument to the method.</span></span>

<span data-ttu-id="549fc-113">По умолчанию это правило анализирует всю базу кода, но такое поведение [можно настроить](#configure-code-to-analyze).</span><span class="sxs-lookup"><span data-stu-id="549fc-113">By default, this rule analyzes the entire codebase, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="549fc-114">Описание правила</span><span class="sxs-lookup"><span data-stu-id="549fc-114">Rule description</span></span>

<span data-ttu-id="549fc-115">Это правило предполагает, что любая строка, значение которой не может быть определено во время компиляции, может содержать данные, вводимые пользователем.</span><span class="sxs-lookup"><span data-stu-id="549fc-115">This rule assumes that any string, whose value can't be determined at compile time, may contain user input.</span></span> <span data-ttu-id="549fc-116">Созданная из введенных пользователем данных командная строка SQL уязвима перед атаками путем внедрения кода SQL.</span><span class="sxs-lookup"><span data-stu-id="549fc-116">A SQL command string that is built from user input is vulnerable to SQL injection attacks.</span></span> <span data-ttu-id="549fc-117">При атаке путем внедрения кода SQL злоумышленник предоставляет входные данные, которые изменяют структуру запроса при попытке нанести вред или получить несанкционированный доступ к основной базе данных.</span><span class="sxs-lookup"><span data-stu-id="549fc-117">In a SQL injection attack, a malicious user supplies input that alters the design of a query in an attempt to damage or gain unauthorized access to the underlying database.</span></span> <span data-ttu-id="549fc-118">Типичные методы включают в себя введение одинарной кавычки или апострофа, который является разделителем строк для литерала SQL; двух тире, обозначающих комментарий SQL; и точки с запятой, которая указывает на новую команду.</span><span class="sxs-lookup"><span data-stu-id="549fc-118">Typical techniques include injection of a single quotation mark or apostrophe, which is the SQL literal string delimiter; two dashes, which signifies a SQL comment; and a semicolon, which indicates that a new command follows.</span></span> <span data-ttu-id="549fc-119">Если входные данные пользователя должны быть частью запроса, используйте один из следующих методов, перечисленных в порядке эффективности, чтобы снизить риск атаки.</span><span class="sxs-lookup"><span data-stu-id="549fc-119">If user input must be part of the query, use one of the following, listed in order of effectiveness, to reduce the risk of attack.</span></span>

- <span data-ttu-id="549fc-120">Использование хранимой процедуры.</span><span class="sxs-lookup"><span data-stu-id="549fc-120">Use a stored procedure.</span></span>

- <span data-ttu-id="549fc-121">Использование параметризованной командной строки.</span><span class="sxs-lookup"><span data-stu-id="549fc-121">Use a parameterized command string.</span></span>

- <span data-ttu-id="549fc-122">Проверка данных, введенных пользователем, на предмет типа и содержимого перед сборкой командной строки.</span><span class="sxs-lookup"><span data-stu-id="549fc-122">Validate the user input for both type and content before you build the command string.</span></span>

<span data-ttu-id="549fc-123">Следующие типы .NET реализуют свойство <xref:System.Data.IDbCommand.CommandText%2A> или предоставляют конструкторы, которые устанавливают свойство с помощью строкового аргумента.</span><span class="sxs-lookup"><span data-stu-id="549fc-123">The following .NET types implement the <xref:System.Data.IDbCommand.CommandText%2A> property or provide constructors that set the property by using a string argument.</span></span>

- <span data-ttu-id="549fc-124"><xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> и <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="549fc-124"><xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> and <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName></span></span>

- <span data-ttu-id="549fc-125"><xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> и <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="549fc-125"><xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> and <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName></span></span>

- <span data-ttu-id="549fc-126"><xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> и <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="549fc-126"><xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> and <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName></span></span>

- <span data-ttu-id="549fc-127"><xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> и <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="549fc-127"><xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> and <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName></span></span>

<span data-ttu-id="549fc-128">В некоторых случаях это правило может не определять значение строки во время компиляции, даже если это возможно.</span><span class="sxs-lookup"><span data-stu-id="549fc-128">In some cases, this rule might not determine a string's value at compile time, even though you can.</span></span> <span data-ttu-id="549fc-129">В этих случаях это правило создает ложноположительный результат при использовании этих строк в качестве команд SQL.</span><span class="sxs-lookup"><span data-stu-id="549fc-129">In those cases, this rule produces false positives when using those strings as SQL commands.</span></span> <span data-ttu-id="549fc-130">Ниже приводится пример подобной строки.</span><span class="sxs-lookup"><span data-stu-id="549fc-130">The following is an example of such a string.</span></span>

```csharp
int x = 10;
string query = "SELECT TOP " + x.ToString() + " FROM Table";
```

<span data-ttu-id="549fc-131">То же самое применяется при неявном использовании `ToString()`.</span><span class="sxs-lookup"><span data-stu-id="549fc-131">The same applies when using `ToString()` implicitly.</span></span>

```csharp
int x = 10;
string query = String.Format("SELECT TOP {0} FROM Table", x);
```

## <a name="how-to-fix-violations"></a><span data-ttu-id="549fc-132">Устранение нарушений</span><span class="sxs-lookup"><span data-stu-id="549fc-132">How to fix violations</span></span>

<span data-ttu-id="549fc-133">Чтобы устранить нарушение этого правила, используйте параметризованный запрос.</span><span class="sxs-lookup"><span data-stu-id="549fc-133">To fix a violation of this rule, use a parameterized query.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="549fc-134">Условия для отключения предупреждений</span><span class="sxs-lookup"><span data-stu-id="549fc-134">When to suppress warnings</span></span>

<span data-ttu-id="549fc-135">Вы можете отключить предупреждение этого правила, если текст команды не содержит данных, введенных пользователем.</span><span class="sxs-lookup"><span data-stu-id="549fc-135">It is safe to suppress a warning from this rule if the command text does not contain any user input.</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="549fc-136">Настройка кода для анализа</span><span class="sxs-lookup"><span data-stu-id="549fc-136">Configure code to analyze</span></span>

<span data-ttu-id="549fc-137">Используйте следующие параметры, чтобы указать части базы кода, к которым будет применяться это правило.</span><span class="sxs-lookup"><span data-stu-id="549fc-137">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="549fc-138">Исключить определенные символы</span><span class="sxs-lookup"><span data-stu-id="549fc-138">Exclude specific symbols</span></span>](#exclude-specific-symbols)
- [<span data-ttu-id="549fc-139">Исключить определенные типы и их производные типы</span><span class="sxs-lookup"><span data-stu-id="549fc-139">Exclude specific types and their derived types</span></span>](#exclude-specific-types-and-their-derived-types)

<span data-ttu-id="549fc-140">Эти параметры можно настроить только для указанного правила, для всех правил или для всех правил в этой категории ([безопасность](security-warnings.md)).</span><span class="sxs-lookup"><span data-stu-id="549fc-140">You can configure these options for just this rule, for all rules, or for all rules in this category ([Security](security-warnings.md)).</span></span> <span data-ttu-id="549fc-141">Дополнительные сведения см. в статье [Параметры конфигурации правила качества кода](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="549fc-141">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

[!INCLUDE[excluded-symbol-names](~/includes/code-analysis/excluded-symbol-names.md)]

[!INCLUDE[excluded-type-names-with-derived-types](~/includes/code-analysis/excluded-type-names-with-derived-types.md)]

## <a name="example"></a><span data-ttu-id="549fc-142">Пример</span><span class="sxs-lookup"><span data-stu-id="549fc-142">Example</span></span>

<span data-ttu-id="549fc-143">В следующем примере показан метод `UnsafeQuery`, который нарушает правило, и метод `SaferQuery`, который соблюдает правило с помощью параметризованной командной строки.</span><span class="sxs-lookup"><span data-stu-id="549fc-143">The following example shows a method, `UnsafeQuery`, that violates the rule and a method, `SaferQuery`, that satisfies the rule by using a parameterized command string.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca2100-review-sql-queries-for-security-vulnerabilities_1.vb":::

:::code language="csharp" source="snippets/csharp/all-rules/ca2100.cs" id="snippet1":::

## <a name="see-also"></a><span data-ttu-id="549fc-144">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="549fc-144">See also</span></span>

- [<span data-ttu-id="549fc-145">Общие сведения о безопасности</span><span class="sxs-lookup"><span data-stu-id="549fc-145">Security Overview</span></span>](../../../framework/data/adonet/security-overview.md)
