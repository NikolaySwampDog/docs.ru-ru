---
title: 'CA1810: инициализируйте статические поля ссылочных типов при объявлении (анализ кода)'
description: 'Сведения о правиле анализа кода CA1810: инициализируйте статические поля ссылочных типов при объявлении'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- InitializeReferenceTypeStaticFieldsInline
- CA1810
helpviewer_keywords:
- InitializeReferenceTypeStaticFieldsInline
- CA1810
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: f7234bf9c6941b25984d3b0e2cf3e4d31216d5ad
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99776895"
---
# <a name="ca1810-initialize-reference-type-static-fields-inline"></a>CA1810. Инициализируйте статические поля ссылочных типов при объявлении

| | Значение |
|-|-|
| **Идентификатор правила** |CA1810|
| **Категория** |[Производительность](performance-warnings.md)|
| **Исправление является критическим или не критическим** |Не критическое|

## <a name="cause"></a>Причина

Ссылочный тип объявляет явный статический конструктор.

## <a name="rule-description"></a>Описание правила

Если в типе объявляется явный статический конструктор, компилятор JIT добавляет проверку в каждый статический метод и конструктор экземпляров этого типа, чтобы убедиться, что статический конструктор уже вызывался ранее. Статическая инициализация активируется при доступе к любому статическому элементу или при создании экземпляра типа. Однако статическая инициализация не запускается, если объявить переменную типа, но не использовать ее, что может быть важно, если инициализация меняет глобальное состояние.

Когда все статические данные инициализируются встроенным образом и явный статический конструктор не объявлен, компиляторы MSIL добавляют флаг `beforefieldinit` и неявный статический конструктор, который инициализирует статические данные с определением типа MSIL. Когда JIT-компилятор обнаруживает флаг `beforefieldinit`, в большинстве случаев проверки статических конструкторов не добавляются. Статическая инициализация будет гарантированно выполняться в определенный момент перед обращением к статическим полям, но не до вызова статического метода или конструктора экземпляра. Обратите внимание, что статическая инициализация может произойти в любое время после объявления переменной типа.

Проверки статических конструкторов могут привести к снижению производительности. Часто статический конструктор используется только для инициализации статических полей. В этом случае необходимо лишь убедиться, что статическая инициализация выполняется перед первым доступом к статическому полю. Поведение `beforefieldinit` подходит для этих и большинства других типов. Оно неприемлемо, только если статическая инициализация влияет на глобальное состояние, и одно из следующих условий верно:

- Воздействие на глобальное состояние является дорогостоящим и не требуется, если тип не используется.

- Доступ к эффектам глобального состояния возможен без доступа к любым статическим полям типа.

## <a name="how-to-fix-violations"></a>Устранение нарушений

Чтобы устранить нарушение данного правила, выполните инициализацию всех статических данных при их объявлении и удалите статический конструктор.

## <a name="when-to-suppress-warnings"></a>Условия для отключения предупреждений

Для этого правила можно скрыть предупреждения, если производительность не является проблемой либо изменения глобального состояния, вызванные статической инициализацией, дорогостоящи или должны быть гарантированно выполнены до вызова статического метода типа или создания экземпляра типа.

## <a name="example"></a>Пример

В следующем примере показаны тип `StaticConstructor`, который нарушает правило, и тип `NoStaticConstructor`, который заменяет статический конструктор встроенной инициализацией для выполнения этого правила.

:::code language="csharp" source="snippets/csharp/all-rules/ca1810.cs" id="snippet1":::

:::code language="vb" source="snippets/vb/all-rules/ca1810-initialize-reference-type-static-fields-inline_1.vb":::

Обратите внимание на добавление флага `beforefieldinit` в определении MSIL для класса `NoStaticConstructor`.

```il
.class public auto ansi StaticConstructor
extends [mscorlib]System.Object
{
} // end of class StaticConstructor

.class public auto ansi beforefieldinit NoStaticConstructor
extends [mscorlib]System.Object
{
} // end of class NoStaticConstructor
```

## <a name="related-rules"></a>Связанные правила

- [CA2207. Используйте встроенную инициализацию статических полей типов значений](ca2207.md)
