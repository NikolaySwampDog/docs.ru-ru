---
title: 'CA1021: не используйте параметры out (анализ кода)'
description: 'Сведения о правиле анализа кода CA1021: не используйте параметры out'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1021
- AvoidOutParameters
helpviewer_keywords:
- AvoidOutParameters
- CA1021
dev_langs:
- CSharp
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 01f6fa3d713b0b9862c2cb039bf51afded9d9a2d
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99547425"
---
# <a name="ca1021-avoid-out-parameters"></a>CA1021. Не используйте параметры out

| Элемент                                     | Значение            |
|------------------------------------------|------------------|
| Идентификатор правила                                   | CA1021           |
| Категория                                 | [Microsoft.Design](design-warnings.md) |
| Исправление является критическим или не критическим | Критическое         |

## <a name="cause"></a>Причина

Открытый или защищенный метод в открытом типе имеет параметр `out`.

По умолчанию это правило проверяет только видимые извне типы, но это поведение [можно настроить](#configure-code-to-analyze).

## <a name="rule-description"></a>Описание правила

Для реализации передачи типов по ссылке (с помощью `out` или `ref`) от разработчика требуется опыт работы с указателями, понимание отличия между типами значения и ссылочными типами и умение работать с методами с несколькими возвращаемыми значениями. Кроме того, далеко не все понимают разницу между параметрами `out` и `ref`.

Когда ссылочный тип передается "по ссылке", метод намеревается использовать этот параметр для возврата другого экземпляра объекта. Передача ссылочного типа по ссылке также называется использованием двойного указателя, указателя на указатель или двойного косвенного обращения. Используя соглашение о вызовах по умолчанию, которое передается "по значению", параметр, который принимает ссылочный тип, уже получает указатель на объект. Указатель, а не объект, на который он указывает, передается по значению. Передача по значению означает, что метод не может изменить указатель, чтобы он указывал на новый экземпляр ссылочного типа. Однако он может изменить содержимое объекта, на который он указывает. Для большинства приложений этого достаточно, и это дает желаемое поведение.

Если метод должен возвращать другой экземпляр, используйте для этого возвращаемое значение метода. См. класс <xref:System.String?displayProperty=fullName> для различных методов, которые работают со строками и возвращают новый экземпляр строки. При использовании этой модели вызывающий объект должен решить, сохраняется ли исходный объект.

Хотя возвращаемые значения являются наиболее распространенными и часто используются, правильное применение параметров `out` и `ref` требует среднего уровня навыков проектирования и программирования. Архитекторам, разрабатывающим библиотеки для широкого использования, не следует рассчитывать, что пользователи хорошо разбираются в использовании параметров `out` и `ref`.

## <a name="how-to-fix-violations"></a>Устранение нарушений

Чтобы устранить нарушение этого правила, вызванное типом значения, метод должен вернуть объект в качестве возвращаемого значения. Если метод должен возвращать несколько значений, перепроектируйте его для возврата одного экземпляра объекта, содержащего значения.

Чтобы устранить нарушение этого правила, вызванное ссылочным типом, убедитесь, что желаемое поведение состоит в возвращении нового экземпляра ссылки. Если это так, метод должен использовать его возвращаемое значение для этого.

## <a name="when-to-suppress-warnings"></a>Условия для отключения предупреждений

Вы можете безопасно скрыть предупреждения, связанные с этим правилом. Однако такая схема может создавать неудобства в использовании.

[!INCLUDE [suppress-warning](../../../../includes/code-analysis/suppress-warning.md)]

## <a name="configure-code-to-analyze"></a>Настройка кода для анализа

Используйте следующий параметр, чтобы выбрать части базы кода для применения этого правила.

- [Включение определенных контактных зон API](#include-specific-api-surfaces)

Этот параметр можно настроить только для некоторого правила, для всех правил или для всех правил в этой категории ([конструктор](design-warnings.md)). Дополнительные сведения см. в статье [Параметры конфигурации правила качества кода](../code-quality-rule-options.md).

[!INCLUDE[api-surface](~/includes/code-analysis/api-surface.md)]

## <a name="example-1"></a>Пример 1

В следующей библиотеке показаны две реализации класса, которые создают ответы на отзывы пользователей. Первая реализация (`BadRefAndOut`) заставляет пользователя библиотеки управлять тремя возвращаемыми значениями. Вторая реализация (`RedesignedRefAndOut`) упрощает взаимодействие с пользователем, возвращая экземпляр класса контейнера (`ReplyData`), который управляет данными как единым целым.

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet1":::

## <a name="example-2"></a>Пример 2

В следующем приложении показана работа пользователя. Вызов переработанной библиотеки (метода `UseTheSimplifiedClass`) более прост, и сведениями, возвращаемыми методом, легко управлять. Оба метода дают одинаковые результаты.

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet2":::

## <a name="example-3"></a>Пример 3

В следующем примере библиотеки показано, как используются параметры `ref` для ссылочных типов, и демонстрируется лучший способ реализации этой функции.

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet3":::

## <a name="example-4"></a>Пример 4

Следующее приложение вызывает каждый метод в библиотеке, чтобы продемонстрировать поведение.

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet4":::

В этом примере выводятся следующие данные:

```txt
Changing pointer - passed by value:
12345
12345
Changing pointer - passed by reference:
12345
12345 ABCDE
Passing by return value:
12345 ABCDE
```

## <a name="try-pattern-methods"></a>Методы шаблона try

Использование методов, которые реализуют шаблон **Try\<Something>** , например <xref:System.Int32.TryParse%2A?displayProperty=fullName>, не приводит к нарушению данного правила. В следующем примере показана структура (тип значения), реализующая метод <xref:System.Int32.TryParse%2A?displayProperty=fullName>.

:::code language="csharp" source="snippets/csharp/all-rules/ca1021.cs" id="snippet5":::

## <a name="related-rules"></a>Связанные правила

[CA1045. Не передавайте типы по ссылке](ca1045.md)
