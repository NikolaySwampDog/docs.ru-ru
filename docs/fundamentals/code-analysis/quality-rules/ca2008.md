---
title: 'CA2008: не создавайте задачи без передачи TaskScheduler (анализ кода)'
description: 'Дополнительные сведения о правиле анализа кода CA2008: не создавать задачи без передачи TaskScheduler'
ms.date: 08/26/2020
ms.topic: reference
f1_keywords:
- CA2008
- DoNotCreateTasksWithoutPassingATaskSchedulerAnalyzer
helpviewer_keywords:
- CA2008
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 84a97e2fd653998b7b03056b8e50b32759c9ee99
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99787660"
---
# <a name="ca2008-do-not-create-tasks-without-passing-a-taskscheduler"></a><span data-ttu-id="312b1-103">CA2008. Не создавайте задачи без передачи TaskScheduler</span><span class="sxs-lookup"><span data-stu-id="312b1-103">CA2008: Do not create tasks without passing a TaskScheduler</span></span>

| | <span data-ttu-id="312b1-104">Значение</span><span class="sxs-lookup"><span data-stu-id="312b1-104">Value</span></span> |
|-|-|
| <span data-ttu-id="312b1-105">**Идентификатор правила**</span><span class="sxs-lookup"><span data-stu-id="312b1-105">**Rule ID**</span></span> |<span data-ttu-id="312b1-106">CA2008</span><span class="sxs-lookup"><span data-stu-id="312b1-106">CA2008</span></span>|
| <span data-ttu-id="312b1-107">**Категория**</span><span class="sxs-lookup"><span data-stu-id="312b1-107">**Category**</span></span> |[<span data-ttu-id="312b1-108">Надежность</span><span class="sxs-lookup"><span data-stu-id="312b1-108">Reliability</span></span>](reliability-warnings.md)|
| <span data-ttu-id="312b1-109">**Исправление является критическим или не критическим**</span><span class="sxs-lookup"><span data-stu-id="312b1-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="312b1-110">Не критическое</span><span class="sxs-lookup"><span data-stu-id="312b1-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="312b1-111">Причина</span><span class="sxs-lookup"><span data-stu-id="312b1-111">Cause</span></span>

<span data-ttu-id="312b1-112">Операция создания или продолжения задачи использует перегрузку метода, в которой не указан параметр <xref:System.Threading.Tasks.TaskScheduler>.</span><span class="sxs-lookup"><span data-stu-id="312b1-112">A task creation or continuation operation uses a method overload that does not specify a <xref:System.Threading.Tasks.TaskScheduler> parameter.</span></span>

## <a name="rule-description"></a><span data-ttu-id="312b1-113">Описание правила</span><span class="sxs-lookup"><span data-stu-id="312b1-113">Rule description</span></span>

<span data-ttu-id="312b1-114">Следующие методы создания и продолжения задачи .NET имеют перегрузки, позволяющие указывать или опускать экземпляр <xref:System.Threading.Tasks.TaskScheduler>:</span><span class="sxs-lookup"><span data-stu-id="312b1-114">The following .NET task creation and continuation methods have overloads that allow specifying or omitting a <xref:System.Threading.Tasks.TaskScheduler> instance:</span></span>

- <span data-ttu-id="312b1-115">Методы <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="312b1-115"><xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=fullName> methods</span></span>
- <span data-ttu-id="312b1-116">Методы <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="312b1-116"><xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=fullName> methods</span></span>

<span data-ttu-id="312b1-117">Всегда указывайте явный аргумент <xref:System.Threading.Tasks.TaskScheduler>, чтобы избежать значения по умолчанию <xref:System.Threading.Tasks.TaskScheduler.Current%2A>, поведение которого определяется вызывающим объектом и может меняться в среде выполнения.</span><span class="sxs-lookup"><span data-stu-id="312b1-117">Always specify an explicit <xref:System.Threading.Tasks.TaskScheduler> argument to avoid the default <xref:System.Threading.Tasks.TaskScheduler.Current%2A> value, whose behavior is defined by the caller and may vary at runtime.</span></span> <span data-ttu-id="312b1-118"><xref:System.Threading.Tasks.TaskScheduler.Current%2A> возвращает планировщик, связанный с <xref:System.Threading.Tasks.Task>, который в данный момент выполняется в этом потоке.</span><span class="sxs-lookup"><span data-stu-id="312b1-118"><xref:System.Threading.Tasks.TaskScheduler.Current%2A> returns the scheduler associated with whatever <xref:System.Threading.Tasks.Task> is currently running on that thread.</span></span> <span data-ttu-id="312b1-119">Если такой задачи нет, возвращается значение <xref:System.Threading.Tasks.TaskScheduler.Default%2A>, представляющее пул потоков.</span><span class="sxs-lookup"><span data-stu-id="312b1-119">If there is no such task, it returns <xref:System.Threading.Tasks.TaskScheduler.Default%2A>, which represents the thread pool.</span></span> <span data-ttu-id="312b1-120">Использование <xref:System.Threading.Tasks.TaskScheduler.Current%2A> может привести к взаимоблокировкам или проблемам со скоростью реагирования пользовательского интерфейса в некоторых ситуациях, когда планировалось создание задачи в пуле потоков, а вместо этого ожидается возврат в поток пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="312b1-120">Using <xref:System.Threading.Tasks.TaskScheduler.Current%2A> could lead to deadlocks or UI responsiveness issues in some situations, when it was intended to create the task on the thread pool, but instead it waits to get back onto the UI thread.</span></span>

<span data-ttu-id="312b1-121">Дополнительные сведения и подробные примеры см. в разделе [Новые TaskCreationOptions и TaskContinuationOptions в .NET Framework 4.5](https://devblogs.microsoft.com/pfxteam/new-taskcreationoptions-and-taskcontinuationoptions-in-net-4-5/).</span><span class="sxs-lookup"><span data-stu-id="312b1-121">For further information and detailed examples, see [New TaskCreationOptions and TaskContinuationOptions in .NET Framework 4.5](https://devblogs.microsoft.com/pfxteam/new-taskcreationoptions-and-taskcontinuationoptions-in-net-4-5/).</span></span>

> [!NOTE]
> <span data-ttu-id="312b1-122">[VSTHRD105. Избегайте перегрузок методов, предполагающих TaskScheduler.Current](https://github.com/microsoft/vs-threading/blob/master/doc/analyzers/VSTHRD105.md) — это аналогичное правило, реализованное в пакете [Microsoft.VisualStudio.Threading.Analyzers](https://www.nuget.org/packages/Microsoft.VisualStudio.Threading.Analyzers).</span><span class="sxs-lookup"><span data-stu-id="312b1-122">[VSTHRD105 - Avoid method overloads that assume TaskScheduler.Current](https://github.com/microsoft/vs-threading/blob/master/doc/analyzers/VSTHRD105.md) is a similar rule implemented in [Microsoft.VisualStudio.Threading.Analyzers](https://www.nuget.org/packages/Microsoft.VisualStudio.Threading.Analyzers) package.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="312b1-123">Устранение нарушений</span><span class="sxs-lookup"><span data-stu-id="312b1-123">How to fix violations</span></span>

<span data-ttu-id="312b1-124">Чтобы устранить нарушения, вызовите перегрузку метода, которая принимает <xref:System.Threading.Tasks.TaskScheduler> и явно передает <xref:System.Threading.Tasks.TaskScheduler.Default%2A> или <xref:System.Threading.Tasks.TaskScheduler.Current%2A>, чтобы прояснить намерение.</span><span class="sxs-lookup"><span data-stu-id="312b1-124">To fix violations, call the method overload that takes a <xref:System.Threading.Tasks.TaskScheduler> and explicitly pass in <xref:System.Threading.Tasks.TaskScheduler.Default%2A> or <xref:System.Threading.Tasks.TaskScheduler.Current%2A> to make the intent clear.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="312b1-125">Условия для отключения предупреждений</span><span class="sxs-lookup"><span data-stu-id="312b1-125">When to suppress warnings</span></span>

<span data-ttu-id="312b1-126">Это предупреждение предназначено, в основном, для библиотек, где код может выполняться в произвольных средах и не должен делать предположений о среде или о том, как вызывающий объект метода может вызываться или ожидать метод.</span><span class="sxs-lookup"><span data-stu-id="312b1-126">This warning is intended primarily for libraries, where the code may be executed in arbitrary environments and where code shouldn't make assumptions about the environment or how the caller of the method may be invoking or waiting on it.</span></span> <span data-ttu-id="312b1-127">Может быть целесообразно отключить это предупреждение для проектов, представляющих код приложения, а не код библиотеки.</span><span class="sxs-lookup"><span data-stu-id="312b1-127">It may be appropriate to suppress the warning for projects that represent application code rather than library code.</span></span>

## <a name="see-also"></a><span data-ttu-id="312b1-128">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="312b1-128">See also</span></span>

- [<span data-ttu-id="312b1-129">Новые TaskCreationOptions и TaskContinuationOptions в .NET Framework 4.5</span><span class="sxs-lookup"><span data-stu-id="312b1-129">New TaskCreationOptions and TaskContinuationOptions in .NET Framework 4.5</span></span>](https://devblogs.microsoft.com/pfxteam/new-taskcreationoptions-and-taskcontinuationoptions-in-net-4-5/)
- [<span data-ttu-id="312b1-130">VSTHRD105. Избегайте перегрузок методов, предполагающих TaskScheduler.Current</span><span class="sxs-lookup"><span data-stu-id="312b1-130">VSTHRD105 - Avoid method overloads that assume TaskScheduler.Current</span></span>](https://github.com/microsoft/vs-threading/blob/master/doc/analyzers/VSTHRD105.md)
- [<span data-ttu-id="312b1-131">CA2007. Не следует напрямую ожидать Task</span><span class="sxs-lookup"><span data-stu-id="312b1-131">CA2007: Do not directly await a Task</span></span>](ca2007.md)
- [<span data-ttu-id="312b1-132">Правила надежности</span><span class="sxs-lookup"><span data-stu-id="312b1-132">Reliability rules</span></span>](reliability-warnings.md)
