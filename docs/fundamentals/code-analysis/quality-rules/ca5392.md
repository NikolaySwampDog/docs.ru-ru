---
title: 'CA5392: используйте атрибут DefaultDllImportSearchPaths для методов P/Invoke (анализ кода)'
description: Предоставляет сведения о правиле анализа кода CA5392, включая причины нарушений и способы их устранения, а также условия отключения правила.
ms.date: 05/28/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
f1_keywords:
- CA5392
ms.openlocfilehash: e9b7588fc2e0805782aa923409e135ae0a774688
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99769368"
---
# <a name="ca5392-use-defaultdllimportsearchpaths-attribute-for-pinvokes"></a><span data-ttu-id="8fec9-103">CA5392: используйте атрибут DefaultDllImportSearchPaths для методов P/Invoke</span><span class="sxs-lookup"><span data-stu-id="8fec9-103">CA5392: Use DefaultDllImportSearchPaths attribute for P/Invokes</span></span>

| | <span data-ttu-id="8fec9-104">Значение</span><span class="sxs-lookup"><span data-stu-id="8fec9-104">Value</span></span> |
|-|-|
| <span data-ttu-id="8fec9-105">**Идентификатор правила**</span><span class="sxs-lookup"><span data-stu-id="8fec9-105">**Rule ID**</span></span> |<span data-ttu-id="8fec9-106">CA5392</span><span class="sxs-lookup"><span data-stu-id="8fec9-106">CA5392</span></span>|
| <span data-ttu-id="8fec9-107">**Категория**</span><span class="sxs-lookup"><span data-stu-id="8fec9-107">**Category**</span></span> |[<span data-ttu-id="8fec9-108">Безопасность</span><span class="sxs-lookup"><span data-stu-id="8fec9-108">Security</span></span>](security-warnings.md)|
| <span data-ttu-id="8fec9-109">**Исправление является критическим или не критическим**</span><span class="sxs-lookup"><span data-stu-id="8fec9-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="8fec9-110">Не критическое</span><span class="sxs-lookup"><span data-stu-id="8fec9-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="8fec9-111">Причина</span><span class="sxs-lookup"><span data-stu-id="8fec9-111">Cause</span></span>

<span data-ttu-id="8fec9-112">Атрибут <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> не указан для функции [вызова неуправляемого кода (P/Invoke)](../../../standard/native-interop/pinvoke.md).</span><span class="sxs-lookup"><span data-stu-id="8fec9-112">The <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> is not specified for a [Platform Invoke (P/Invoke)](../../../standard/native-interop/pinvoke.md) function.</span></span>

## <a name="rule-description"></a><span data-ttu-id="8fec9-113">Описание правила</span><span class="sxs-lookup"><span data-stu-id="8fec9-113">Rule description</span></span>

<span data-ttu-id="8fec9-114">По умолчанию функции P/Invoke используют пробу <xref:System.Runtime.InteropServices.DllImportAttribute> нескольких каталогов, включая текущий рабочий каталог для загрузки библиотеки.</span><span class="sxs-lookup"><span data-stu-id="8fec9-114">By default, P/Invoke functions using <xref:System.Runtime.InteropServices.DllImportAttribute> probe a number of directories, including the current working directory for the library to load.</span></span> <span data-ttu-id="8fec9-115">Это может быть проблемой безопасности для некоторых приложений, приводящей к перехвату библиотеки DLL.</span><span class="sxs-lookup"><span data-stu-id="8fec9-115">This can be a security issue for certain applications, leading to DLL hijacking.</span></span>

<span data-ttu-id="8fec9-116">Например, если вредоносная библиотека DLL с тем же именем, что и у импортированной, помещена в текущий рабочий каталог, в котором по умолчанию в первую очередь будет выполняться поиск, то может быть загружена именно она.</span><span class="sxs-lookup"><span data-stu-id="8fec9-116">For example, if a malicious DLL with the same name as the imported one is placed under the current working directory, which will be searched firstly by default, then the malicious DLL could be loaded.</span></span>

<span data-ttu-id="8fec9-117">Дополнительные сведения см. в разделе [Безопасная загрузка библиотеки](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span><span class="sxs-lookup"><span data-stu-id="8fec9-117">For more information, see [Load Library Safely](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="8fec9-118">Устранение нарушений</span><span class="sxs-lookup"><span data-stu-id="8fec9-118">How to fix violations</span></span>

<span data-ttu-id="8fec9-119">Используйте атрибут <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute>, чтобы явным образом указать пути поиска DLL для сборки или метода.</span><span class="sxs-lookup"><span data-stu-id="8fec9-119">Use <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> to specify the DLL search path explicitly for the assembly or the method.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="8fec9-120">Условия для отключения предупреждений</span><span class="sxs-lookup"><span data-stu-id="8fec9-120">When to suppress warnings</span></span>

<span data-ttu-id="8fec9-121">Это правило можно безопасно отключить в следующих случаях.</span><span class="sxs-lookup"><span data-stu-id="8fec9-121">It's safe to suppress this rule if:</span></span>

- <span data-ttu-id="8fec9-122">Вы уверены, что загруженная сборка — это то, что вам нужно.</span><span class="sxs-lookup"><span data-stu-id="8fec9-122">You're sure the loaded assembly is what you want.</span></span> <span data-ttu-id="8fec9-123">Например, приложение выполняется на доверенном сервере, и вы полностью доверяете файлам.</span><span class="sxs-lookup"><span data-stu-id="8fec9-123">For example, your application runs on a trusted server and you completely trust the files.</span></span>
- <span data-ttu-id="8fec9-124">Импортированная сборка является часто используемой системной сборкой, такой как user32.dll, а стратегия пути поиска использует [механизм известных библиотек DLL](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span><span class="sxs-lookup"><span data-stu-id="8fec9-124">The imported assembly is a commonly used system assembly, like user32.dll, and the search path strategy follows the [Known DLLs mechanism](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="8fec9-125">Примеры псевдокода</span><span class="sxs-lookup"><span data-stu-id="8fec9-125">Pseudo-code examples</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

### <a name="solution"></a><span data-ttu-id="8fec9-126">Решение</span><span class="sxs-lookup"><span data-stu-id="8fec9-126">Solution</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    [DefaultDllImportSearchPaths(DllImportSearchPath.UserDirectories)]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

## <a name="related-rules"></a><span data-ttu-id="8fec9-127">Связанные правила</span><span class="sxs-lookup"><span data-stu-id="8fec9-127">Related rules</span></span>

[<span data-ttu-id="8fec9-128">CA5393: не используйте небезопасное значение DllImportSearchPath</span><span class="sxs-lookup"><span data-stu-id="8fec9-128">CA5393: Do not use unsafe DllImportSearchPath value</span></span>](ca5393.md)
