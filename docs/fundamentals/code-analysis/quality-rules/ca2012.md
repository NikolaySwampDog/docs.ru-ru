---
title: 'CA2012: используйте ValueTasks правильно (анализ кода)'
description: 'Сведения о правиле анализа кода CA2012: используйте ValueTasks правильно'
ms.date: 06/18/2020
ms.topic: reference
f1_keywords:
- UseValueTasksCorrectly
- CA2012
helpviewer_keywords:
- UseValueTasksCorrectly
- CA2012
author: stephentoub
ms.author: stoub
ms.openlocfilehash: e6bf3b099ce31e72027b9b749aefcd4a11b1f470
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "99754749"
---
# <a name="ca2012-use-valuetasks-correctly"></a><span data-ttu-id="18c44-103">CA2012: используйте ValueTasks правильно</span><span class="sxs-lookup"><span data-stu-id="18c44-103">CA2012: Use ValueTasks correctly</span></span>

| | <span data-ttu-id="18c44-104">Значение</span><span class="sxs-lookup"><span data-stu-id="18c44-104">Value</span></span> |
|-|-|
| <span data-ttu-id="18c44-105">**Идентификатор правила**</span><span class="sxs-lookup"><span data-stu-id="18c44-105">**Rule ID**</span></span> |<span data-ttu-id="18c44-106">CA2012</span><span class="sxs-lookup"><span data-stu-id="18c44-106">CA2012</span></span>|
| <span data-ttu-id="18c44-107">**Категория**</span><span class="sxs-lookup"><span data-stu-id="18c44-107">**Category**</span></span> |[<span data-ttu-id="18c44-108">Надежность</span><span class="sxs-lookup"><span data-stu-id="18c44-108">Reliability</span></span>](reliability-warnings.md)|
| <span data-ttu-id="18c44-109">**Исправление является критическим или не критическим**</span><span class="sxs-lookup"><span data-stu-id="18c44-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="18c44-110">Не критическое</span><span class="sxs-lookup"><span data-stu-id="18c44-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="18c44-111">Причина</span><span class="sxs-lookup"><span data-stu-id="18c44-111">Cause</span></span>

<span data-ttu-id="18c44-112">Экземпляр <xref:System.Threading.Tasks.ValueTask>, возвращенный из вызова члена, используется способом, который может привести к возникновению исключений, повреждению или ухудшению производительности.</span><span class="sxs-lookup"><span data-stu-id="18c44-112">A <xref:System.Threading.Tasks.ValueTask> instance returned from a member invocation is used in a way that could lead to exceptions, corruption, or poor performance.</span></span>

## <a name="rule-description"></a><span data-ttu-id="18c44-113">Описание правила</span><span class="sxs-lookup"><span data-stu-id="18c44-113">Rule description</span></span>

<span data-ttu-id="18c44-114">Экземпляры <xref:System.Threading.Tasks.ValueTask>, возвращаемые из вызовов членов, предназначены для непосредственного ожидания.</span><span class="sxs-lookup"><span data-stu-id="18c44-114"><xref:System.Threading.Tasks.ValueTask> instances returned from member invocations are intended to be directly awaited.</span></span>  <span data-ttu-id="18c44-115">Попытки использовать ValueTask несколько раз или для прямого доступа к результату до его завершения могут привести к возникновению исключения или повреждения.</span><span class="sxs-lookup"><span data-stu-id="18c44-115">Attempts to consume a ValueTask multiple times or to directly access one's result before it's known to be completed may result in an exception or corruption.</span></span>  <span data-ttu-id="18c44-116">Игнорирование ValueTask, скорее всего, указывает на функциональную ошибку и может привести к снижению производительности.</span><span class="sxs-lookup"><span data-stu-id="18c44-116">Ignoring such a ValueTask is likely an indication of a functional bug and may degrade performance.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="18c44-117">Устранение нарушений</span><span class="sxs-lookup"><span data-stu-id="18c44-117">How to fix violations</span></span>

<span data-ttu-id="18c44-118">Как правило, экземпляры ValueTask следует ожидать непосредственно, а не отменять или хранить в других местах, таких как локальные переменные или поля.</span><span class="sxs-lookup"><span data-stu-id="18c44-118">In general, ValueTasks should be directly awaited rather than discarded or stored into other locations like local variables or fields.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="18c44-119">Условия для отключения предупреждений</span><span class="sxs-lookup"><span data-stu-id="18c44-119">When to suppress warnings</span></span>

<span data-ttu-id="18c44-120">Что касается экземпляров ValueTask, возвращенных из произвольных вызовов членов, вызывающий объект должен допускать, что ValueTask следует использовать (например, ожидать) только один раз.</span><span class="sxs-lookup"><span data-stu-id="18c44-120">For ValueTasks returned from arbitrary member calls, the caller needs to assume that the ValueTask must be consumed (e.g. awaited) once and only once.</span></span>  <span data-ttu-id="18c44-121">Однако если разработчик также управляет вызываемым членом и имеет полное представление о его реализации, ему может быть известно, что это предупреждение можно отключить, например, если возвращаемый экземпляр ValueTask всегда заключает объект <xref:System.Threading.Tasks.Task> в оболочку.</span><span class="sxs-lookup"><span data-stu-id="18c44-121">However, if the developer also controls the member being invoked and has complete knowledge of its implementation, the developer may know it's safe to suppress the warning, for example, if the return ValueTask always wraps a <xref:System.Threading.Tasks.Task> object.</span></span>

## <a name="see-also"></a><span data-ttu-id="18c44-122">См. также раздел</span><span class="sxs-lookup"><span data-stu-id="18c44-122">See also</span></span>

- [<span data-ttu-id="18c44-123">Правила надежности</span><span class="sxs-lookup"><span data-stu-id="18c44-123">Reliability rules</span></span>](reliability-warnings.md)
