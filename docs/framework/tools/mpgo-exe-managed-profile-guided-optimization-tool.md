---
title: Mpgo.exe (управляемое средство профильной оптимизации)
description: Используйте Mpgo.exe, средство управляемой оптимизации с использованием профиля. С помощью этого средства оптимизируйте сборки нативных образов, созданные генератором образов в машинном кодах (Ngen.exe).
ms.date: 03/30/2017
helpviewer_keywords:
- Mpgo.exe
- training scenarios, generating profiles with
- Managed Profile Guided Optimization Tool
- Ngen.exe
- Ngen.exe, profilers and native images
ms.assetid: f6976502-a000-4fbe-aaf5-a7aab9ce4ec2
ms.openlocfilehash: 0336c3a98fb93a3b3d3689048e5c313b811630d9
ms.sourcegitcommit: 1dbe25ff484a02025d5c34146e517c236f7161fb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104653911"
---
# <a name="mpgoexe-managed-profile-guided-optimization-tool"></a><span data-ttu-id="19dfe-104">Mpgo.exe (управляемое средство профильной оптимизации)</span><span class="sxs-lookup"><span data-stu-id="19dfe-104">Mpgo.exe (Managed Profile Guided Optimization Tool)</span></span>

<span data-ttu-id="19dfe-105">Управляемое средство профильной оптимизации (Mpgo.exe) — это программа командной строки, которая использует общие пользовательские сценарии для оптимизации сборок машинных образов, созданных [Генератором машинных образов (Ngen.exe)](ngen-exe-native-image-generator.md).</span><span class="sxs-lookup"><span data-stu-id="19dfe-105">The Managed Profile Guided Optimization Tool (Mpgo.exe) is a command-line tool that uses common end-user scenarios to optimize the native image assemblies that are created by the [Native Image Generator (Ngen.exe)](ngen-exe-native-image-generator.md).</span></span> <span data-ttu-id="19dfe-106">Это средство позволяет выполнять обучающие сценарии, которые создают данные профиля.</span><span class="sxs-lookup"><span data-stu-id="19dfe-106">This tool enables you to run training scenarios that generate profile data.</span></span> <span data-ttu-id="19dfe-107">[Генератор машинных образов (Ngen.exe)](ngen-exe-native-image-generator.md) использует эти данные для оптимизации создаваемых сборок приложений с машинными образами.</span><span class="sxs-lookup"><span data-stu-id="19dfe-107">The [Native Image Generator (Ngen.exe)](ngen-exe-native-image-generator.md) uses this data to optimize its generated native image application assemblies.</span></span> <span data-ttu-id="19dfe-108">Обучающий сценарий — это пробный сеанс предполагаемого использования приложения.</span><span class="sxs-lookup"><span data-stu-id="19dfe-108">A training scenario is a trial run of an expected use of your application.</span></span> <span data-ttu-id="19dfe-109">Средство Mpgo.exe доступно в Visual Studio Ultimate 2012 и более поздних версий.</span><span class="sxs-lookup"><span data-stu-id="19dfe-109">Mpgo.exe is available in Visual Studio Ultimate 2012 and later versions.</span></span> <span data-ttu-id="19dfe-110">Начиная с Visual Studio 2013, для оптимизации приложений Магазина Windows 8.x также можно использовать Mpgo.exe.</span><span class="sxs-lookup"><span data-stu-id="19dfe-110">Starting with Visual Studio 2013, you can also use Mpgo.exe to optimize Windows 8.x Store apps.</span></span>

<span data-ttu-id="19dfe-111">Средство профильной оптимизации собирает данные из обучающих сценариев и с их помощью оптимизирует макет машинных образов. Это позволяет сократить время запуска приложения, уменьшить объем используемой памяти (размер рабочего набора) и повысить пропускную способность.</span><span class="sxs-lookup"><span data-stu-id="19dfe-111">Profile-guided optimization improves application startup time, memory utilization (working set size), and throughput by gathering data from training scenarios and using it to optimize the layout of native images.</span></span>

<span data-ttu-id="19dfe-112">При возникновении ошибок производительности, связанных с временем запуска и размером рабочего набора IL-сборок, рекомендуется сначала применить Ngen.exe, чтобы исключить расходы на JIT-компиляцию и создать возможность совместного использования кода.</span><span class="sxs-lookup"><span data-stu-id="19dfe-112">When you encounter performance issues with startup time and working set size for Intermediate Language (IL) assemblies, we recommend that you first use Ngen.exe to eliminate just-in-time (JIT) compilation costs and to facilitate code sharing.</span></span> <span data-ttu-id="19dfe-113">Затем можно оптимизировать приложение с помощью средства Mpgo.exe.</span><span class="sxs-lookup"><span data-stu-id="19dfe-113">If you need additional improvements, you can then use Mpgo.exe to further optimize your application.</span></span> <span data-ttu-id="19dfe-114">Данные о производительности неоптимизированных сборок машинных образов можно использовать в качестве базовых показателей при оценке прироста производительности.</span><span class="sxs-lookup"><span data-stu-id="19dfe-114">You can use the performance data from the un-optimized native image assemblies as a baseline to evaluate the performance gains.</span></span> <span data-ttu-id="19dfe-115">Оптимизация с помощью средства Mpgo.exe, возможно, позволит сократить время холодного запуска и размер рабочего набора.</span><span class="sxs-lookup"><span data-stu-id="19dfe-115">Using Mpgo.exe may result in faster cold startup times and a smaller working set size.</span></span> <span data-ttu-id="19dfe-116">Mpgo.exe добавляет информацию в IL-сборки, которые используются программой Ngen.exe для создания оптимизированных сборок машинных образов.</span><span class="sxs-lookup"><span data-stu-id="19dfe-116">Mpgo.exe adds information to IL assemblies that Ngen.exe uses to create optimized native image assemblies.</span></span> <span data-ttu-id="19dfe-117">Дополнительные сведения см. в статье [Повышение производительности при запуске классических приложений](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/) в блоге .NET.</span><span class="sxs-lookup"><span data-stu-id="19dfe-117">For more information, see the entry [Improving Launch Performance for your Desktop Applications](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/) in the .NET blog.</span></span>

<span data-ttu-id="19dfe-118">Эта программа автоматически устанавливается вместе с Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="19dfe-118">This tool is automatically installed with Visual Studio.</span></span> <span data-ttu-id="19dfe-119">Для запуска этого средства используйте [Командную строку разработчика или PowerShell для разработчиков](/visualstudio/ide/reference/command-prompt-powershell) с учетными данными администратора.</span><span class="sxs-lookup"><span data-stu-id="19dfe-119">To run the tool, use [Developer Command Prompt or Developer PowerShell](/visualstudio/ide/reference/command-prompt-powershell) with administrator credentials.</span></span>

<span data-ttu-id="19dfe-120">Введите следующую команду в командной строке:</span><span class="sxs-lookup"><span data-stu-id="19dfe-120">Enter the following command at the command prompt:</span></span>

<span data-ttu-id="19dfe-121">Для классических приложений:</span><span class="sxs-lookup"><span data-stu-id="19dfe-121">For desktop apps:</span></span>

```console
mpgo –Scenario <command> [-Import <directory>] –AssemblyList <assembly1>  <assembly2> ... -OutDir <directory> [options]
```

<span data-ttu-id="19dfe-122">Для приложений Магазина Windows 8.x:</span><span class="sxs-lookup"><span data-stu-id="19dfe-122">For Windows 8.x Store apps:</span></span>

```console
mpgo –Scenario <packageName> -AppID <appId> -Timeout <seconds>
```

## <a name="parameters"></a><span data-ttu-id="19dfe-123">Параметры</span><span class="sxs-lookup"><span data-stu-id="19dfe-123">Parameters</span></span>

 <span data-ttu-id="19dfe-124">В аргументах средства Mpgo.exe не учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="19dfe-124">All arguments to Mpgo.exe are case-insensitive.</span></span> <span data-ttu-id="19dfe-125">Перед командами ставится тире.</span><span class="sxs-lookup"><span data-stu-id="19dfe-125">Commands are prefixed with a dash.</span></span>

> [!NOTE]
> <span data-ttu-id="19dfe-126">Необходимо указывать одну из обязательных команд `–Scenario` или `–Import`, но не обе команды одновременно.</span><span class="sxs-lookup"><span data-stu-id="19dfe-126">You can use either `–Scenario` or `–Import` as a required command, but not both.</span></span> <span data-ttu-id="19dfe-127">Если задан параметр `–Reset`, обязательные параметры не используются.</span><span class="sxs-lookup"><span data-stu-id="19dfe-127">None of the required parameters are used if you specify the `–Reset` option.</span></span>

|<span data-ttu-id="19dfe-128">Обязательный параметр</span><span class="sxs-lookup"><span data-stu-id="19dfe-128">Required parameter</span></span>|<span data-ttu-id="19dfe-129">Описание</span><span class="sxs-lookup"><span data-stu-id="19dfe-129">Description</span></span>|
|------------------------|-----------------|
|<span data-ttu-id="19dfe-130">`-Scenario` \<*command*></span><span class="sxs-lookup"><span data-stu-id="19dfe-130">`-Scenario` \<*command*></span></span><br /><br /> <span data-ttu-id="19dfe-131">—или—</span><span class="sxs-lookup"><span data-stu-id="19dfe-131">—or—</span></span><br /><br /> <span data-ttu-id="19dfe-132">`-Scenario` \<*packageName*></span><span class="sxs-lookup"><span data-stu-id="19dfe-132">`-Scenario` \<*packageName*></span></span><br /><br /> <span data-ttu-id="19dfe-133">-или-</span><span class="sxs-lookup"><span data-stu-id="19dfe-133">-or-</span></span><br /><br /> <span data-ttu-id="19dfe-134">`-Import` \<*directory*></span><span class="sxs-lookup"><span data-stu-id="19dfe-134">`-Import` \<*directory*></span></span>|<span data-ttu-id="19dfe-135">Для классических приложений параметр `–Scenario` позволяет задать команду для запуска оптимизируемого приложения со всеми аргументами командной строки.</span><span class="sxs-lookup"><span data-stu-id="19dfe-135">For desktop apps, use `–Scenario` to specify the command to run the application you want to optimize, including any command-line arguments.</span></span> <span data-ttu-id="19dfe-136">Заключите *команду`mpgo.exe -scenario """C:\My App\myapp.exe""" -assemblylist """C:\My App\myapp.exe""" -outdir "C:\optimized files"` в три пары двойных кавычек, если указанный в ней путь содержит пробелы, например* .</span><span class="sxs-lookup"><span data-stu-id="19dfe-136">Use three sets of double quotation marks around *command* if it specifies a path that includes spaces; for example: `mpgo.exe -scenario """C:\My App\myapp.exe""" -assemblylist """C:\My App\myapp.exe""" -outdir "C:\optimized files"`.</span></span> <span data-ttu-id="19dfe-137">Если заключить *команду*, содержащую пробелы, в одну пару двойных кавычек, при выполнении произойдет сбой.</span><span class="sxs-lookup"><span data-stu-id="19dfe-137">Do not use double quotation marks; they will not work correctly if *command* includes spaces.</span></span><br /><br /> <span data-ttu-id="19dfe-138">-или-</span><span class="sxs-lookup"><span data-stu-id="19dfe-138">-or-</span></span><br /><br /> <span data-ttu-id="19dfe-139">Для приложений Магазина Windows 8.x параметр `–Scenario` позволяет задать пакет, для которого создаются сведения профиля.</span><span class="sxs-lookup"><span data-stu-id="19dfe-139">For Windows 8.x Store apps, use `–Scenario` to specify the package that you want to generate profile information for.</span></span> <span data-ttu-id="19dfe-140">Если вместо полного имени пакета указать отображаемое имя пакета или имя семейства пакетов, средство Mpgo.exe выберет пакет с указанным именем — при условии, что он всего один.</span><span class="sxs-lookup"><span data-stu-id="19dfe-140">If you specify the package display name or the package family name instead of the full package name, Mpgo.exe will select the package that matches the name you provided if there is only one match.</span></span> <span data-ttu-id="19dfe-141">Если пакетов с таким именем несколько, Mpgo.exe предложит выбрать пакет.</span><span class="sxs-lookup"><span data-stu-id="19dfe-141">If multiple packages match the specified name, Mpgo.exe will prompt you to choose a package.</span></span><br /><br /> <span data-ttu-id="19dfe-142">—или—</span><span class="sxs-lookup"><span data-stu-id="19dfe-142">—or—</span></span><br /><br /> <span data-ttu-id="19dfe-143">Параметр `-Import` позволяет указать, что для оптимизации сборок в `-AssemblyList` следует использовать данные для оптимизации из ранее оптимизированных сборок.</span><span class="sxs-lookup"><span data-stu-id="19dfe-143">Use `-Import` to specify that optimization data from previously optimized assemblies should be used to optimize the assemblies in `-AssemblyList`.</span></span> <span data-ttu-id="19dfe-144">Аргумент *directory* задает каталог, содержащий ранее оптимизированные файлы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-144">*directory* specifies the directory that contains the previously optimized files.</span></span> <span data-ttu-id="19dfe-145">Сборки, указанные в `–AssemblyList` или `–AssemblyListFile` — это новые версии сборок, которые требуется оптимизировать при помощи данных из импортированных файлов.</span><span class="sxs-lookup"><span data-stu-id="19dfe-145">The assemblies specified in `–AssemblyList` or `–AssemblyListFile` are the new versions of the assemblies to be optimized using the data from the imported files.</span></span> <span data-ttu-id="19dfe-146">Используя данные для оптимизации из более старой версии сборок, можно оптимизировать более новые версии сборок без повторного выполнения сценария.</span><span class="sxs-lookup"><span data-stu-id="19dfe-146">Using optimization data from older version of assemblies enables you to optimize newer versions of assemblies without re-running the scenario.</span></span>  <span data-ttu-id="19dfe-147">Однако если код импортированных и целевых сборок значительно отличается, оптимизация на основе этих данных будет неэффективной.</span><span class="sxs-lookup"><span data-stu-id="19dfe-147">However, if the imported and target assemblies include significantly different code, the optimization data will be ineffective.</span></span> <span data-ttu-id="19dfe-148">Имена сборок, указанные в `–AssemblyList` или `–AssemblyListFile`, должны присутствовать в каталоге, указанном в параметре `–Import`*directory*.</span><span class="sxs-lookup"><span data-stu-id="19dfe-148">The assembly names specified in `–AssemblyList` or `–AssemblyListFile` must be present in the directory specified by `–Import`*directory*.</span></span> <span data-ttu-id="19dfe-149">Заключите *directory* в три пары двойных кавычек, если указанный в нем путь содержит пробелы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-149">Use three sets of double quotation marks around *directory* if it specifies a path that includes spaces.</span></span><br /><br /> <span data-ttu-id="19dfe-150">Необходимо задать либо параметр `–Scenario`, либо параметр `–Import`, но не оба параметра одновременно.</span><span class="sxs-lookup"><span data-stu-id="19dfe-150">You must specify either `–Scenario` or `–Import`, but not both parameters.</span></span>|
|<span data-ttu-id="19dfe-151">`-OutDir` \<*directory*></span><span class="sxs-lookup"><span data-stu-id="19dfe-151">`-OutDir` \<*directory*></span></span>|<span data-ttu-id="19dfe-152">Каталог, в котором следует разместить оптимизированные сборки.</span><span class="sxs-lookup"><span data-stu-id="19dfe-152">The directory in which to place the optimized assemblies.</span></span> <span data-ttu-id="19dfe-153">Если сборка уже существует в папке выходного каталога, создается ее копия и к ее имени добавляется индекс. Пример: *имя_сборки*-1.exe.</span><span class="sxs-lookup"><span data-stu-id="19dfe-153">If an assembly already exists in the output directory folder, a new copy is created and an index number is appended to its name; for example: *assemblyname*-1.exe.</span></span> <span data-ttu-id="19dfe-154">Заключите *directory* в двойные кавычки, если указанный в нем путь содержит пробелы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-154">Use double quotation marks around *directory* if it specifies a path that contains spaces.</span></span>|
|<span data-ttu-id="19dfe-155">`-AssemblyList` \<*assembly1 assembly2 ...*></span><span class="sxs-lookup"><span data-stu-id="19dfe-155">`-AssemblyList` \<*assembly1 assembly2 ...*></span></span><br /><br /> <span data-ttu-id="19dfe-156">—или—</span><span class="sxs-lookup"><span data-stu-id="19dfe-156">—or—</span></span><br /><br /> <span data-ttu-id="19dfe-157">`-AssemblyListFile` \<*file*></span><span class="sxs-lookup"><span data-stu-id="19dfe-157">`-AssemblyListFile` \<*file*></span></span>|<span data-ttu-id="19dfe-158">Список сборок (включая файлы EXE и DLL), разделенных пробелами, для которых требуется собрать сведения профиля.</span><span class="sxs-lookup"><span data-stu-id="19dfe-158">A list of assemblies (including .exe and .dll files), separated by spaces, that you want collect profile information about.</span></span> <span data-ttu-id="19dfe-159">Можно указать `C:\Dir\*.dll` или `*.dll`, чтобы выбрать все сборки в заданном или текущем рабочем каталоге.</span><span class="sxs-lookup"><span data-stu-id="19dfe-159">You can specify `C:\Dir\*.dll` or `*.dll` to select all the assemblies in the designated or current working directory.</span></span> <span data-ttu-id="19dfe-160">Дополнительные сведения см. в разделе "Примечания".</span><span class="sxs-lookup"><span data-stu-id="19dfe-160">See the Remarks section for more information.</span></span><br /><br /> <span data-ttu-id="19dfe-161">—или—</span><span class="sxs-lookup"><span data-stu-id="19dfe-161">—or—</span></span><br /><br /> <span data-ttu-id="19dfe-162">Текстовый файл, содержащий список сборок, для которых требуется собрать сведения профиля. В каждой строке указывается одна сборка.</span><span class="sxs-lookup"><span data-stu-id="19dfe-162">A text file that contains the list of assemblies you want to collect profile information about, listed one assembly per line.</span></span> <span data-ttu-id="19dfe-163">Если имя сборки начинается с дефиса (-), используйте список файлов сборок или переименуйте сборку.</span><span class="sxs-lookup"><span data-stu-id="19dfe-163">If an assembly name begins with a hyphen (-), use an assembly file list or rename the assembly.</span></span>|
|<span data-ttu-id="19dfe-164">`-AppID` \<*appId*></span><span class="sxs-lookup"><span data-stu-id="19dfe-164">`-AppID` \<*appId*></span></span>|<span data-ttu-id="19dfe-165">Идентификатор приложения в заданном пакете.</span><span class="sxs-lookup"><span data-stu-id="19dfe-165">The ID of the application in the specified package.</span></span> <span data-ttu-id="19dfe-166">Если используется подстановочный знак (\*), средство Mpgo.exe попытается перечислить идентификаторы AppID в пакете и вернется к \<*package_family_name*>!App в случае сбоя.</span><span class="sxs-lookup"><span data-stu-id="19dfe-166">If you use the wildcard (\*), Mpgo.exe will try to enumerate the AppIDs in the package and will fall back to \<*package_family_name*>!App if it fails.</span></span> <span data-ttu-id="19dfe-167">Если указать строку, которая начинается с восклицательного знака (!), Mpgo.exe сцепляет имя семейства пакетов с заданным аргументом.</span><span class="sxs-lookup"><span data-stu-id="19dfe-167">If you specify a string that is prefixed by an exclamation point (!), Mpgo.exe will concatenate the package family name with the argument provided.</span></span>|
|<span data-ttu-id="19dfe-168">`-Timeout` \<*seconds*></span><span class="sxs-lookup"><span data-stu-id="19dfe-168">`-Timeout` \<*seconds*></span></span>|<span data-ttu-id="19dfe-169">Время выполнения приложения Магазина Windows 8.x до завершения работы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-169">The amount of time to allow the Windows 8.x Store app to run before the app exits.</span></span>|

|<span data-ttu-id="19dfe-170">Необязательный параметр</span><span class="sxs-lookup"><span data-stu-id="19dfe-170">Optional parameter</span></span>|<span data-ttu-id="19dfe-171">Описание</span><span class="sxs-lookup"><span data-stu-id="19dfe-171">Description</span></span>|
|------------------------|-----------------|
|`-64bit`|<span data-ttu-id="19dfe-172">Инструментирует сборки для 64-разрядных систем.</span><span class="sxs-lookup"><span data-stu-id="19dfe-172">Instruments the assemblies for 64-bit systems.</span></span>  <span data-ttu-id="19dfe-173">Необходимо указать этот параметр для 64-разрядных сборок, даже если сборка объявляется как 64-разрядная.</span><span class="sxs-lookup"><span data-stu-id="19dfe-173">You must specify this parameter for 64-bit assemblies, even if your assembly declares itself as 64 bit.</span></span>|
|<span data-ttu-id="19dfe-174">`-ExeConfig` \<*filename*></span><span class="sxs-lookup"><span data-stu-id="19dfe-174">`-ExeConfig` \<*filename*></span></span>|<span data-ttu-id="19dfe-175">Задает файл конфигурации, используемый сценарием для предоставления сведений о версии и загрузчике.</span><span class="sxs-lookup"><span data-stu-id="19dfe-175">Specifies the configuration file that your scenario uses to provide version and loader information.</span></span>|
|`-f`|<span data-ttu-id="19dfe-176">Принудительно включает данные профиля в двоичную сборку, даже если она подписана.</span><span class="sxs-lookup"><span data-stu-id="19dfe-176">Forces the inclusion of the profile data in a binary assembly, even if it's signed.</span></span>  <span data-ttu-id="19dfe-177">Если сборка подписана, ее необходимо заново подписать. В противном случае сборку не удастся загрузить и выполнить.</span><span class="sxs-lookup"><span data-stu-id="19dfe-177">If the assembly is signed, it must be re-signed; otherwise, the assembly will fail to load and run.</span></span>|
|`-Reset`|<span data-ttu-id="19dfe-178">Сбрасывает параметры среды, чтобы прерванный сеанс профилирования не повлиял на сборки, и завершает работу.</span><span class="sxs-lookup"><span data-stu-id="19dfe-178">Resets the environment to make certain that an aborted profiling session doesn't affect your assemblies, and then quits.</span></span> <span data-ttu-id="19dfe-179">Параметры среды сбрасываются по умолчанию до и после сеанса профилирования.</span><span class="sxs-lookup"><span data-stu-id="19dfe-179">The environment is reset by default before and after a profiling session.</span></span>|
|<span data-ttu-id="19dfe-180">`-Timeout` \<*time in seconds*></span><span class="sxs-lookup"><span data-stu-id="19dfe-180">`-Timeout` \<*time in seconds*></span></span>|<span data-ttu-id="19dfe-181">Задает длительность профилирования в секундах.</span><span class="sxs-lookup"><span data-stu-id="19dfe-181">Specifies the profiling duration in seconds.</span></span> <span data-ttu-id="19dfe-182">Используйте значение, немного превышающее наблюдаемое время запуска приложений графического пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="19dfe-182">Use a value that is slightly more than your observed startup times for GUI applications.</span></span> <span data-ttu-id="19dfe-183">В конце времени ожидания записываются данные профиля, хотя приложение продолжает выполняться.</span><span class="sxs-lookup"><span data-stu-id="19dfe-183">At the end of the time-out period, the profile data is recorded although the application continues to run.</span></span> <span data-ttu-id="19dfe-184">Если этот параметр не задан, профилирование продолжится до завершения работы приложения и в это время будут записаны данные.</span><span class="sxs-lookup"><span data-stu-id="19dfe-184">If you don't set this option, profiling will continue until application shutdown, at which time the data will be recorded.</span></span>|
|`-LeaveNativeImages`|<span data-ttu-id="19dfe-185">Указывает, что после выполнения сценария не следует удалять инструментированные машинные образы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-185">Specifies that the instrumented native images shouldn't be removed after running the scenario.</span></span> <span data-ttu-id="19dfe-186">Этот параметр используется, как правило, в тех случаях, когда требуется получить указанное в выполняемом сценарии приложение.</span><span class="sxs-lookup"><span data-stu-id="19dfe-186">This option is primarily used when you're getting the application that you specified for the scenario running.</span></span> <span data-ttu-id="19dfe-187">Он предотвращает повторное создание машинных образов при последующих запусках Mpgo.exe.</span><span class="sxs-lookup"><span data-stu-id="19dfe-187">It will prevent the recreation of native images for subsequent runs of Mpgo.exe.</span></span> <span data-ttu-id="19dfe-188">Если задать этот параметр, после завершения работы приложения в кэше могут оставаться потерянные машинные образы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-188">When you have finished running your application, there may be orphaned native images in the cache if you specify this option.</span></span> <span data-ttu-id="19dfe-189">Чтобы их удалить, запустите Mpgo.exe с тем же сценарием и списком сборок и укажите параметр `–RemoveNativeImages`.</span><span class="sxs-lookup"><span data-stu-id="19dfe-189">In this case, run Mpgo.exe with the same scenario and assembly list and use the `–RemoveNativeImages` parameter to remove these native images.</span></span>|
|`-RemoveNativeImages`|<span data-ttu-id="19dfe-190">Очищает запуск, в котором указан параметр `–LeaveNativeImages`.</span><span class="sxs-lookup"><span data-stu-id="19dfe-190">Cleans up from a run where `–LeaveNativeImages` was specified.</span></span> <span data-ttu-id="19dfe-191">Если задан параметр `-RemoveNativeImages`, средство Mpgo.exe игнорирует все аргументы, кроме `-64bit` и `–AssemblyList`, и завершает работу после удаления всех инструментированных образов в машинном коде.</span><span class="sxs-lookup"><span data-stu-id="19dfe-191">If you specify `-RemoveNativeImages`, Mpgo.exe ignores any arguments except `-64bit` and `–AssemblyList`, and exits after removing all instrumented native images.</span></span>|

## <a name="remarks"></a><span data-ttu-id="19dfe-192">Примечания</span><span class="sxs-lookup"><span data-stu-id="19dfe-192">Remarks</span></span>

 <span data-ttu-id="19dfe-193">Как параметр `–AssemblyList`, так и параметр `- AssemblyListFile` можно указывать в командной строке несколько раз.</span><span class="sxs-lookup"><span data-stu-id="19dfe-193">You can use both `–AssemblyList` and `- AssemblyListFile` multiple times on the command line.</span></span>

 <span data-ttu-id="19dfe-194">Если при задании сборок не указан полный путь, Mpgo.exe выполняет поиск в текущем каталоге.</span><span class="sxs-lookup"><span data-stu-id="19dfe-194">If you do not specify full path names when specifying assemblies, Mpgo.exe looks in the current directory.</span></span> <span data-ttu-id="19dfe-195">Если указан неверный путь, Mpgo.exe отображает сообщение об ошибке, но продолжает создавать данные для других сборок.</span><span class="sxs-lookup"><span data-stu-id="19dfe-195">If you specify an incorrect path, Mpgo.exe displays an error message but continues to generate data for other assemblies.</span></span> <span data-ttu-id="19dfe-196">Если указана сборка, которая не загружается во время обучающего сценария, обучающие данные для нее не создаются.</span><span class="sxs-lookup"><span data-stu-id="19dfe-196">If you specify an assembly that is not loaded during the training scenario, no training data is generated for that assembly.</span></span>

 <span data-ttu-id="19dfe-197">Если в списке указана сборка, которая находится в глобальном кэше сборок, в нее не будут добавлены сведения профиля.</span><span class="sxs-lookup"><span data-stu-id="19dfe-197">If an assembly in the list is in the global assembly cache, it will not be updated to contain the profile information.</span></span>  <span data-ttu-id="19dfe-198">Чтобы сведения профиля собирались, удалите ее из глобального кэша сборок.</span><span class="sxs-lookup"><span data-stu-id="19dfe-198">Remove it from the global assembly cache to collect profile information.</span></span>

 <span data-ttu-id="19dfe-199">Средства Ngen.exe и Mpgo.exe рекомендуется использовать только для больших управляемых приложений, где применение предварительно скомпилированных машинных образов позволит избежать продолжительной JIT-компиляции во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="19dfe-199">The use of Ngen.exe and Mpgo.exe is recommended only for large managed applications, because the benefit of precompiled native images is typically seen only when it eliminates significant JIT compilation at run time.</span></span> <span data-ttu-id="19dfe-200">Использовать средство Mpgo.exe для приложений типа "Hello World", не имеющих значительного рабочего набора, не имеет смысла. Возможно, что Mpgo.exe не соберет данные профиля.</span><span class="sxs-lookup"><span data-stu-id="19dfe-200">Running Mpgo.exe on "Hello World" style applications that aren’t working-set intensive will not provide any benefits, and Mpgo.exe may even fail to gather profile data.</span></span>

> [!NOTE]
> <span data-ttu-id="19dfe-201">Средства Ngen.exe и Mpgo.exe не рекомендуется использовать для приложений ASP.NET и служб Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="19dfe-201">Ngen.exe and Mpgo.exe are not recommended for ASP.NET applications and Windows Communication Foundation (WCF) services.</span></span>

## <a name="to-use-mpgoexe"></a><span data-ttu-id="19dfe-202">Использование Mpgo.exe</span><span class="sxs-lookup"><span data-stu-id="19dfe-202">To Use Mpgo.exe</span></span>

1. <span data-ttu-id="19dfe-203">Приложение должно быть установлено на компьютере с Visual Studio Ultimate 2012.</span><span class="sxs-lookup"><span data-stu-id="19dfe-203">Use a computer that has the Visual Studio Ultimate 2012 and your application installed.</span></span>

2. <span data-ttu-id="19dfe-204">Запустите Mpgo.exe с правами администратора, указав необходимые параметры.</span><span class="sxs-lookup"><span data-stu-id="19dfe-204">Run Mpgo.exe as an administrator with the necessary parameters.</span></span>  <span data-ttu-id="19dfe-205">Примеры команд см. в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="19dfe-205">See the next section for sample commands.</span></span>

     <span data-ttu-id="19dfe-206">Оптимизированные IL-сборки создаются в папке, заданной параметром `–OutDir` (в примерах это папка `C:\Optimized`).</span><span class="sxs-lookup"><span data-stu-id="19dfe-206">The optimized intermediate language (IL) assemblies are created in the folder specified by the `–OutDir` parameter (in the examples, this is the `C:\Optimized` folder).</span></span>

3. <span data-ttu-id="19dfe-207">Замените IL-сборки, обработанные Ngen.exe, новыми IL-сборками со сведениями профиля из каталога, заданного параметром `–OutDir`.</span><span class="sxs-lookup"><span data-stu-id="19dfe-207">Replace the IL assemblies you used for Ngen.exe  with the new IL assemblies that contain the profile information from the directory specified by `–OutDir`.</span></span>

4. <span data-ttu-id="19dfe-208">При настройке приложения (с помощью образов, предоставленных Mpgo.exe) будут установлены оптимизированные машинные образы.</span><span class="sxs-lookup"><span data-stu-id="19dfe-208">The application setup (using the images provided by Mpgo.exe) will install optimized native images.</span></span>

## <a name="suggested-workflow"></a><span data-ttu-id="19dfe-209">Предлагаемый рабочий процесс</span><span class="sxs-lookup"><span data-stu-id="19dfe-209">Suggested Workflow</span></span>

1. <span data-ttu-id="19dfe-210">Создайте набор оптимизированных IL-сборок, используя средство Mpgo.exe с параметром `–Scenario`.</span><span class="sxs-lookup"><span data-stu-id="19dfe-210">Create a set of optimized IL assemblies by using Mpgo.exe with the `–Scenario` parameter.</span></span>

2. <span data-ttu-id="19dfe-211">Проверьте оптимизированные IL-сборки в системе управления версиями.</span><span class="sxs-lookup"><span data-stu-id="19dfe-211">Check the optimized IL assemblies into source control.</span></span>

3. <span data-ttu-id="19dfe-212">После выполнения сборки вызовите Mpgo.exe с параметром `–Import`, чтобы создать оптимизированные IL-образы, передаваемые в Ngen.exe.</span><span class="sxs-lookup"><span data-stu-id="19dfe-212">In the build process, call Mpgo.exe with the `–Import` parameter as a post-build step to generate optimized IL images to pass to Ngen.exe.</span></span>

 <span data-ttu-id="19dfe-213">Этот процесс гарантирует, что все сборки будут содержать данные для оптимизации.</span><span class="sxs-lookup"><span data-stu-id="19dfe-213">This process ensures that all assemblies have optimization data.</span></span> <span data-ttu-id="19dfe-214">Если возвращать обновленные оптимизированные сборки (шаг 1 и 2) чаще, продукт будет иметь более стабильные показатели производительности при разработке.</span><span class="sxs-lookup"><span data-stu-id="19dfe-214">If you check in updated optimized assemblies (steps 1 and 2) more frequently, the performance numbers will be more consistent throughout product development.</span></span>

## <a name="using-mpgoexe-from-visual-studio"></a><span data-ttu-id="19dfe-215">Запуск Mpgo.exe в Visual Studio</span><span class="sxs-lookup"><span data-stu-id="19dfe-215">Using Mpgo.exe from Visual Studio</span></span>

 <span data-ttu-id="19dfe-216">Можно выполнять Mpgo.exe в Visual Studio (см. статью [Практическое руководство. Указание событий сборки (C#)](/visualstudio/ide/how-to-specify-build-events-csharp)) со следующими ограничениями:</span><span class="sxs-lookup"><span data-stu-id="19dfe-216">You can run Mpgo.exe from Visual Studio (see the article [How to: Specify Build Events (C#)](/visualstudio/ide/how-to-specify-build-events-csharp)) with the following restrictions:</span></span>

- <span data-ttu-id="19dfe-217">Нельзя использовать заключенные в кавычки пути с обратными косыми чертами, поскольку они по умолчанию они используются в макросах Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="19dfe-217">You cannot use quoted paths with trailing slash marks, because Visual Studio macros also use trailing slash marks by default.</span></span> <span data-ttu-id="19dfe-218">(Например, `–OutDir "C:\Output Folder\"` является недопустимым.) Чтобы обойти это ограничение, используйте альтернативную запись.</span><span class="sxs-lookup"><span data-stu-id="19dfe-218">(For example, `–OutDir "C:\Output Folder\"` is invalid.) To work around this restriction, you can escape the trailing slash.</span></span> <span data-ttu-id="19dfe-219">(Например, используйте `-OutDir "$(OutDir)\"`.)</span><span class="sxs-lookup"><span data-stu-id="19dfe-219">(For example, use `-OutDir "$(OutDir)\"` instead.)</span></span>

- <span data-ttu-id="19dfe-220">По умолчанию Mpgo.exe не находится на пути сборки Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="19dfe-220">By default, Mpgo.exe is not on the Visual Studio build path.</span></span> <span data-ttu-id="19dfe-221">Необходимо либо добавить путь в Visual Studio, либо указать полный путь в командной строке средства.</span><span class="sxs-lookup"><span data-stu-id="19dfe-221">You must either add the path to Visual Studio or specify the full path on the Mpgo command line.</span></span> <span data-ttu-id="19dfe-222">В Visual Studio в событиях после сборки можно использовать как параметр `–Scenario`, так и параметр `–Import`.</span><span class="sxs-lookup"><span data-stu-id="19dfe-222">You can use either the `–Scenario` or the `–Import` parameter in the post-build event in Visual Studio.</span></span> <span data-ttu-id="19dfe-223">Однако, как правило, один раз в командной строке разработчика для Visual Studio используется параметр `–Scenario`, а затем для обновления оптимизированных сборок после каждой сборки используется параметр `–Import`. Пример: `"C:\Program Files\Microsoft Visual Studio 11.0\Team Tools\Performance Tools\mpgo.exe" -import "$(OutDir)tmp" -assemblylist "$(TargetPath)" -outdir "$(OutDir)\"`.</span><span class="sxs-lookup"><span data-stu-id="19dfe-223">However, the typical process is to use `–Scenario` one time from a Developer Command Prompt for Visual Studio, and then use `–Import` to update the optimized assemblies after each build; for example:  `"C:\Program Files\Microsoft Visual Studio 11.0\Team Tools\Performance Tools\mpgo.exe" -import "$(OutDir)tmp" -assemblylist "$(TargetPath)" -outdir "$(OutDir)\"`.</span></span>

<a name="samples"></a>

## <a name="examples"></a><span data-ttu-id="19dfe-224">Примеры</span><span class="sxs-lookup"><span data-stu-id="19dfe-224">Examples</span></span>

 <span data-ttu-id="19dfe-225">Следующая команда Mpgo.exe в командной строке разработчика для Visual Studio оптимизирует приложение для подсчета налогов:</span><span class="sxs-lookup"><span data-stu-id="19dfe-225">The following Mpgo.exe command from a Developer Command Prompt for Visual Studio optimizes a tax application:</span></span>

```console
mpgo –scenario "C:\MyApp\MyTax.exe /params par" –AssemblyList Mytax.dll MyTaxUtil2011.dll –OutDir C:\Optimized –TimeOut 15
```

 <span data-ttu-id="19dfe-226">Следующая команда Mpgo.exe оптимизирует звуковое приложение:</span><span class="sxs-lookup"><span data-stu-id="19dfe-226">The following Mpgo.exe command optimizes a sound application:</span></span>

```console
mpgo –scenario "C:\MyApp\wav2wma.exe –input song1.wav –output song1.wma" –AssemblyList transcode.dll –OutDir C:\Optimized –TimeOut 15
```

 <span data-ttu-id="19dfe-227">Следующая команда Mpgo.exe использует данные из ранее оптимизированных сборок для оптимизации более новых версий сборок:</span><span class="sxs-lookup"><span data-stu-id="19dfe-227">The following Mpgo.exe command uses data from previously optimized assemblies to optimize newer versions of the assemblies:</span></span>

```console
mpgo.exe -import "C:\Optimized" -assemblylist "C:\MyApp\MyTax.dll" "C:\MyApp\MyTaxUtil2011.dll" -outdir C:\ReOptimized
```

## <a name="see-also"></a><span data-ttu-id="19dfe-228">См. также</span><span class="sxs-lookup"><span data-stu-id="19dfe-228">See also</span></span>

- [<span data-ttu-id="19dfe-229">Ngen.exe (генератор образов в машинном коде)</span><span class="sxs-lookup"><span data-stu-id="19dfe-229">Ngen.exe (Native Image Generator)</span></span>](ngen-exe-native-image-generator.md)
- [<span data-ttu-id="19dfe-230">Оболочки командной строки для разработчиков</span><span class="sxs-lookup"><span data-stu-id="19dfe-230">Developer command-line shells</span></span>](/visualstudio/ide/reference/command-prompt-powershell)
- [<span data-ttu-id="19dfe-231">Повышение производительности при запуске классических приложений</span><span class="sxs-lookup"><span data-stu-id="19dfe-231">Improving Launch Performance for your Desktop Applications</span></span>](https://devblogs.microsoft.com/dotnet/improving-launch-performance-for-your-desktop-applications/)
- [<span data-ttu-id="19dfe-232">Обзор средств повышения производительности в .NET Framework4.5</span><span class="sxs-lookup"><span data-stu-id="19dfe-232">An Overview of Performance Improvements in .NET Framework 4.5</span></span>](/archive/msdn-magazine/2012/april/clr-an-overview-of-performance-improvements-in-net-4-5)
