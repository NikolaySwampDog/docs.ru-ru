---
title: 'Критическое изменение. Blazor: Незначащие пробелы удалены из компонентов во время компиляции'
description: Сведения о критическом изменении в ASP.NET Core 5.0 — Blazor. Незначащие пробелы удалены из компонентов во время компиляции
ms.author: scaddie
ms.date: 10/01/2020
ms.openlocfilehash: d29171c43e587eba648de3f877e1cbb1c7156499
ms.sourcegitcommit: 089068389671f6f9e15fd67dcbfb0145bf72f1fb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/06/2021
ms.locfileid: "106498208"
---
# <a name="blazor-insignificant-whitespace-trimmed-from-components-at-compile-time"></a>Blazor: Незначащие пробелы удалены из компонентов во время компиляции

Начиная с ASP.NET Core 5.0, предварительная версия 7, компилятор Razor пропускает незначащий пробел в компонентах Blazor (*RAZOR*-файлах) во время компиляции. Обсуждение этого вопроса см. на странице [dotnet/aspnetcore#23568](https://github.com/dotnet/aspnetcore/issues/23568).

## <a name="version-introduced"></a>Представленная версия

5.0 (предварительная версия 7)

## <a name="old-behavior"></a>Старое поведение

В Blazor Server и Blazor WebAssembly версий 3.x символы пробела учитываются в исходном коде компонента. Текстовые узлы, состоящие только из пробелов, отображаются в модели DOM браузера даже при отсутствии визуального эффекта.

Рассмотрим следующий код компонента Blazor:

```razor
<ul>
    @foreach (var item in Items)
    {
        <li>
            @item.Text
        </li>
    }
</ul>
```

В предыдущем примере отображаются два узла пробелов:

* за пределами блока кода `@foreach`;
* вокруг элемента `<li>`;
* вокруг выходных данных `@item.Text`.

Список, содержащий 100 элементов, формирует 402 узла пробелов. Это более половины всех отображаемых узлов, хотя ни один из узлов пробелов не влияет на отображаемые выходные данные.

При отрисовке статического HTML для компонентов пробелы внутри тега не сохраняются. Например, просмотрите исходный код следующего компонента:

```razor
<foo        bar="baz"     />
```

Пробел не сохраняется. Предварительно преобразованные для просмотра выходные данные имеют следующий вид:

```razor
<foo bar="baz" />
```

## <a name="new-behavior"></a>Новое поведение

Если директива `@preservewhitespace` не используется со значением `true`, узлы пробелов удаляются в следующих случаях:

* они находятся в начале или конце элемента;
* они находятся в начале или конце параметра `RenderFragment`. Например, дочернее содержимое передается другому компоненту.
* они находятся в начале или конце блока кода C#, например `@if` и `@foreach`.

## <a name="reason-for-change"></a>Причина изменения

Платформа Blazor в ASP.NET Core 5.0 предназначена для повышения производительности визуализации и сравнения. Узлам дерева незначащих пробелов требовалось до 40 процентов времени отрисовки в тестах производительности.

## <a name="recommended-action"></a>Рекомендованное действие

В большинстве случаев визуальный макет отображаемого компонента не затрагивается. Однако при использовании правила CSS, такого как `white-space: pre`, удаление пробелов может повлиять на отображаемые выходные данные. Чтобы отключить эту оптимизацию производительности и сохранить пробелы, выполните одно из следующих действий.

* Добавьте директиву `@preservewhitespace true` в начало  *RAZOR*-файла, чтобы применить предпочтение к конкретному компоненту.
* Добавьте директиву `@preservewhitespace true` внутрь файла *_Imports.razor*, чтобы применить предпочтение ко всему подкаталогу или проекту целиком.

В большинстве случаев никаких действий не требуется, так как приложения обычно продолжают работать в обычном режиме (но быстрее). Если удаление пробелов приводит к возникновению проблем в конкретном компоненте, используйте `@preservewhitespace true` в этом компоненте, чтобы отключить эту оптимизацию.

## <a name="affected-apis"></a>Затронутые API

Отсутствуют

<!--

### Category

ASP.NET Core

### Affected APIs

Not detectable via API analysis

-->
