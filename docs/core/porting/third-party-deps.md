---
title: Анализ зависимостей для переноса кода
description: Сведения о том, как анализировать внешние зависимости для переноса проекта из .NET Framework в .NET.
author: cartermp
ms.date: 03/04/2021
ms.openlocfilehash: 4619243cf300e248be45e4b2a4d5541c3b3e1cb5
ms.sourcegitcommit: 46cfed35d79d70e08c313b9c664c7e76babab39e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102604922"
---
# <a name="analyze-your-dependencies-to-port-code-from-net-framework-to-net"></a><span data-ttu-id="a6ca2-103">Анализ зависимостей для переноса кода из .NET Framework в .NET</span><span class="sxs-lookup"><span data-stu-id="a6ca2-103">Analyze your dependencies to port code from .NET Framework to .NET</span></span>

<span data-ttu-id="a6ca2-104">Для переноса кода в .NET или .NET Standard требуется понимать существующие зависимости.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-104">To port your code to .NET or .NET Standard, you must understand your dependencies.</span></span> <span data-ttu-id="a6ca2-105">Внешними зависимостями являются пакеты NuGet или файлы `.dll`, на которые вы ссылаетесь в своем проекте, но не собираете.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-105">External dependencies are the NuGet packages or `.dll` files you reference in your project, but that you don't build yourself.</span></span>

<span data-ttu-id="a6ca2-106">Перенос кода в .NET Standard 2.0 или более ранней версии гарантирует, что его можно будет использовать как с .NET Framework, так и с .NET.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-106">Porting your code to .NET Standard 2.0 or below ensures that it can be used with both .NET Framework and .NET.</span></span> <span data-ttu-id="a6ca2-107">Но если вам не нужно использовать библиотеку с .NET Framework, рекомендуется ориентироваться на последнюю версию .NET.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-107">However, if you don't need to use the library with .NET Framework, consider targeting the latest version of .NET.</span></span>

## <a name="migrate-your-nuget-packages-to-packagereference"></a><span data-ttu-id="a6ca2-108">Перенос пакетов NuGet в `PackageReference`</span><span class="sxs-lookup"><span data-stu-id="a6ca2-108">Migrate your NuGet packages to `PackageReference`</span></span>

<span data-ttu-id="a6ca2-109">.NET не может использовать файл [_packages.config_](/nuget/reference/packages-config) для ссылок NuGet.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-109">.NET can't use the [_packages.config_](/nuget/reference/packages-config) file for NuGet references.</span></span> <span data-ttu-id="a6ca2-110">Как .NET, так и .NET Framework могут использовать [PackageReference](/nuget/consume-packages/package-references-in-project-files) для указания зависимостей пакета.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-110">Both .NET and .NET Framework can use [PackageReference](/nuget/consume-packages/package-references-in-project-files) to specify package dependencies.</span></span> <span data-ttu-id="a6ca2-111">Если вы используете файл _packages.config_ для указания пакетов в проекте, преобразуйте его в формат `PackageReference`.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-111">If you're using _packages.config_ to specify your packages in your project, convert it to the `PackageReference` format.</span></span>

<span data-ttu-id="a6ca2-112">Сведения о том, как выполнить миграцию, см. в статье [Преобразование packages.config в PackageReference](/nuget/reference/migrate-packages-config-to-package-reference).</span><span class="sxs-lookup"><span data-stu-id="a6ca2-112">To learn how to migrate, see the [Migrate from packages.config to PackageReference](/nuget/reference/migrate-packages-config-to-package-reference) article.</span></span>

## <a name="upgrade-your-nuget-packages"></a><span data-ttu-id="a6ca2-113">Обновление пакетов NuGet</span><span class="sxs-lookup"><span data-stu-id="a6ca2-113">Upgrade your NuGet packages</span></span>

<span data-ttu-id="a6ca2-114">После переноса проекта в формат `PackageReference` проверьте, совместимы ли пакеты с .NET.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-114">After you migrate your project to the `PackageReference` format, verify if your packages are compatible with .NET.</span></span>

<span data-ttu-id="a6ca2-115">Сначала обновите свои пакеты до последней доступной версии.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-115">First, upgrade your packages to the latest version that you can.</span></span> <span data-ttu-id="a6ca2-116">Это можно сделать с помощью пользовательского интерфейса диспетчера пакетов NuGet в Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-116">This can be done with the NuGet Package Manager UI in Visual Studio.</span></span> <span data-ttu-id="a6ca2-117">Скорее всего, новые версии зависимостей пакета уже совместимы с .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-117">It's likely that newer versions of your package dependencies are already compatible with .NET Core.</span></span>

## <a name="analyze-your-package-dependencies"></a><span data-ttu-id="a6ca2-118">Анализ зависимостей пакета</span><span class="sxs-lookup"><span data-stu-id="a6ca2-118">Analyze your package dependencies</span></span>

<span data-ttu-id="a6ca2-119">Если вы еще не проверили, что преобразованные и обновленные зависимости пакетов работают на .NET Core, существует несколько способов сделать это.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-119">If you haven't already verified that your converted and upgraded package dependencies work on .NET Core, there are a few ways that you can achieve that:</span></span>

### <a name="analyze-nuget-packages-using-nugetorg"></a><span data-ttu-id="a6ca2-120">Анализ пакетов NuGet с помощью сайта nuget.org</span><span class="sxs-lookup"><span data-stu-id="a6ca2-120">Analyze NuGet packages using nuget.org</span></span>

<span data-ttu-id="a6ca2-121">Вы можете просмотреть моникеры целевой платформы (TFM) на сайте [nuget.org](https://www.nuget.org/) в разделе **Зависимости** страницы пакета.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-121">You can see the Target Framework Monikers (TFMs) that each package supports on [nuget.org](https://www.nuget.org/) under the **Dependencies** section of the package page.</span></span>

<span data-ttu-id="a6ca2-122">С помощью этого сайта легко проверить совместимость, однако информация о **зависимостях** доступна не для всех пакетов.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-122">Although using the site is an easier method to verify the compatibility, **Dependencies** information isn't available on the site for all packages.</span></span>

### <a name="analyze-nuget-packages-using-nuget-package-explorer"></a><span data-ttu-id="a6ca2-123">Анализ пакетов NuGet с помощью обозревателя пакетов NuGet</span><span class="sxs-lookup"><span data-stu-id="a6ca2-123">Analyze NuGet packages using NuGet Package Explorer</span></span>

<span data-ttu-id="a6ca2-124">Пакет NuGet представляет собой набор папок со сборками для конкретных платформ.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-124">A NuGet package is itself a set of folders that contain platform-specific assemblies.</span></span> <span data-ttu-id="a6ca2-125">Проверьте, существует ли папка, которая содержит совместимую сборку внутри пакета.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-125">Check if there's a folder that contains a compatible assembly inside the package.</span></span>

<span data-ttu-id="a6ca2-126">Проще всего просматривать папки пакета NuGet с помощью инструмента [Обозреватель пакетов NuGet](https://github.com/NuGetPackageExplorer/NuGetPackageExplorer).</span><span class="sxs-lookup"><span data-stu-id="a6ca2-126">The easiest way to inspect NuGet package folders is to use the [NuGet Package Explorer](https://github.com/NuGetPackageExplorer/NuGetPackageExplorer) tool.</span></span> <span data-ttu-id="a6ca2-127">После установки выполните следующие действия, чтобы увидеть имена папок:</span><span class="sxs-lookup"><span data-stu-id="a6ca2-127">After installing it, use the following steps to see the folder names:</span></span>

1. <span data-ttu-id="a6ca2-128">Откройте обозреватель пакетов NuGet.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-128">Open the NuGet Package Explorer.</span></span>
2. <span data-ttu-id="a6ca2-129">Щелкните **Открыть пакет из веб-канала**.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-129">Click **Open package from online feed**.</span></span>
3. <span data-ttu-id="a6ca2-130">Выполните поиск по имени пакета.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-130">Search for the name of the package.</span></span>
4. <span data-ttu-id="a6ca2-131">Выберите имя пакета в результатах поиска и нажмите кнопку **Открыть**.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-131">Select the package name from the search results and click **open**.</span></span>
5. <span data-ttu-id="a6ca2-132">Разверните папку *lib* в правой части окна и просмотрите имена папок.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-132">Expand the *lib* folder on the right-hand side and look at folder names.</span></span>

<span data-ttu-id="a6ca2-133">Найдите папку с именами, используя один из следующих шаблонов: `netstandardX.Y`, `netX.Y` или `netcoreappX.Y`.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-133">Look for a folder with names using one the following patterns: `netstandardX.Y`, `netX.Y`, or `netcoreappX.Y`.</span></span>

<span data-ttu-id="a6ca2-134">Эти значения — [моникеры целевых платформ (TFM)](../../standard/frameworks.md), соответствующие версиям [.NET Standard](../../standard/net-standard.md), .NET и .NET Core, которые совместимы с .NET.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-134">These values are the [Target Framework Monikers (TFMs)](../../standard/frameworks.md) that map to versions of [.NET Standard](../../standard/net-standard.md), .NET, and .NET Core, which are all compatible with .NET.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6ca2-135">При просмотре TFM, поддерживаемых пакетом, обратите внимание, что моникеры TFM, отличающиеся от `netstandard*`, ориентируются на конкретную реализацию .NET, например .NET 5, .NET Core или .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-135">When looking at the TFMs that a package supports, note that a TFM other than `netstandard*` targets a specific implementation of .NET, such as .NET 5, .NET Core, or .NET Framework.</span></span> <span data-ttu-id="a6ca2-136">Начиная с .NET 5, моникер `net*` (без заданной операционной системы) фактически заменяет `netstandard*` как [переносимый целевой объект](../../standard/net-standard.md#net-5-and-net-standard).</span><span class="sxs-lookup"><span data-stu-id="a6ca2-136">Starting with .NET 5, the `net*` TFM (without an operating system designation) effectively replaces `netstandard*` as a [portable target](../../standard/net-standard.md#net-5-and-net-standard).</span></span> <span data-ttu-id="a6ca2-137">Например, `net5.0` ориентируется на область API .NET 5 и поддерживает разные платформы, но `net5.0-windows` ориентируется на область API .NET 5, реализованную в операционной системе Windows.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-137">For example, `net5.0` targets the .NET 5 API surface and is cross-platform friendly, but `net5.0-windows` targets the .NET 5 API surface as implemented on the Windows operating system.</span></span>

## <a name="net-framework-compatibility-mode"></a><span data-ttu-id="a6ca2-138">Режим совместимости .NET Framework</span><span class="sxs-lookup"><span data-stu-id="a6ca2-138">.NET Framework compatibility mode</span></span>

<span data-ttu-id="a6ca2-139">Анализ пакетов NuGet может показать, что они предназначены только для платформы .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-139">After analyzing the NuGet packages, you might find that they only target the .NET Framework.</span></span>

<span data-ttu-id="a6ca2-140">Начиная с .NET Standard 2.0, доступен режим совместимости .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-140">Starting with .NET Standard 2.0, the .NET Framework compatibility mode was introduced.</span></span> <span data-ttu-id="a6ca2-141">Этот режим совместимости позволяет проектам .NET Standard и .NET Core ссылаться на библиотеки .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-141">This compatibility mode allows .NET Standard and .NET Core projects to reference .NET Framework libraries.</span></span> <span data-ttu-id="a6ca2-142">Создание ссылок на библиотеки .NET Framework не работает для всех проектов, например, если библиотека использует API WPF, то делает возможным разблокировку множества сценариев переноса.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-142">Referencing .NET Framework libraries doesn't work for all projects, such as if the library uses Windows Presentation Foundation (WPF) APIs, but it does unblock many porting scenarios.</span></span>

<span data-ttu-id="a6ca2-143">Ссылаясь в своем проекте на пакеты NuGet, ориентирующиеся на .NET Framework, например [`Huitian.PowerCollections`](https://www.nuget.org/packages/Huitian.PowerCollections), вы получаете предупреждение об откате пакета ([NU1701](/nuget/reference/errors-and-warnings/nu1701)), как в следующем примере:</span><span class="sxs-lookup"><span data-stu-id="a6ca2-143">When you reference NuGet packages that target .NET Framework in your project, such as [`Huitian.PowerCollections`](https://www.nuget.org/packages/Huitian.PowerCollections), you get a package fallback warning ([NU1701](/nuget/reference/errors-and-warnings/nu1701)) similar to the following example:</span></span>

`NU1701: Package ‘Huitian.PowerCollections 1.0.0’ was restored using ‘.NETFramework,Version=v4.6.1’ instead of the project target framework ‘.NETStandard,Version=v2.0’. This package may not be fully compatible with your project.`

<span data-ttu-id="a6ca2-144">Это предупреждение отображается при добавлении пакета и каждый раз при выполнении сборки, чтобы вы обязательно протестировали этот пакет в своем проекте.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-144">That warning is displayed when you add the package and every time you build to make sure you test that package with your project.</span></span> <span data-ttu-id="a6ca2-145">Если проект работает надлежащим образом, можно отключить это предупреждение, изменив свойства пакета в Visual Studio или путем редактирования файла проекта в привычном редакторе кода вручную.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-145">If your project works as expected, you can suppress that warning by editing the package properties in Visual Studio or by manually editing the project file in your favorite code editor.</span></span>

<span data-ttu-id="a6ca2-146">Чтобы отключить это предупреждение путем редактирования файла проекта, найдите запись `PackageReference` для пакета, предупреждение для которого требуется отключить, и добавьте атрибут `NoWarn`.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-146">To suppress the warning by editing the project file, find the `PackageReference` entry for the package you want to suppress the warning for and add the `NoWarn` attribute.</span></span> <span data-ttu-id="a6ca2-147">Атрибут `NoWarn` принимает разделенный запятыми список всех идентификаторов предупреждений.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-147">The `NoWarn` attribute accepts a comma-separated list of all the warning IDs.</span></span> <span data-ttu-id="a6ca2-148">В следующем примере показано отключение предупреждения `NU1701` для пакета `Huitian.PowerCollections` путем редактирования файла проекта вручную:</span><span class="sxs-lookup"><span data-stu-id="a6ca2-148">The following example shows how to suppress the `NU1701` warning for the `Huitian.PowerCollections` package by editing your project file manually:</span></span>

```xml
<ItemGroup>
  <PackageReference Include="Huitian.PowerCollections" Version="1.0.0" NoWarn="NU1701" />
</ItemGroup>
```

<span data-ttu-id="a6ca2-149">Дополнительные сведения о том, как отключить предупреждения компилятора в Visual Studio, см. в разделе [Подавление предупреждений для пакетов NuGet](/visualstudio/ide/how-to-suppress-compiler-warnings#suppress-warnings-for-nuget-packages).</span><span class="sxs-lookup"><span data-stu-id="a6ca2-149">For more information on how to suppress compiler warnings in Visual Studio, see [Suppressing warnings for NuGet packages](/visualstudio/ide/how-to-suppress-compiler-warnings#suppress-warnings-for-nuget-packages).</span></span>

## <a name="if-nuget-packages-wont-run-on-net"></a><span data-ttu-id="a6ca2-150">Если пакеты NuGet не запускаются в .NET</span><span class="sxs-lookup"><span data-stu-id="a6ca2-150">If NuGet packages won't run on .NET</span></span>

<span data-ttu-id="a6ca2-151">Если пакет NuGet, от которого зависит ваш проект, не работает в .NET Core, можно предпринять ряд мер:</span><span class="sxs-lookup"><span data-stu-id="a6ca2-151">There are a few things you can do if a NuGet package you depend on doesn't run on .NET Core:</span></span>

- <span data-ttu-id="a6ca2-152">Если проект имеет открытый исходный код и размещается на каком либо ресурсе, наподобие GitHub, вы можете обратиться к разработчикам напрямую.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-152">If the project is open source and hosted somewhere like GitHub, you can engage the developers directly.</span></span>
- <span data-ttu-id="a6ca2-153">Вы можете обратитесь к автору непосредственно на [nuget.org](https://www.nuget.org/). Найдите пакет и нажмите кнопку **Связаться с владельцами** в левой стороне страницы пакета.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-153">You can contact the author directly on [nuget.org](https://www.nuget.org/). Search for the package and click **Contact Owners** on the left-hand side of the package's page.</span></span>
- <span data-ttu-id="a6ca2-154">Можно найти другой пакет, который будет выполнять те же функции и работать в .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-154">You can search for another package that runs on .NET Core that accomplishes the same task as the package you were using.</span></span>
- <span data-ttu-id="a6ca2-155">Вы можете попытаться создать пакет с аналогичным кодом самостоятельно.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-155">You can attempt to write the code the package was doing yourself.</span></span>
- <span data-ttu-id="a6ca2-156">Вы можете устранить зависимость от пакета, изменив функциональность приложения, по крайней мере до тех пор пока не станет доступна совместимая версия пакета.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-156">You could eliminate the dependency on the package by changing the functionality of your app, at least until a compatible version of the package becomes available.</span></span>

<span data-ttu-id="a6ca2-157">Помните, что обслуживанием проектов с открытым исходным кодом и выпуском пакетов NuGet часто занимаются волонтеры.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-157">Remember that open-source project maintainers and NuGet package publishers are often volunteers.</span></span> <span data-ttu-id="a6ca2-158">Они делают эту работу, потому что им важна соответствующая область деятельности, причем безвозмездно, часто в свободное от основной занятости время.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-158">They contribute because they care about a given domain, do it for free, and often have a different daytime job.</span></span> <span data-ttu-id="a6ca2-159">Помните об этом, обращаясь к ним за поддержкой при использовании пакетов .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-159">Be mindful of that when contacting them to ask for .NET Core support.</span></span>

<span data-ttu-id="a6ca2-160">Если ни один из этих способов не помог решить проблему, возможно, придется отложить перенос кода в .NET Core на более позднюю дату.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-160">If you can't resolve your issue with any of these options, you may have to port to .NET Core at a later date.</span></span>

<span data-ttu-id="a6ca2-161">Команда разработчиков .NET хотела бы узнать, поддержку каких библиотек в .NET Core следует реализовать в первую очередь.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-161">The .NET Team would like to know which libraries are the most important to support with .NET Core.</span></span> <span data-ttu-id="a6ca2-162">Сообщить о нужных вам библиотеках можно в электронном сообщении по адресу dotnet@microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-162">You can send an email to dotnet@microsoft.com about the libraries you'd like to use.</span></span>

## <a name="analyze-non-nuget-dependencies"></a><span data-ttu-id="a6ca2-163">Анализ зависимостей, не относящихся к NuGet</span><span class="sxs-lookup"><span data-stu-id="a6ca2-163">Analyze non-NuGet dependencies</span></span>

<span data-ttu-id="a6ca2-164">Возможно, вы используете зависимость, которая не является пакетом NuGet, например библиотеку DLL в файловой системе.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-164">You may have a dependency that isn't a NuGet package, such as a DLL in the file system.</span></span> <span data-ttu-id="a6ca2-165">Единственный способ определить переносимость такой зависимости — запустить [средство .NET Portability Analyzer](https://github.com/Microsoft/dotnet-apiport).</span><span class="sxs-lookup"><span data-stu-id="a6ca2-165">The only way to determine the portability of that dependency is to run the [.NET Portability Analyzer](https://github.com/Microsoft/dotnet-apiport) tool.</span></span> <span data-ttu-id="a6ca2-166">Это средство анализирует сборки, предназначенные для .NET Framework, и идентифицирует API, которые невозможно перенести на другие платформы .NET, например .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a6ca2-166">The tool analyzes assemblies that target the .NET Framework and identifies APIs that aren't portable to other .NET platforms such as .NET Core.</span></span> <span data-ttu-id="a6ca2-167">Можно запустить средство в качестве консольного приложения или [расширения Visual Studio](../../standard/analyzers/portability-analyzer.md).</span><span class="sxs-lookup"><span data-stu-id="a6ca2-167">You can run the tool as a console application or as a [Visual Studio extension](../../standard/analyzers/portability-analyzer.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="a6ca2-168">Следующие шаги</span><span class="sxs-lookup"><span data-stu-id="a6ca2-168">Next steps</span></span>

- [<span data-ttu-id="a6ca2-169">Общие сведения о переносе кода в .NET Framework из .NET</span><span class="sxs-lookup"><span data-stu-id="a6ca2-169">Overview of porting from .NET Framework to .NET</span></span>](index.md)
- [<span data-ttu-id="a6ca2-170">Перенос библиотек</span><span class="sxs-lookup"><span data-stu-id="a6ca2-170">Port libraries</span></span>](libraries.md)
