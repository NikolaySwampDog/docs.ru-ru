---
title: Развертывание современных классических приложений
description: Все, что нужно знать о развертывании современных классических приложений.
ms.date: 05/12/2020
ms.openlocfilehash: ba47f09b27adf270734bbfff285fe44dd4175d29
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "98615858"
---
# <a name="deploying-modern-desktop-applications"></a>Развертывание современных классических приложений

При разработке классических приложений необходимо учитывать, как ваше приложение будет упаковываться и развертываться на компьютерах пользователей. Проблема, связанная с упаковкой, развертыванием и установкой, заключается в том, что ими обычно занимаются исключительно ИТ-специалисты, которых волнуют совсем не те вещи, что и разработчиков.

Сегодня мы знакомы с концепцией DevOps, где разработчики и ИТ-специалисты тесно взаимодействуют друг с другом для переноса приложений в рабочие среды. Однако если вы занимаетесь разработкой классических приложений уже более 10 лет, то могли быть свидетелем следующей ситуации. Команда разработчиков усиленно трудится для соблюдения крайних сроков проекта. Руководители нервничают, так как для функционирования бизнеса им требуется система, работающая на множестве компьютеров пользователей. В день "Д" менеджер по проектам проверяет, правильно ли работает код каждого из разработчиков, чтобы можно было осуществлять доставку. Затем в работу включается команда упаковки, которая создает для приложения программу установки, распространяет ее на каждый компьютер пользователя, после чего группа тестовых пользователей запускает приложение. Ну, они пытаются, так как перед отображением пользовательского интерфейса приложение выдает исключение с сообщением "Сбой метода ~ объекта ~". В воздухе появляется напряженность, и небольшое исследование приводит к молодому и уставшему разработчику, который внес сторонний элемент управления, который определенно "работал на компьютере разработки".

Установка классических приложений всегда была настоящим кошмаром по двум основным причинам:

- Отсутствие культуры тесного сотрудничества между разработчиками и ИТ-специалистами.
- Отсутствие единой технологии упаковки и развертывания, на которую можно положиться.

На самом деле нам приходилось мириться с тем фактом, что установка приложения могла вызвать только сожаление, так как:

- На вашем компьютере в работе приложения возникают нежелательные побочные эффекты.
- Некоторые из установленных ранее приложений перестают работать.

Кроме того, вы не можете просто восстановить систему в исходное состояние путем удаления приложения. Мы постоянно сталкивались с подобной ситуацией, которую прозвали "DLL-путаницей", "захламлением" или "Winrot".

В этой главе мы поговорим о MSIX. MSIX — это новая технология от корпорации Майкрософт, которая стремится взять лучшее из предыдущих технологий, чтобы обеспечить надежную основу для технологии упаковки будущего.

Как технология упаковки связана с модернизацией? Оказалось, что упаковка является основополагающей для корпоративных ИТ-служб, и в нее вкладываются значительные средства. Модернизация не ограничивается использованием новейших технологий. Она также нацелена на сокращение времени выхода на рынок с момента определения бизнес-требования и до момента, когда ваша организация доставляет соответствующий компонент клиенту.

## <a name="the-modern-application-lifecycle"></a>Жизненный цикл современного приложения

Сейчас разработчики пишут и собирают код для приложения, после чего передают созданные ресурсы ИТ-специалистам. После этого ИТ-специалисты перестраивают приложение и переупаковывают его, как правило, в формате MSI или более новом App-V. Затем приложение развертывают с помощью различных каналов и средств. Одна из основных проблем такого подхода обычно называется 	"коллапсом упаковки". Проблема заключается в том, что этот цикл повторяется каждый раз при обновлении приложения или операционной системы.

Данный процесс проиллюстрирован на следующем рисунке:

![Схема, показывающая современный жизненный цикл ИТ](./media/deploy-modern-applications/modern-it-application-lifecycle.png)

Организациям требуется способ разбить этот цикл упаковки на три независимых цикла:

- Обновления ОС
- Обновления приложений
- Настройка

![Схема, показывающая современный эффективный цикл ИТ](./media/deploy-modern-applications/modern-it-virtuous-cycle.png)

На предыдущей схеме показано, что вам доступны следующие возможности:

- Обновление базовой ОС без необходимости переупаковки приложений.
- Реализация настроек со стороны ИТ-специалистов без необходимости переупаковки исходного пакета разработчика.

Это радикальное изменение приводит нас к новому и современному жизненному циклу ИТ, как показано на следующем рисунке:

![Схема, показывающая жизненный цикл приложения при использовании средств Майкрософт](./media/deploy-modern-applications/microsoft-it-tools.png)

Разработчики создают приложение и формируют пакет MSIX, который ИТ-специалисты могут использовать и настраивать без переупаковки. Вместе с технологией MSIX корпорация Майкрософт создала средства, позволяющие ИТ-специалистам настраивать пакеты без переупаковки.

## <a name="msix-the-next-generation-of-deployment"></a>MSIX: следующее поколение развертывания

До MSIX существовало несколько технологий упаковки, таких как мастера установки, MSI, ClickOnce, App-V и сценарии. Каждая из этих технологий имеет свои сильные стороны, и корпорация Майкрософт решила взять из них все лучшее для создания MSIX. Технология MSIX основана на этих существующих технологиях, вбирая в себя преимущества каждой из них:

- App-V =\> контейнеризация
- ClickOnce =\> автоматическое обновление
- MSI =\> простота распространения

Благодаря MSIX вы получаете одну технологию установщика со всеми этими функциями.

![Схема, показывающая различные технологии, которые оказывают влияние на создание MSIX](./media/deploy-modern-applications/msix.png)

### <a name="benefits-of-msix"></a>Преимущества gRPC

#### <a name="never-regret-installing-an-app"></a>Установка приложений без сожалений

MSIX обеспечивает предсказуемое, надежное и безопасное развертывание. Декларативный метод, содержащийся в манифесте пакета, позволяет операционной системе отслеживать каждый из ресурсов, необходимых приложению. Он также обеспечивает действительно чистое удаление без побочных эффектов.

#### <a name="disk-space-optimization"></a>Оптимизация дискового пространства

Технология MSIX оптимизирована для уменьшения места, занимаемого приложением на диске компьютера пользователя. Она создает хранилище единственных копий ваших файлов. То есть если у вас есть два разных пакета с одной и той же библиотекой DLL, она не устанавливается дважды. Платформа может решить эту проблему, так как она знает обо всех файлах, установленных конкретным приложением, благодаря своей декларативной природе. Она также позволяет использовать разные версии библиотеки DLL, работающие параллельно.

С помощью пакетов ресурсов можно легко создавать многоязычные приложения, и операционная система позаботится об установке нужных из них.

#### <a name="network-optimization"></a>Оптимизация сети

MSIX обнаруживает различия в файлах на уровне байтового блока, позволяя использовать функцию разностных обновлений. Это означает, что при обновлениях приложения скачиваются только обновленные байтовые блоки.

![Схема, показывающая, как MSIX управляет разностными обновлениями](./media/deploy-modern-applications/msix-managing-updates.png)

Благодаря потоковой установке пользователь может быстро начать работу над приложением, пока другие части приложения скачиваются в фоновом режиме. Эта функция влияет на вовлечение пользователей в работу.

С помощью дополнительных пакетов вы можете реализовать компонентное представление развертывания приложения, поэтому их можно скачивать по мере необходимости.

#### <a name="simple-packaging-and-deployment"></a>Простота упаковки и развертывания

Манифест приложения объявляет управление версиями, нацеливание устройств и обеспечивает идентификацию стандартным образом для каждого приложения. Он также позволяет подписывать активы, создавая надежную основу для системы безопасности.

#### <a name="os-managed"></a>Управляемая операционная система

Операционная система обрабатывает все процессы по установке, обновлению и удалению приложения. Приложения устанавливаются для отдельных пользователей, но скачиваются только один раз, что сводит к минимуму используемое дисковое пространство. Корпорация Майкрософт работает над предоставлением технологии MSIX также и в Windows 7.

#### <a name="windows-provides-integrity-for-the-app"></a>Обеспечение целостности приложения в Windows

Цифровые подписи позволяют гарантированно предотвратить установку приложения из ненадежных источников. Кроме того, система MSIX предотвращает незаконное изменение, поскольку:

- хранит записи о хэшах файлов;
- определяет, был ли файл изменен после установки.

#### <a name="works-for-the-entire-app-catalog"></a>Поддержка всего каталога приложений

Одним из самых интересных аспектов технологии MSIX является то, что она работает для всего каталога приложений, Windows Forms, WPF, MFC/ATL, Delphi, даже если вы хотите выполнить развертывание xCopy, используете ClickOnce или переходите в Store, вы можете использовать один и тот же пакет MSIX.

### <a name="tools"></a>Инструменты

#### <a name="windows-application-packaging-project"></a>Проект упаковки приложений Windows

Для создания пакета для классического приложения в Visual Studio можно использовать **Проект упаковки приложений Windows**. Затем можно опубликовать этот пакет в Microsoft Store или загрузить его в неопубликованном виде на один или несколько компьютеров.

#### <a name="msix-packaging-tool"></a>Средство упаковки MSIX

Средство упаковки MSIX позволяет повторно упаковывать существующие пакеты приложений Win32 в формате MSIX. Оно включает интерактивный пользовательский интерфейс и командную строку для преобразования, позволяя преобразовывать приложения без использования исходного кода.

![Средство упаковки MSIX](./media/deploy-modern-applications/msix-packaging-tool.png)

#### <a name="package-support-framework"></a>Платформа поддержки пакетов

Платформа поддержки пакетов представляет собой набор с открытым кодом, который помогает применять исправления к существующему приложению Win32, когда у вас нет доступа к исходному коду для работы в контейнере MSIX. Платформа поддержки пакетов помогает настроить приложения в соответствии с требованиями современных сред выполнения.

#### <a name="app-installer"></a>Установщик приложений

Установщик приложений позволяет устанавливать приложения Windows 10, дважды щелкнув пакет приложения. Это означает, что пользователям не нужно использовать PowerShell или другие средства разработчика для развертывания приложений Windows 10. Кроме того, Установщик приложений может устанавливать приложения из Интернета, дополнительных пакетов и связанных наборов.

## <a name="how-to-create-an-msix-package-from-an-existing-win32-desktop-application"></a>Создание пакета MSIX из существующего классического приложения Win32

Давайте рассмотрим процесс создания пакета MSIX из существующего классического приложения Win32. В этом примере мы будем использовать приложение Windows Forms.

Чтобы начать, добавьте в решение новый проект, выберите "Проект упаковки приложений Windows" и присвойте ему имя.

![Добавление нового Проекта упаковки приложений Windows](./media/deploy-modern-applications/add-packaging-project.png)

Вы увидите структуру проекта упаковки и заметите специальную папку *Applications*. В ней можно указать приложения, которые требуется включить в пакет. Их может быть несколько.

![Структура проекта упаковки](./media/deploy-modern-applications/packaging-project.png)

Щелкните правой кнопкой мыши папку *Applications* и выберите проект Windows Forms, который хотите упаковать из решения Visual Studio.

![Добавление проекта Windows Forms в проект упаковки](./media/deploy-modern-applications/add-winforms-project.png)

На этом этапе вы можете скомпилировать и создать пакет, но давайте рассмотрим несколько аспектов. Чтобы улучшить взаимодействие с пользователем, Visual Studio может автоматически создавать все визуальные ресурсы, необходимые современным приложениям для работы со значками, а также ресурсы плиток для панели плиток и меню "Пуск". Откройте файл *Package.appxmanifest* для доступа к конструктору манифеста. После этого вы можете создать все визуальные ресурсы из заданного образа, присутствующего в проекте, просто нажав кнопку **Создать**.

![Снимок экрана конструктора манифеста в Visual Studio](./media/deploy-modern-applications/manifest-designer.png)

Если открыть код для файла *Package.appxmanifest*, можно увидеть несколько интересных вещей.

Непосредственно под узлом `<Package>` находится узел `<Identity>`. Именно здесь упакованное приложение получит удостоверение, которым будет управлять операционная система.

![Узел "Identity"](./media/deploy-modern-applications/identity-node.png)

В узле `<Capabilities>` можно найти все требования, необходимые приложению, обращая особое внимание на элемент `<rescap:Capability Name="runFullTrust" \>`, который предписывает операционной системе запустить приложение в режиме полного доверия, так как это приложение Win32.

![Узел "Capabilities"](./media/deploy-modern-applications/capabilities-node.png)

Задайте проект упаковки в качестве запускаемого проекта для решения и выберите *Выполнить*. Будут выполнены следующие операции:

- Компиляция приложения Windows Forms.
- Создание пакета MSIX из результатов сборки.
- Развертывание пакетов.
- Локальная установка на компьютере разработки.
- запуск приложения;

![Наше установленное приложение](./media/deploy-modern-applications/our-installed-application.png)

Благодаря этому вы получаете чистую процедуру установки и удаления, которую MSIX полностью интегрирует в Windows 10.

Последним этапом является развертывание пакета MSIX на другом компьютере.

Щелкните проект упаковки правой кнопкой мыши, выберите меню **Store** и затем параметр **Создание пакетов приложения**.

После этого вы можете выбрать, будете ли вы создавать пакет для отправки в Store или создавать пакеты для загрузки неопубликованных приложений. В большинстве сценариев модернизации вы выберете **Я хочу создать пакеты для загрузки неопубликованных приложений**.

![Настройка пакетов](./media/deploy-modern-applications/configuring-packages.png)

В этом случае можно выбрать различные архитектуры, на которые нужно ориентироваться, так как в один пакет MSIX можно включить любое число архитектур.

Последним шагом является объявление того, где вы хотите развернуть окончательные ресурсы установки.

![Настройка параметров обновления](./media/deploy-modern-applications/configure-update-settings.png)

Вы можете использовать веб-сервер из общего UNC-пути на файловых серверах предприятия. Обратите особое внимание на параметры, позволяющие указать способ обновления приложения. Обновления мы рассмотрим в следующем разделе.

Подробное пошаговое руководство см. в разделе [Упаковка классического приложения из исходного кода с помощью Visual Studio](/windows/msix/desktop/desktop-to-uwp-packaging-dot-net).

## <a name="auto-updates-in-msix"></a>Автоматические обновления в MSIX

В Microsoft Store есть отличный механизм обновления, использующий Центр обновления Windows. В большинстве корпоративных сценариев магазин Store для распространения классических приложений не используется. Поэтому вам нужен аналогичный способ настройки обновлений для приложения и отправки их пользователям.

Используя сочетание функций Windows 10 и пакетов MSIX, вы можете предоставить пользователям удобную процедуру обновления. Фактически пользователь может совершенно не разбираться в технических аспектах, но при этом пользоваться преимуществами беспрепятственного обновления приложения.

Вы можете настроить обновление для взаимодействия с пользователем двумя разными способами:

- Обновления, запрошенные пользователем: операционная система отображает автоматически сформированный удобный пользовательский интерфейс для уведомления пользователя о том, что приложение готово к установке. Этот пользовательский интерфейс создается на основе свойств, указанных вами в файлах установки.

- Автоматические обновления в фоновом режиме: в этом случае пользователям не нужно знать об обновлениях.

Вы также можете настроить время выполнения обновлений — при запуске приложения или на регулярной основе. Благодаря функциям загрузки неопубликованных приложений эти обновления можно получать даже во время работы приложения.

При использовании этого типа развертывания создается специальный файл *APPINSTALLER*. Этот простой файл состоит из следующих разделов:

- Расположение файла *APPINSTALLER*
- Основные свойства пакета MSIX приложения
- Поведение при обновлении

![Файл APPINSTALLER](./media/deploy-modern-applications/appinstaller-file.png)

Совместно с этим файлом корпорация Майкрософт разработала специальный протокол URL-адресов для запуска процесса установки по ссылке:

```xml
<a href="ms-appinstaller:?source=http://mywebservice.azureedge.net/MyApp.msix">Install app package </a>
```

Этот протокол работает во всех браузерах и запускает процесс установки в Windows 10 удобным для пользователя образом. Так как операционная система управляет процессом установки, она учитывает расположение, из которого было установлено это приложение, и отслеживает все файлы, затронутые этим процессом.

MSIX создает пользовательский интерфейс для автоматической установки, отображая некоторые свойства пакета. Это обеспечивает единый процесс установки для каждого приложения.

После создания пакета MSIX и его перемещения на сервер развертывания вам нужно просто изменить файл *APPINSTALLER*, чтобы отразить эти изменения, главным образом версию и путь нового файла MSIX. Когда пользователь запустит приложение в следующий раз, система обнаружит изменение и скачает файлы для новой версии в фоновом режиме. После этого установка при запуске приложения будет осуществляться незаметно для пользователя.

>[!div class="step-by-step"]
>[Назад](example-migration.md)
