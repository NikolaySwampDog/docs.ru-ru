---
title: Миграция Windows 10
description: Углубитесь в рассмотрение таких функций Windows 10, как упаковка и XAML Islands.
ms.date: 12/29/2020
ms.openlocfilehash: 139a8f2354803dafeb0178b4dbfb57a95c4ddb34
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2021
ms.locfileid: "98615949"
---
# <a name="windows-10-migration"></a><span data-ttu-id="39c69-103">Миграция Windows 10</span><span class="sxs-lookup"><span data-stu-id="39c69-103">Windows 10 migration</span></span>

<span data-ttu-id="39c69-104">Рассмотрим следующую ситуацию: у вас есть рабочее настольное приложение, разработанное в дни Windows 7.</span><span class="sxs-lookup"><span data-stu-id="39c69-104">Consider the following situation: You have a working desktop application that was developed in the Windows 7 days.</span></span> <span data-ttu-id="39c69-105">Он использует технологию WPF, которая была доступной в тот момент, и работает нормально, но у него устарели пользовательский интерфейс и поведение при запуске в Windows 10.</span><span class="sxs-lookup"><span data-stu-id="39c69-105">It's using WPF technology available at that time and working fine but it has an outdated UI and behaviors when you run it on Windows 10.</span></span> <span data-ttu-id="39c69-106">Это примерно как когда вы смотрите футуристический фильм, вроде "Матрицы", и видите Нео с телефоном Nokia 8110.</span><span class="sxs-lookup"><span data-stu-id="39c69-106">It is like when you watch a futuristic movie like Matrix and you see Neo using the Nokia 8110 device.</span></span> <span data-ttu-id="39c69-107">Фильм и спустя 20 лет смотрится неплохо, но Нео не помешало бы использовать устройство поновее.</span><span class="sxs-lookup"><span data-stu-id="39c69-107">The film works great after 20 years but it would rather benefit from a device modernization.</span></span>

<span data-ttu-id="39c69-108">С выпуском Windows 10 корпорация Майкрософт представила множество нововведений для поддержки таких сценариев, как планшеты и сенсорные устройства, и обеспечения оптимального взаимодействия для пользователей операционной системы Майкрософт.</span><span class="sxs-lookup"><span data-stu-id="39c69-108">With the release of Windows 10, Microsoft introduced many innovations to support scenarios like tablets and touch devices and to provide the best experience for users for a Microsoft operating system ever.</span></span> <span data-ttu-id="39c69-109">Например, вы можете:</span><span class="sxs-lookup"><span data-stu-id="39c69-109">For example, you can:</span></span>

- <span data-ttu-id="39c69-110">Войдите с помощью Windows Hello, используя свое лицо.</span><span class="sxs-lookup"><span data-stu-id="39c69-110">Sign in with your face using Windows Hello.</span></span>
- <span data-ttu-id="39c69-111">Используйте перо, чтобы рисовать или вводить текст, который автоматически распознается и преобразуется в цифровую форму.</span><span class="sxs-lookup"><span data-stu-id="39c69-111">Use a pen to draw or handwrite text that is automatically recognized and digitalized.</span></span>
- <span data-ttu-id="39c69-112">Запускайте локально настроенные модели AI, созданные в облаке, с помощью WinML.</span><span class="sxs-lookup"><span data-stu-id="39c69-112">Run locally customized AI models built on the cloud using WinML.</span></span>

<span data-ttu-id="39c69-113">Все эти функции предлагаются разработчикам Windows через библиотеки среды выполнения Windows (WinRT).</span><span class="sxs-lookup"><span data-stu-id="39c69-113">All these features are enabled for Windows developers through Windows Runtime (WinRT) libraries.</span></span> <span data-ttu-id="39c69-114">Вы можете пользоваться этими функциями в существующих классических приложениях, поскольку библиотеки также доступны как для платформы .NET Framework, так и для .NET.</span><span class="sxs-lookup"><span data-stu-id="39c69-114">You can take advantage of these features in your existing desktop apps because the libraries are exposed to both the .NET Framework and .NET as well.</span></span> <span data-ttu-id="39c69-115">Вы даже можете модернизировать пользовательский интерфейс, используя XAML Islands, а также приводя визуальные элементы и поведение приложений в соответствии со временем.</span><span class="sxs-lookup"><span data-stu-id="39c69-115">You can even modernize your UI with the use of XAML Islands and improve the visuals and behavior of your apps according to the times.</span></span>

<span data-ttu-id="39c69-116">Важно отметить, что нет необходимости отказываться от технологии .NET Framework, чтобы следовать этому пути модернизации.</span><span class="sxs-lookup"><span data-stu-id="39c69-116">One important thing to note here is that you don't need to abandon .NET Framework technology to follow this modernization path.</span></span> <span data-ttu-id="39c69-117">Вы можете спокойно остаться на этой платформе, чтобы пользоваться всеми преимуществами Windows 10, нет необходимости переходить на .NET.</span><span class="sxs-lookup"><span data-stu-id="39c69-117">You can safely stay on there and have all the benefits of Windows 10 without the pressure to migrate to .NET.</span></span> <span data-ttu-id="39c69-118">Таким образом, вы получаете как большие возможности, так и гибкость при выборе пути модернизации.</span><span class="sxs-lookup"><span data-stu-id="39c69-118">So, you get both the power and the flexibility to choose your modernization path.</span></span>

## <a name="winrt-apis"></a><span data-ttu-id="39c69-119">API WinRT</span><span class="sxs-lookup"><span data-stu-id="39c69-119">WinRT APIs</span></span>

<span data-ttu-id="39c69-120">Интерфейсы API WinRT представляют собой объектно-ориентированные и хорошо структурированные прикладные программные интерфейсы (API), предоставляющие разработчикам Windows 10 доступ ко всему, что предлагает операционная система.</span><span class="sxs-lookup"><span data-stu-id="39c69-120">WinRT APIs are object-oriented, well-structured application programming interfaces (APIs) that give Windows 10 developers access to everything the operating system has to offer.</span></span> <span data-ttu-id="39c69-121">Через API-интерфейсы WinRT можно интегрировать такие функции, как push-уведомления, API-интерфейсы устройств, Microsoft Ink и WinML, среди прочих настольных приложений.</span><span class="sxs-lookup"><span data-stu-id="39c69-121">Through WinRT APIs, you can integrate functionalities like Push Notifications, Device APIs, Microsoft Ink, and WinML, among others on your desktop apps.</span></span>

<span data-ttu-id="39c69-122">Как правило, API-интерфейсы WinRT можно вызывать из классического приложения для настольных систем.</span><span class="sxs-lookup"><span data-stu-id="39c69-122">In general, WinRT APIs can be called from a classic desktop app.</span></span> <span data-ttu-id="39c69-123">Тем не менее две основные области представляют исключение из этого правила:</span><span class="sxs-lookup"><span data-stu-id="39c69-123">However, two main areas present an exception to this rule:</span></span>

* <span data-ttu-id="39c69-124">API, для которых требуется удостоверение пакета.</span><span class="sxs-lookup"><span data-stu-id="39c69-124">APIs that require a package identity.</span></span>
* <span data-ttu-id="39c69-125">API, для которых требуется визуализация, например XAML или Композиция.</span><span class="sxs-lookup"><span data-stu-id="39c69-125">APIs that require visualization like XAML or Composition.</span></span>

### <a name="universal-windows-platform-uwp-packages"></a><span data-ttu-id="39c69-126">Пакеты универсальной платформы Windows (UWP)</span><span class="sxs-lookup"><span data-stu-id="39c69-126">Universal Windows Platform (UWP) packages</span></span>

#### <a name="application-package-identity"></a><span data-ttu-id="39c69-127">Удостоверение пакета приложения</span><span class="sxs-lookup"><span data-stu-id="39c69-127">Application Package Identity</span></span>

<span data-ttu-id="39c69-128">Приложения UWP имеют систему развертывания, в которой операционная система управляет установкой и удалением приложений.</span><span class="sxs-lookup"><span data-stu-id="39c69-128">UWP apps have a deployment system where the OS manages the installation and uninstallation of application.</span></span> <span data-ttu-id="39c69-129">Для этого требуется декларативная установка, а это означает, что во время установки не выполняется пользовательский код.</span><span class="sxs-lookup"><span data-stu-id="39c69-129">That requires the installation to be declarative, meaning that no user code is executed during install.</span></span> <span data-ttu-id="39c69-130">Вместо этого все, что приложение хочет интегрировать с системой, например протоколы, типы файлов и расширения, объявляется в манифесте приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-130">Instead, everything the app wants to integrate with the system, such as protocols, file types, and extensions, is declared in the application manifest.</span></span> <span data-ttu-id="39c69-131">Во время развертывания конвейер развертывания настраивает эти точки интеграции.</span><span class="sxs-lookup"><span data-stu-id="39c69-131">At deployment time, the deployment pipeline configures those integration points.</span></span> <span data-ttu-id="39c69-132">Единственный способ, которым операционная система может управлять всеми этими функциями и контролировать их, заключается в том, что каждый "пакет" имеет удостоверение, уникальный идентификатор приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-132">The only way for the OS to manage all this functionality and keep track of it is for each 'package' to have an identity, a unique identifier for the application.</span></span>

<span data-ttu-id="39c69-133">Некоторые API-интерфейсы WinRT нуждаются в этом удостоверении пакета, чтобы работать должным образом.</span><span class="sxs-lookup"><span data-stu-id="39c69-133">Some WinRT APIs require this package identity to work as expected.</span></span> <span data-ttu-id="39c69-134">Однако классические настольные приложения, такие как собственные приложения C++ или .NET, используют различные системы развертывания, для которых не требуется удостоверение пакета.</span><span class="sxs-lookup"><span data-stu-id="39c69-134">However, classic desktop apps like native C++ or .NET apps, use different deployment systems that don't require a package identity.</span></span> <span data-ttu-id="39c69-135">Если вы хотите использовать эти API-интерфейсы WinRT в настольном приложении, необходимо предоставить им удостоверение пакета.</span><span class="sxs-lookup"><span data-stu-id="39c69-135">If you want to use these WinRT APIs in your desktop application, you need to provide them a package identity.</span></span>

<span data-ttu-id="39c69-136">Один из способов продолжить — создать дополнительный проект упаковки.</span><span class="sxs-lookup"><span data-stu-id="39c69-136">One way to proceed is to build an additional packaging project.</span></span> <span data-ttu-id="39c69-137">Внутри проекта упаковки укажите исходный проект исходного кода и укажите сведения об удостоверении, которые необходимо предоставить.</span><span class="sxs-lookup"><span data-stu-id="39c69-137">Inside the packaging project, you point to the original source code project and specify the Identity information you want to provide.</span></span> <span data-ttu-id="39c69-138">Если вы устанавливаете пакет и запускаете установленное приложение, оно автоматически получает идентификацию, позволяющую коду вызывать все API-интерфейсы WinRT, для которых требуется удостоверение.</span><span class="sxs-lookup"><span data-stu-id="39c69-138">If you install the package and run the installed app, it will automatically get an identify enabling your code to call all WinRT APIs requiring Identity.</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<Package xmlns="http://schemas.microsoft.com/appx/manifest/foundation/windows10"
         xmlns:uap="http://schemas.microsoft.com/appx/manifest/uap/windows10">
    <Identity Name="YOUR-APP-GUID "
              Publisher="CN=YOUR COMPANY"
              Version="1.x.x.x" />
</Package>
```

<span data-ttu-id="39c69-139">Вы можете проверить, какие API требуют удостоверения упакованного приложения, посмотрев, помечен ли тип, содержащий API, атрибутом [DualApiPartition](xref:Windows.Foundation.Metadata.DualApiPartitionAttribute).</span><span class="sxs-lookup"><span data-stu-id="39c69-139">You can check which APIs need a packaged application identity by inspecting if the type that contains the API is marked with the [DualApiPartition](xref:Windows.Foundation.Metadata.DualApiPartitionAttribute) attribute.</span></span> <span data-ttu-id="39c69-140">Если это так, его можно вызвать из неупакованного традиционного настольного приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-140">If it is, you can call if from an unpackaged traditional desktop app.</span></span> <span data-ttu-id="39c69-141">В противном случае вы должны преобразовать классическое настольное приложение в UWP с помощью проекта упаковки.</span><span class="sxs-lookup"><span data-stu-id="39c69-141">Otherwise, you must convert your classic desktop app to a UWP with the help of a packaging project.</span></span>

<https://docs.microsoft.com/windows/desktop/apiindex/uwp-apis-callable-from-a-classic-desktop-app>

#### <a name="benefits-of-packaging"></a><span data-ttu-id="39c69-142">Преимущества упаковки</span><span class="sxs-lookup"><span data-stu-id="39c69-142">Benefits of packaging</span></span>

<span data-ttu-id="39c69-143">Помимо доступа к этим API, вы получаете дополнительные преимущества, создавая пакет приложения Windows для настольного приложения, в том числе:</span><span class="sxs-lookup"><span data-stu-id="39c69-143">Besides giving you access to these APIs, you get some additional benefits by creating a Windows App package for your desktop application including:</span></span>

* <span data-ttu-id="39c69-144">**Упрощенное развертывание**.</span><span class="sxs-lookup"><span data-stu-id="39c69-144">**Streamlined deployment**.</span></span> <span data-ttu-id="39c69-145">Приложения очень удобны в развертывании, гарантируя, что пользователи могут уверенно устанавливать приложение и обновлять его.</span><span class="sxs-lookup"><span data-stu-id="39c69-145">Apps have a great deployment experience ensuring that users can confidently install an application and update it.</span></span> <span data-ttu-id="39c69-146">Если пользователь решает удалить приложение, оно удаляется полностью и без следа, что позволяет предотвратить проблему замусоривания Windows.</span><span class="sxs-lookup"><span data-stu-id="39c69-146">If a user chooses to uninstall the app, it's removed completely with no trace left behind preventing the Windows rot problem.</span></span>

* <span data-ttu-id="39c69-147">**Автоматическое обновление и лицензирование**.</span><span class="sxs-lookup"><span data-stu-id="39c69-147">**Automatic updates and licensing**.</span></span> <span data-ttu-id="39c69-148">Приложение может пользоваться встроенными средствами лицензирования и автоматического обновления Microsoft Store.</span><span class="sxs-lookup"><span data-stu-id="39c69-148">Your application can participate in the Microsoft Store's built-in licensing and automatic update facilities.</span></span> <span data-ttu-id="39c69-149">Автоматическое обновление — очень надежный и эффективный механизм, поскольку загружаются только измененные части файлов.</span><span class="sxs-lookup"><span data-stu-id="39c69-149">Automatic update is a highly reliable and efficient mechanism, because only the changed parts of files are downloaded.</span></span>

* <span data-ttu-id="39c69-150">**Увеличение аудитории и упрощение монетизации**.</span><span class="sxs-lookup"><span data-stu-id="39c69-150">**Increased reach and simplified monetization**.</span></span> <span data-ttu-id="39c69-151">Возможно это не ваш случай, но если вы решите распространить свое приложение с помощью Microsoft Store, вы сможете представить его миллионам пользователей Windows 10.</span><span class="sxs-lookup"><span data-stu-id="39c69-151">Maybe not your case but if you choose to distribute your application through the Microsoft Store you reach millions of Windows 10 users.</span></span>

* <span data-ttu-id="39c69-152">**Добавление возможностей UWP**.</span><span class="sxs-lookup"><span data-stu-id="39c69-152">**Add UWP features**.</span></span> <span data-ttu-id="39c69-153">Вы можете добавить функции UWP в пакет приложения в удобном для вас темпе.</span><span class="sxs-lookup"><span data-stu-id="39c69-153">You can add UWP features to your app's package at your own pace.</span></span>

#### <a name="prepare-for-packaging"></a><span data-ttu-id="39c69-154">Подготовка к упаковке</span><span class="sxs-lookup"><span data-stu-id="39c69-154">Prepare for packaging</span></span>

<span data-ttu-id="39c69-155">Прежде чем приступить к упаковке приложения для настольных систем, необходимо разобраться с некоторыми моментами, прежде чем начинать процесс.</span><span class="sxs-lookup"><span data-stu-id="39c69-155">Before proceeding to package your desktop application, there are some points you have to address before starting the process.</span></span> <span data-ttu-id="39c69-156">Приложение должно учитывать все правила и политики Microsoft Store и работать в модели приложений UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-156">Your application must respect any of the Microsoft Store rules and policies and run in the UWP application model.</span></span> <span data-ttu-id="39c69-157">Например, оно должно работать на платформе .NET Framework 4.6.2 или более поздней версии и записывать в куст реестра `HKEY_CURRENT_USER`, а папки AppData будут виртуализированы в локальное расположение приложения, определяемое пользователем.</span><span class="sxs-lookup"><span data-stu-id="39c69-157">For example, it has to run on the .NET Framework 4.6.2 or later and writes to the `HKEY_CURRENT_USER` registry hive and the AppData folders will be virtualized to a user-specific app-local location.</span></span>

<span data-ttu-id="39c69-158">Целью разработки упаковки является отделение состояния приложения от состояния системы, при сохранении совместимости с другими приложениями.</span><span class="sxs-lookup"><span data-stu-id="39c69-158">The design goal for packaging is to separate the application state from system state while maintaining compatibility with other apps.</span></span> <span data-ttu-id="39c69-159">Windows 10 достигает этой цели, помещая приложение в пакет UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-159">Windows 10 accomplishes this goal by placing the application inside a UWP package.</span></span> <span data-ttu-id="39c69-160">Она обнаруживает и перенаправляет некоторые изменения в файловой системе и реестре во время выполнения, чтобы выполнить обещание надежных и чистых установки и удаления приложения, которые дает упаковка.</span><span class="sxs-lookup"><span data-stu-id="39c69-160">It detects and redirects some changes to the file system and registry at run time to fulfill the promise of a trusted and clean install and uninstall behavior of an application provided by packaging.</span></span>

<span data-ttu-id="39c69-161">Пакеты, создаваемые для настольного приложения, являются неизолированными приложениями с полным доверием только для настольных систем, хотя к приложениям применяется упрощенная виртуализация для операций записи в `HKCU` и `AppData`.</span><span class="sxs-lookup"><span data-stu-id="39c69-161">Packages that you create for your desktop application are desktop-only, full-trust applications that aren't sandboxed, although there's lightweight virtualization applied to the app for writes to `HKCU` and `AppData`.</span></span> <span data-ttu-id="39c69-162">Эта виртуализация позволяет им взаимодействовать с другими приложениями так же, как и классические приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-162">This virtualization allows them to interact with other apps the same way classic desktop applications do.</span></span>

##### <a name="installation"></a><span data-ttu-id="39c69-163">Установка</span><span class="sxs-lookup"><span data-stu-id="39c69-163">Installation</span></span>

<span data-ttu-id="39c69-164">Пакеты приложений устанавливаются в папке *%ProgramFiles%\\WindowsApps\\package_name* с именем исполняемого файла `app_name.exe`.</span><span class="sxs-lookup"><span data-stu-id="39c69-164">App packages are installed under *%ProgramFiles%\\WindowsApps\\package_name*, with the executable titled `app_name.exe`.</span></span> <span data-ttu-id="39c69-165">Каждая папка пакета содержит манифест (с именем `AppxManifest.xml`), содержащий специальное пространство имен XML для упакованных приложений.</span><span class="sxs-lookup"><span data-stu-id="39c69-165">Each package folder contains a manifest (named `AppxManifest.xml`) that contains a special XML namespace for packaged apps.</span></span> <span data-ttu-id="39c69-166">Внутри этого файла манифеста находится элемент `<EntryPoint>`, который указывает на приложение с полным доверием.</span><span class="sxs-lookup"><span data-stu-id="39c69-166">Inside that manifest file is an `<EntryPoint>` element, which references the full-trust app.</span></span> <span data-ttu-id="39c69-167">При запуске этого приложения оно не выполняется в контейнере приложения, а выполняется от имени пользователя, как обычно.</span><span class="sxs-lookup"><span data-stu-id="39c69-167">When that application is launched, it doesn't run inside an app container, but instead it runs as the user as it normally would.</span></span>

<span data-ttu-id="39c69-168">После развертывания пакета файлы помечаются как доступные только для чтения и блокируются операционной системой.</span><span class="sxs-lookup"><span data-stu-id="39c69-168">After deployment, package files are marked read-only and heavily locked down by the operating system.</span></span> <span data-ttu-id="39c69-169">Windows не позволяет запускать приложения, если в эти файлы внесены несанкционированные изменения.</span><span class="sxs-lookup"><span data-stu-id="39c69-169">Windows prevents apps from launching if these files are tampered with.</span></span>

##### <a name="file-system"></a><span data-ttu-id="39c69-170">Файловая система</span><span class="sxs-lookup"><span data-stu-id="39c69-170">File system</span></span>

<span data-ttu-id="39c69-171">Операционная система поддерживает различные уровни операций файловой системы для упакованных настольных приложений, в зависимости от расположения папки.</span><span class="sxs-lookup"><span data-stu-id="39c69-171">The OS supports different levels of file system operations for packaged desktop applications, depending on the folder location.</span></span>

<span data-ttu-id="39c69-172">При попытке доступа к папке *AppData* пользователя система создает частное расположение для каждого пользователя и приложения в фоновом режиме.</span><span class="sxs-lookup"><span data-stu-id="39c69-172">When trying to access the user's *AppData* folder, the system creates a private per-user, per-app location behind the scenes.</span></span> <span data-ttu-id="39c69-173">Это создает иллюзию, будто упакованное приложение изменяет реальную *AppData*, тогда как фактически оно изменяет закрытую копию.</span><span class="sxs-lookup"><span data-stu-id="39c69-173">This creates the illusion that the packaged application is editing the real *AppData* when it's actually modifying a private copy.</span></span> <span data-ttu-id="39c69-174">Перенаправляя операции записи таким образом, система может отслеживать все изменения, вносимые приложением в файлы.</span><span class="sxs-lookup"><span data-stu-id="39c69-174">By redirecting writes this way, the system can track all file modifications made by the app.</span></span> <span data-ttu-id="39c69-175">Затем она может очищать все эти файлы при удалении, что уменьшает "замусоривание" системы и улучшает процесс удаления приложений для пользователя.</span><span class="sxs-lookup"><span data-stu-id="39c69-175">It can then clean all those files when uninstalling reducing system "rot" and providing a better application removal experience for the user.</span></span>

##### <a name="registry"></a><span data-ttu-id="39c69-176">Реестр</span><span class="sxs-lookup"><span data-stu-id="39c69-176">Registry</span></span>

<span data-ttu-id="39c69-177">Пакеты приложений содержат файл registry.dat, который служит логическим эквивалентом `HKLM\Software` в реальном реестре.</span><span class="sxs-lookup"><span data-stu-id="39c69-177">App packages contain a registry.dat file, which serves as the logical equivalent of `HKLM\Software` in the real registry.</span></span> <span data-ttu-id="39c69-178">Во время выполнения этот виртуальный реестр объединяет содержимое этого куста с собственным кустом системы, чтобы обеспечить их единообразное представление.</span><span class="sxs-lookup"><span data-stu-id="39c69-178">At runtime, this virtual registry merges the contents of this hive into the native system hive to provide a singular view of both.</span></span>

<span data-ttu-id="39c69-179">Все операции записи сохраняются во время обновления пакета и удаляются только при удалении приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-179">All writes are kept during package upgrade and only deleted when the application is uninstalled.</span></span>

##### <a name="uninstallation"></a><span data-ttu-id="39c69-180">Удаление</span><span class="sxs-lookup"><span data-stu-id="39c69-180">Uninstallation</span></span>

<span data-ttu-id="39c69-181">Когда пользователь удаляет пакет, все файлы и папки, расположенные в `C:\Program Files\WindowsApps\package_name`, удаляются, равно как и все перенаправляемые записи в AppData или реестре, записанные во время процесса.</span><span class="sxs-lookup"><span data-stu-id="39c69-181">When the user uninstalls a package, all files and folders located under `C:\Program Files\WindowsApps\package_name` are removed, as well as any redirected writes to AppData or the registry that were captured during the process.</span></span>

<span data-ttu-id="39c69-182">Дополнительные сведения о том, как упакованное приложение обрабатывает установку, доступ к файлам, реестр и удаление, см. в разделе <https://docs.microsoft.com/windows/msix/desktop/desktop-to-uwp-behind-the-scenes>.</span><span class="sxs-lookup"><span data-stu-id="39c69-182">For details about how a packaged application handles installation, file access, registry, and uninstallation, see <https://docs.microsoft.com/windows/msix/desktop/desktop-to-uwp-behind-the-scenes>.</span></span>

<span data-ttu-id="39c69-183">Вы можете получить полный список того, что стоит проверить, в <https://docs.microsoft.com/windows/msix/desktop/desktop-to-uwp-prepare>.</span><span class="sxs-lookup"><span data-stu-id="39c69-183">You can get a complete list of things to check on <https://docs.microsoft.com/windows/msix/desktop/desktop-to-uwp-prepare>.</span></span>

## <a name="how-to-add-winrt-apis-to-your-desktop-project"></a><span data-ttu-id="39c69-184">Добавление API-интерфейсов WinRT в проект для настольных систем</span><span class="sxs-lookup"><span data-stu-id="39c69-184">How to add WinRT APIs to your desktop project</span></span>

<span data-ttu-id="39c69-185">В этом разделе можно найти пошаговое руководство по интеграции всплывающих уведомлений в существующее приложение WPF.</span><span class="sxs-lookup"><span data-stu-id="39c69-185">In this section, you can find a walkthrough on how to integrate Toast Notifications in an existing WPF application.</span></span> <span data-ttu-id="39c69-186">Хотя это и просто с точки зрения кода, это помогает проиллюстрировать весь процесс.</span><span class="sxs-lookup"><span data-stu-id="39c69-186">Although it's simple from the code perspective, it helps illustrate the whole process.</span></span> <span data-ttu-id="39c69-187">Уведомления — это один из многих доступных API-интерфейсов WinRT, которые можно использовать в приложении .NET.</span><span class="sxs-lookup"><span data-stu-id="39c69-187">Notifications are one of the many available WinRT APIs available that you can use in .NET app.</span></span> <span data-ttu-id="39c69-188">В этом случае для API требуется удостоверение пакета.</span><span class="sxs-lookup"><span data-stu-id="39c69-188">In this case, the API requires a Package Identity.</span></span> <span data-ttu-id="39c69-189">Этот процесс более прост, если интерфейсы API не нуждаются в удостоверении пакета.</span><span class="sxs-lookup"><span data-stu-id="39c69-189">This process is more straightforward if the APIs don't require Package Identity.</span></span>

<span data-ttu-id="39c69-190">Возьмем существующий пример приложения WPF, которое считывает файлы и отображает их содержимое на экране.</span><span class="sxs-lookup"><span data-stu-id="39c69-190">Let's take an existing WPF sample app that reads files and shows its contents on the screen.</span></span> <span data-ttu-id="39c69-191">Целью является отображение всплывающего уведомления при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-191">The goal is to display a Toast Notification when the application starts.</span></span>

![Снимок экрана с работающим примером приложения](./media/windows-migration/sample-application.png)

<span data-ttu-id="39c69-193">Во-первых, следует проверить по следующей ссылке, требуется ли удостоверение пакета для интерфейса API Windows 10, который вы будете использовать:</span><span class="sxs-lookup"><span data-stu-id="39c69-193">First, you should check in the following link whether the Windows 10 API that you'll use requires a Package Identity:</span></span>

<https://docs.microsoft.com/windows/apps/desktop/modernize/desktop-to-uwp-supported-api>

<span data-ttu-id="39c69-194">В нашем примере будет использоваться API <xref:Windows.UI.Notifications.Notification?displayProperty=nameWithType>, для которого требуется удостоверение пакета:</span><span class="sxs-lookup"><span data-stu-id="39c69-194">Our sample will use the <xref:Windows.UI.Notifications.Notification?displayProperty=nameWithType> API that requires a packaged identity:</span></span>

![Класс уведомлений в документации Майкрософт](./media/windows-migration/notification-class-documentation.png)

<span data-ttu-id="39c69-196">Чтобы получить доступ к API WinRT, добавьте ссылку на пакет NuGet `Microsoft.Windows.SDK.Contracts`, и этот пакет выполнит всю работу за кулисами (см. подробности в разделе <https://blogs.windows.com/windowsdeveloper/2019/04/30/calling-windows-10-apis-from-a-desktop-application-just-got-easier/>).</span><span class="sxs-lookup"><span data-stu-id="39c69-196">To access the WinRT API, add a reference to the `Microsoft.Windows.SDK.Contracts` NuGet package and this package will do the magic behind the scenes (see details at <https://blogs.windows.com/windowsdeveloper/2019/04/30/calling-windows-10-apis-from-a-desktop-application-just-got-easier/>).</span></span>

<span data-ttu-id="39c69-197">Теперь вы готовы приступить к добавлению кода.</span><span class="sxs-lookup"><span data-stu-id="39c69-197">You're now prepared to start adding some code.</span></span>

<span data-ttu-id="39c69-198">Создайте метод `ShowToastNotification`, который будет вызываться при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-198">Create a `ShowToastNotification` method that will be called on application startup.</span></span> <span data-ttu-id="39c69-199">Он просто создает всплывающее уведомление из XML-шаблона:</span><span class="sxs-lookup"><span data-stu-id="39c69-199">It just builds a toast notification from an XML pattern:</span></span>

```csharp
private void ShowNotification(string title, string content, string image)
{
    string xmlString = $@"<toast><visual><binding template = 'ToastGeneric'><text>{title}</text><text>{content}</text><image src=>'{image}'</image></binding></visual></toast>";
    XmlDocument toastXml = new XmlDocument();
    toastXml.LoadXml(xmlString);
    ToastNotification toast = new ToastNotification(toastXml);
    ToastNotificationManager.CreateToastNotifier().Show(toast);
}
```

<span data-ttu-id="39c69-200">Несмотря на то, что сборка проекта выполняется, возникают ошибки из-за того, что API уведомлений требует удостоверения пакета, а вы не предоставили его.</span><span class="sxs-lookup"><span data-stu-id="39c69-200">Although the project builds, there are errors because the Notifications API requires a Package Identity and you didn't provide it.</span></span> <span data-ttu-id="39c69-201">Чтобы устранить эту проблему, добавьте проект упаковки Windows в решение:</span><span class="sxs-lookup"><span data-stu-id="39c69-201">Adding a Windows Packaging Project to the solution will fix the issue:</span></span>

![Снимок экрана: диалоговое окно добавления нового проекта в Visual Studio.](./media/windows-migration/add-packaging-project.png)

<span data-ttu-id="39c69-203">Выберите минимальную версию Windows, которую требуется поддерживать, и версию, для которой выполняется настройка.</span><span class="sxs-lookup"><span data-stu-id="39c69-203">Select the minimum Windows version you want to support and the version you're targeting.</span></span> <span data-ttu-id="39c69-204">Не все API-интерфейсы WinRT поддерживаются во всех версиях Windows 10.</span><span class="sxs-lookup"><span data-stu-id="39c69-204">Not all the WinRT APIs are supported in all Windows 10 versions.</span></span> <span data-ttu-id="39c69-205">Каждое обновление Windows 10 добавляет новые API, которые доступны только из этой версии. поддержка старых версий отсутствует.</span><span class="sxs-lookup"><span data-stu-id="39c69-205">Each Windows 10 update adds new APIs that are only available from this version; down-level support isn't available.</span></span>

![Выбор минимальной версии Windows](./media/windows-migration/select-versions.png)

<span data-ttu-id="39c69-207">Следующим шагом является добавление приложения WPF в Проект упаковки Windows путем добавления ссылки на проект:</span><span class="sxs-lookup"><span data-stu-id="39c69-207">Next step is to add the WPF application to the Windows Packaging Project by adding a project reference:</span></span>

![Добавление приложения WPF в Проект упаковки Windows](./media/windows-migration/add-application.png)

![Диспетчер ссылок](./media/windows-migration/reference-manager.png)

<span data-ttu-id="39c69-210">Проект упаковки Windows может упаковывать несколько приложений, поэтому следует задать, какое из них является точкой входа:</span><span class="sxs-lookup"><span data-stu-id="39c69-210">A Windows Packaging Project can package several apps so you should set which one is the Entry Point:</span></span>

![Настройка точки входа](./media/windows-migration/set-entry-point.png)

<span data-ttu-id="39c69-212">Следующим шагом является установка проекта WPF в качестве запускаемого проекта в конфигурации решения.</span><span class="sxs-lookup"><span data-stu-id="39c69-212">Next step is to set the WPF Project as the startup Project in the solution configuration.</span></span> <span data-ttu-id="39c69-213">Можно нажать клавишу F5 для компиляции, построения и просмотра результатов.</span><span class="sxs-lookup"><span data-stu-id="39c69-213">You can press F5 to compile and build and see the results.</span></span>

![Работа и отображение результатов примером приложения](./media/windows-migration/sample-app-result.png)

<span data-ttu-id="39c69-215">Давайте создадим пакет, чтобы можно было установить приложение.</span><span class="sxs-lookup"><span data-stu-id="39c69-215">Let's generate the package so you can install your app.</span></span> <span data-ttu-id="39c69-216">Щелкните правой кнопкой мыши **Магазин** > **Создать пакеты приложений**.</span><span class="sxs-lookup"><span data-stu-id="39c69-216">Right click on **Store** > **Create App Packages**.</span></span>

![Диалог создания пакетов приложений](./media/windows-migration/create-app-packages.png)

<span data-ttu-id="39c69-218">Выберите вариант загрузки неопубликованных приложений, чтобы развернуть приложение с компьютера:</span><span class="sxs-lookup"><span data-stu-id="39c69-218">Select the sideloading option to deploy the app from your machine:</span></span>

![Выбор варианта загрузки неопубликованных приложений](./media/windows-migration/select-sideloading-option.png)

<span data-ttu-id="39c69-220">Выберите архитектуру приложения для своего приложения:</span><span class="sxs-lookup"><span data-stu-id="39c69-220">Select the application architecture of your app:</span></span>

![Выбор архитектуры приложения](./media/windows-migration/select-app-architecture.png)

<span data-ttu-id="39c69-222">Наконец, создайте пакет, щелкнув **Создать**.</span><span class="sxs-lookup"><span data-stu-id="39c69-222">Finally, create the package by clicking on **Create**.</span></span>

## <a name="xaml-islands"></a><span data-ttu-id="39c69-223">XAML Islands</span><span class="sxs-lookup"><span data-stu-id="39c69-223">XAML Islands</span></span>

<span data-ttu-id="39c69-224">XAML Islands — это набор компонентов, позволяющих разработчикам классических приложений Windows использовать элементы управления XAML UWP в существующих приложениях Win32, включая Windows Forms и WPF.</span><span class="sxs-lookup"><span data-stu-id="39c69-224">XAML Islands are a set of components that enable Windows desktop developers to use UWP XAML controls on their existing Win32 applications, including Windows Forms and WPF.</span></span>

![Структура XAML Islands](./media/windows-migration/xaml-islands.png)

<span data-ttu-id="39c69-226">Вы можете представить себе приложение Win32 с вашими стандартными элементами управления, а среди них "остров" пользовательского интерфейса UWP, содержащий современные элементы управления.</span><span class="sxs-lookup"><span data-stu-id="39c69-226">You can image your Win32 app with your standard controls and among them an "island" of UWP UI containing controls from the modern world.</span></span> <span data-ttu-id="39c69-227">Концепция похожа на iFrame внутри веб-страницы, показывающий содержимое из `different page.`.</span><span class="sxs-lookup"><span data-stu-id="39c69-227">The concept is similar as having an iFrame inside a web page that shows content from a `different page.`</span></span>

<span data-ttu-id="39c69-228">Помимо добавления функций из API Windows 10, вы можете добавлять элементы XAML UWP внутри приложения с помощью XAML Islands.</span><span class="sxs-lookup"><span data-stu-id="39c69-228">Besides adding functionality from the Windows 10 APIs, you can add pieces of UWP XAML inside of your app using XAML Islands.</span></span>

<span data-ttu-id="39c69-229">В обновлении 1903 Windows 10 появился набор API-интерфейсов, позволяющих размещать содержимое UWP XAML в окнах Win32.</span><span class="sxs-lookup"><span data-stu-id="39c69-229">Windows 10 1903 update introduces a set of APIs that allows hosting UWP XAML content in Win32 windows.</span></span> <span data-ttu-id="39c69-230">Только приложения, работающие в Windows 10 1903, могут использовать XAML Islands.</span><span class="sxs-lookup"><span data-stu-id="39c69-230">Only apps running on Windows 10 1903 can use XAML Islands.</span></span>

### <a name="the-road-to-xaml-islands"></a><span data-ttu-id="39c69-231">Путь к XAML Islands</span><span class="sxs-lookup"><span data-stu-id="39c69-231">The road to XAML Islands</span></span>

<span data-ttu-id="39c69-232">Путь к XAML Islands начался в 2012 году, когда корпорация Майкрософт представила API-интерфейсы WinRT в качестве платформы для модернизации приложений Win32 (Windows Forms, WPF и собственных приложений Win32).</span><span class="sxs-lookup"><span data-stu-id="39c69-232">The road to XAML Islands started in 2012 when Microsoft introduced the WinRT APIs as a framework to modernize the Win32 apps (Windows Forms, WPF, and native Win32 apps).</span></span> <span data-ttu-id="39c69-233">Однако новые элементы управления пользовательского интерфейса в WinRT были доступны для новых приложений, но не для существующих.</span><span class="sxs-lookup"><span data-stu-id="39c69-233">However, the new UI controls inside WinRT were available for new applications but not for existing ones.</span></span>

<span data-ttu-id="39c69-234">В 2015 году вместе с Windows 10 родилась универсальная платформа Windows (UWP).</span><span class="sxs-lookup"><span data-stu-id="39c69-234">In 2015, along with Windows 10, UWP was born.</span></span> <span data-ttu-id="39c69-235">UWP позволяет создавать приложения, работающие на любых устройствах Windows, таких как XBox, мобильные устройства и настольные ПК.</span><span class="sxs-lookup"><span data-stu-id="39c69-235">UWP allows you to create apps that work across Windows devices like XBox, Mobile, and Desktop.</span></span> <span data-ttu-id="39c69-236">Год спустя корпорация Майкрософт представила мост для классических приложений (прежнее название — Project Centennial).</span><span class="sxs-lookup"><span data-stu-id="39c69-236">One year later, Microsoft announced Desktop Bridge (formerly known as Project Centennial).</span></span> <span data-ttu-id="39c69-237">Мост для классических приложений — это набор средств, которые позволяли разработчикам переносить существующие приложения Win32 в Microsoft Store.</span><span class="sxs-lookup"><span data-stu-id="39c69-237">Desktop Bridge is a set of tools that allowed developers to bring their existing Win32 apps to the Microsoft Store.</span></span> <span data-ttu-id="39c69-238">В 2017 году были добавлены дополнительные возможности, позволяющие разработчикам совершенствовать приложения Win32, используя некоторые из новых API Windows 10, таких как живые плитки и уведомления в центре действий.</span><span class="sxs-lookup"><span data-stu-id="39c69-238">More capabilities were added in 2017, allowing developers to enhance their Win32 apps leveraging some of the new Windows 10 APIs, like live tiles and notifications on the action center.</span></span> <span data-ttu-id="39c69-239">Но всё еще без новых элементов управления пользовательским интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="39c69-239">But still, no new UI controls.</span></span>

<span data-ttu-id="39c69-240">На конференции Build 2018 корпорация Майкрософт объявила о способе, позволяющем разработчикам использовать новые элементы управления XAML Windows 10 в своих текущих приложениях Win32 без полной миграции своих приложений на UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-240">At Build 2018, Microsoft announced a way for developers to use the new Windows 10 XAML controls into their current Win32 apps, without fully migrating their apps to UWP.</span></span> <span data-ttu-id="39c69-241">Он получил название XAML Islands для универсальной платформы Windows.</span><span class="sxs-lookup"><span data-stu-id="39c69-241">It was branded as UWP XAML Islands.</span></span>

### <a name="how-it-works"></a><span data-ttu-id="39c69-242">Принцип работы</span><span class="sxs-lookup"><span data-stu-id="39c69-242">How it works</span></span>

<span data-ttu-id="39c69-243">В обновлении 1903 Windows 10 добавлено несколько API размещения XAML.</span><span class="sxs-lookup"><span data-stu-id="39c69-243">The Windows 10 1903 update introduces several XAML hosting APIs.</span></span> <span data-ttu-id="39c69-244">В их число входят `WindowsXamlManager` и `DesktopWindowXamlSource`.</span><span class="sxs-lookup"><span data-stu-id="39c69-244">Two of them are `WindowsXamlManager` and `DesktopWindowXamlSource`.</span></span>

<span data-ttu-id="39c69-245">Класс `WindowsXamlManager` обрабатывает платформу XAML UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-245">The `WindowsXamlManager` class handles the UWP XAML Framework.</span></span> <span data-ttu-id="39c69-246">Его `InitializeForCurrentThread` метод загружает платформу XAML UWP в текущем потоке приложения Win32.</span><span class="sxs-lookup"><span data-stu-id="39c69-246">Its `InitializeForCurrentThread` method loads the UWP XAML Framework inside the current thread of the Win32 app.</span></span>

<span data-ttu-id="39c69-247">`DesktopWindowXamlSource`— это экземпляр содержимого элемента управления XAML Island.</span><span class="sxs-lookup"><span data-stu-id="39c69-247">The `DesktopWindowXamlSource` is the instance of your XAML Island content.</span></span> <span data-ttu-id="39c69-248">У него есть свойство `Content`, за создание экземпляра и настройку которого отвечаете вы.</span><span class="sxs-lookup"><span data-stu-id="39c69-248">It has the `Content` property, which you're responsible for instantiating and setting.</span></span> <span data-ttu-id="39c69-249">`DesktopWindowXamlSource` визуализирует и получает свои входные данные из HWND.</span><span class="sxs-lookup"><span data-stu-id="39c69-249">The `DesktopWindowXamlSource` renders and gets its input from an HWND.</span></span> <span data-ttu-id="39c69-250">Ему необходимо определить, какой другой HWND будет прикрепляться к элементу управления XAML Island. Вы отвечаете за изменение размеров и размещение HWND родителя.</span><span class="sxs-lookup"><span data-stu-id="39c69-250">It needs to know to which other HWND it will attach the XAML Island's one, and you're responsible for sizing and positioning the parent's HWND.</span></span>

<span data-ttu-id="39c69-251">Разработчики WPF или Windows Forms обычно не работают с HWND внутри своего кода, поэтому может быть трудно понять и обработать указатели HWND и скрытую проводку для взаимодействия с платформами Win32 и UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-251">WPF or Windows Forms developers don't usually deal with HWND inside their code, so it may be hard to understand and handle HWND pointers and the underlying wiring stuff to communicate Win32 and UWP worlds.</span></span>

#### <a name="the-xaml-islands-net-wrappers"></a><span data-ttu-id="39c69-252">Оболочки .NET XAML Islands</span><span class="sxs-lookup"><span data-stu-id="39c69-252">The XAML Islands .NET Wrappers</span></span>

<span data-ttu-id="39c69-253">В наборе средств Windows Community Toolkit предусмотрены наборы оболочек .NET XAML Islands для WPF или Windows Forms, упрощающие использование XAML Islands.</span><span class="sxs-lookup"><span data-stu-id="39c69-253">The Windows Community Toolkit has a set the XAML Islands .NET wrappers for WPF or Windows Forms that make easier to use XAML Islands.</span></span> <span data-ttu-id="39c69-254">Эти оболочки управляют дескрипторами HWND и управлением фокусами, помимо прочего.</span><span class="sxs-lookup"><span data-stu-id="39c69-254">These wrappers manage the HWNDs, the focus management, among other things.</span></span> <span data-ttu-id="39c69-255">Разработчики Windows Forms и WPF должны использовать эти оболочки.</span><span class="sxs-lookup"><span data-stu-id="39c69-255">Windows Forms and WPF developers should use these wrappers.</span></span>

<span data-ttu-id="39c69-256">Набор средств Windows Community Toolkit предлагает два типа элементов управления: заключенные в оболочку элементы управления и размещаемые элементы управления.</span><span class="sxs-lookup"><span data-stu-id="39c69-256">The Windows Community Toolkit offers two types of controls: Wrapped Controls and Hosting Controls.</span></span>

##### <a name="wrapped-controls"></a><span data-ttu-id="39c69-257">Заключение в оболочку элементов управления</span><span class="sxs-lookup"><span data-stu-id="39c69-257">Wrapped Controls</span></span>

<span data-ttu-id="39c69-258">Эта оболочка состоит в заключении некоторых элементов управления UWP в элементы управления Windows Forms или WPF, скрывая основные понятия UWP для этих разработчиков.</span><span class="sxs-lookup"><span data-stu-id="39c69-258">These wrapped controls wrap some UWP controls into Windows Forms or WPF controls, hiding UWP concepts for those developers.</span></span> <span data-ttu-id="39c69-259">Это такие элементы управления, как:</span><span class="sxs-lookup"><span data-stu-id="39c69-259">These controls are:</span></span>

* <span data-ttu-id="39c69-260">WebView и WebViewCompatible</span><span class="sxs-lookup"><span data-stu-id="39c69-260">WebView and WebViewCompatible</span></span>
* <span data-ttu-id="39c69-261">InkCanvas и InkToolbar</span><span class="sxs-lookup"><span data-stu-id="39c69-261">InkCanvas and InkToolbar</span></span>
* <span data-ttu-id="39c69-262">MediaPlayerElement</span><span class="sxs-lookup"><span data-stu-id="39c69-262">MediaPlayerElement</span></span>
* <span data-ttu-id="39c69-263">MapControl</span><span class="sxs-lookup"><span data-stu-id="39c69-263">MapControl</span></span>

<span data-ttu-id="39c69-264">Добавьте пакет `Microsoft.Toolkit.Wpf.UI.Controls` в проект, включите ссылку на пространство имен и начните использовать их.</span><span class="sxs-lookup"><span data-stu-id="39c69-264">Add the `Microsoft.Toolkit.Wpf.UI.Controls` package to your project, include the reference to the namespace, and start using them.</span></span>

```xml
<Window
        ...
        xmlns:uwpControls="clr-namespace:Microsoft.Toolkit.Wpf.UI.Controls;assembly=Microsoft.Toolkit.Wpf.UI.Controls">
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="\*"/>
    </Grid.RowDefinitions>
    <uwpControls:InkToolbar TargetInkCanvas="{x:Reference Name=inkCanvas}"/>
    <uwpControls:InkCanvas Grid.Row="1" x:Name="inkCanvas" />
</Grid>
```

##### <a name="hosting-controls"></a><span data-ttu-id="39c69-265">Размещение элементов управления</span><span class="sxs-lookup"><span data-stu-id="39c69-265">Hosting controls</span></span>

<span data-ttu-id="39c69-266">Возможности XAML Islands распространяются на большинство элементов управления от Майкрософт, сторонних элементов управления и пользовательских элементов управления, разработанных для UWP, которые можно интегрировать в Windows Forms и WPF как "острова" с полностью функциональным интерфейсом пользователя.</span><span class="sxs-lookup"><span data-stu-id="39c69-266">The power of XAML Islands extends to most first-party controls, third-party controls, and custom controls developed for UWP, which can be integrated into Windows Forms and WPF as "Islands" with fully functional UI.</span></span> <span data-ttu-id="39c69-267">Элемент управления `WindowsXamlHost` для WPF и Windows Forms позволяет сделать это.</span><span class="sxs-lookup"><span data-stu-id="39c69-267">The `WindowsXamlHost` control for WPF and Windows Forms allows doing this.</span></span>

<span data-ttu-id="39c69-268">Например, чтобы использовать элемент управления `WindowsXamlHost` в WPF, добавьте ссылку на пакет `Microsoft.Toolkit.Wpf.UI.XamlHost`, предоставляемый набором средств сообщества Windows.</span><span class="sxs-lookup"><span data-stu-id="39c69-268">For example, to use the `WindowsXamlHost` control in WPF, add a reference to the `Microsoft.Toolkit.Wpf.UI.XamlHost` package provided by the Windows Community Toolkit.</span></span>

<span data-ttu-id="39c69-269">После помещения `WindowsXamlHost` в код пользовательского интерфейса укажите тип UWP, который требуется загрузить.</span><span class="sxs-lookup"><span data-stu-id="39c69-269">Once you've placed your `WindowsXamlHost` into your UI code, specify which UWP type you want to load.</span></span> <span data-ttu-id="39c69-270">Можно выбрать использование заключенного в оболочку элемента управления, такого как `Button`, или более сложного, состоящего из нескольких различных элементов управления, которые являются настраиваемым элементом управления UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-270">You can choose to use a wrapped control like a `Button` or a more complex one composed by several different controls, which are a custom UWP control.</span></span>

<span data-ttu-id="39c69-271">В следующем примере демонстрируется, как добавить `Button` UWP:</span><span class="sxs-lookup"><span data-stu-id="39c69-271">The following example shows how to add a UWP `Button`:</span></span>

```xml
<Window
        ...
        xmlns:xamlhost="clr-namespace:Microsoft.Toolkit.Wpf.UI.XamlHost;assembly=Microsoft.Toolkit.Wpf.UI.XamlHost">

<xamlhost:WindowsXamlHost x:Name="myUwpButton"
                          InitialTypeName="Windows.UI.Xaml.Controls.Button" />
```

<span data-ttu-id="39c69-272">Есть четко рекомендованный подход: лучше иметь один, более крупный "остров" XAML Island, содержащий пользовательский составной элемент управления, чем несколько островов с одним элементом управления на каждом.</span><span class="sxs-lookup"><span data-stu-id="39c69-272">There's a clear recommendation on how to approach this and it's better to have one single and bigger XAML Island containing a custom composite control than to have several islands with one control on each.</span></span>

<span data-ttu-id="39c69-273">Одной из основных функций XAML является привязка, она работает между кодом Win32 и таким "островом".</span><span class="sxs-lookup"><span data-stu-id="39c69-273">One of the core features of XAML is binding and it works between your Win32 code and the island.</span></span> <span data-ttu-id="39c69-274">Таким образом, можно выполнить привязку, например `Textbox` Win32 к `Textbox` UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-274">So, you can bind, for instance, a Win32 `Textbox` with a UWP `Textbox`.</span></span> <span data-ttu-id="39c69-275">Важно учитывать, что эти привязки являются односторонними привязками от UWP к Win32, поэтому при обновлении `Textbox` внутри XAML Island текстовое поле Win32 будет обновляться, но не наоборот.</span><span class="sxs-lookup"><span data-stu-id="39c69-275">One important thing to consider is that these bindings are one-way bindings, from UWP to Win32, so if you update the `Textbox` inside the XAML Island the Win32 Textbox will be updated, but not the other way around.</span></span>

<span data-ttu-id="39c69-276">Пошаговое руководство по использованию XAML Islands см. в:</span><span class="sxs-lookup"><span data-stu-id="39c69-276">To see a walkthrough about how to use XAML Islands, see:</span></span>

<https://docs.microsoft.com/windows/apps/desktop/modernize/host-standard-control-with-xaml-islands>

#### <a name="adding-uwp-xaml-custom-controls"></a><span data-ttu-id="39c69-277">Добавление пользовательских элементов управления UWP XAML</span><span class="sxs-lookup"><span data-stu-id="39c69-277">Adding UWP XAML custom controls</span></span>

<span data-ttu-id="39c69-278">Пользовательский элемент управления XAML — это элемент управления (или базовый пользовательский элемент управления), созданный вами или третьими сторонами (включая элементы управления WinUI 2.x).</span><span class="sxs-lookup"><span data-stu-id="39c69-278">A XAML custom control is a control (or user control) created by you or by third parties (including WinUI 2.x controls).</span></span> <span data-ttu-id="39c69-279">Чтобы разместить пользовательский элемент управления UWP в приложении Windows Forms или WPF, необходимо:</span><span class="sxs-lookup"><span data-stu-id="39c69-279">To host a custom UWP control in a Windows Forms or WPF app, you'll need:</span></span>

- <span data-ttu-id="39c69-280">Использовать элемента управления UWP `WindowsXamlHost` в приложении .NET.</span><span class="sxs-lookup"><span data-stu-id="39c69-280">To use the `WindowsXamlHost` UWP control in your .NET app.</span></span>
- <span data-ttu-id="39c69-281">Создать проект приложения UWP, определяющий объект`XamlApplication`.</span><span class="sxs-lookup"><span data-stu-id="39c69-281">To create a UWP app project that defines a `XamlApplication` object.</span></span>

<span data-ttu-id="39c69-282">В проекте WPF или Windows Forms должен быть доступ к экземпляру класса `Microsoft.Toolkit.Win32.UI.XamlHost.XamlApplication`, предоставленному в наборе средств сообщества Windows.</span><span class="sxs-lookup"><span data-stu-id="39c69-282">Your WPF or Windows Forms project must have access to an instance of the `Microsoft.Toolkit.Win32.UI.XamlHost.XamlApplication` class provided by the Windows Community Toolkit.</span></span> <span data-ttu-id="39c69-283">Этот объект выступает в качестве корневого поставщика метаданных для загрузки метаданных пользовательских типов XAML UWP в сборки в текущем каталоге приложения.</span><span class="sxs-lookup"><span data-stu-id="39c69-283">This object acts as a root metadata provider for loading metadata for custom UWP XAML types in assemblies in the current directory of your application.</span></span> <span data-ttu-id="39c69-284">Для этого рекомендуется добавить проект пустого приложения (универсального приложения Windows) в то же решение, что и проект WPF или Windows Forms, и изменить класс приложения по умолчанию в этом проекте.</span><span class="sxs-lookup"><span data-stu-id="39c69-284">The recommended way to do this is to add a Blank App (Universal Windows) project to the same solution as your WPF or Windows Forms project and revise the default App class in this project.</span></span>

<span data-ttu-id="39c69-285">Пользовательский элемент управления XAML UWP может быть включен в это приложение UWP или в независимый проект библиотеки классов UWP, на который вы ссылаетесь в том же решении, что и проект WPF или Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="39c69-285">The custom UWP XAML control can be included on this UWP app or in an independent UWP Class Library project that you reference in the same solution as your WPF or Windows Forms project.</span></span>

<span data-ttu-id="39c69-286">Подробное пошаговое описание процесса можно найти по адресу:</span><span class="sxs-lookup"><span data-stu-id="39c69-286">You can check a detailed step-by-step process description at:</span></span>

<https://docs.microsoft.com/windows/apps/desktop/modernize/host-custom-control-with-xaml-islands>

#### <a name="the-windows-ui-library-winui-2"></a><span data-ttu-id="39c69-287">Библиотека пользовательского интерфейса Windows (WinUI 2)</span><span class="sxs-lookup"><span data-stu-id="39c69-287">The Windows UI Library (WinUI 2)</span></span>

<span data-ttu-id="39c69-288">Помимо входящих в операционную систему элементов управления Windows 10, одна группа XAML UWP также доставляет дополнительные элементы управления в библиотеку пользовательского интерфейса Windows (**WinUI 2**).</span><span class="sxs-lookup"><span data-stu-id="39c69-288">Besides the inbox Windows 10 controls that comes with the OS, the same UWP XAML team also deliver additional controls in the Windows UI Library (**WinUI 2**).</span></span> <span data-ttu-id="39c69-289">WinUI 2 предоставляет официальные собственные элементы управления пользовательского интерфейса Майкрософт и функции для приложений UWP Windows. Эти элементы управления можно использовать внутри XAML Islands.</span><span class="sxs-lookup"><span data-stu-id="39c69-289">WinUI 2 provides official native Microsoft UI controls and features for Windows UWP apps and these controls can be used inside of XAML Islands.</span></span>

<span data-ttu-id="39c69-290">У WinUI 2 открытый исходный код, и вы можете найти информацию по адресу <https://github.com/microsoft/microsoft-ui-xaml>.</span><span class="sxs-lookup"><span data-stu-id="39c69-290">WinUI 2 is open source and you can find information at <https://github.com/microsoft/microsoft-ui-xaml>.</span></span>

<span data-ttu-id="39c69-291">Следующая статься демонстрирует, как разместить элемент управления XAML UWP из библиотеки WinUI 2: <https://docs.microsoft.com/windows/apps/desktop/modernize/host-custom-control-with-xaml-islands></span><span class="sxs-lookup"><span data-stu-id="39c69-291">The following article demonstrates how to host a UWP XAML control from the WinUI 2 library: <https://docs.microsoft.com/windows/apps/desktop/modernize/host-custom-control-with-xaml-islands></span></span>

### <a name="do-you-need-xaml-islands"></a><span data-ttu-id="39c69-292">Нужны ли вам XAML Islands</span><span class="sxs-lookup"><span data-stu-id="39c69-292">Do you need XAML Islands</span></span>

<span data-ttu-id="39c69-293">XAML Islands предназначены для существующих приложений Win32, которым нужно улучшить взаимодействие с пользователем за счет новых элементов управления UWP и поведения без создания приложения заново.</span><span class="sxs-lookup"><span data-stu-id="39c69-293">XAML Islands are intended for existing Win32 apps that want to improve their user experience by leveraging new UWP controls and behaviors without a full rewrite of the app.</span></span> <span data-ttu-id="39c69-294">Вы уже могли [использовать API Windows 10](/windows/uwp/porting/desktop-to-uwp-enhance), но до появления XAML Islands — только API, не связанные с пользовательским интерфейсом.</span><span class="sxs-lookup"><span data-stu-id="39c69-294">You could already [leverage Windows 10 APIs](/windows/uwp/porting/desktop-to-uwp-enhance), but up until XAML Islands, only non-UI related APIs.</span></span>

<span data-ttu-id="39c69-295">Если вы разрабатываете новое приложение Windows, то, вероятно, [приложение UWP](/windows/uwp/get-started/universal-application-platform-guide) — правильный подход.</span><span class="sxs-lookup"><span data-stu-id="39c69-295">If you're developing a new Windows App, a [UWP App](/windows/uwp/get-started/universal-application-platform-guide) is probably the right approach.</span></span>

### <a name="the-road-ahead-xaml-islands-winui-30"></a><span data-ttu-id="39c69-296">Предстоящий XAML Islands путь: WinUI 3.0</span><span class="sxs-lookup"><span data-stu-id="39c69-296">The road ahead XAML Islands: WinUI 3.0</span></span>

<span data-ttu-id="39c69-297">Начиная с Windows 8 платформа пользовательского интерфейса Windows, включая платформу пользовательского интерфейса XAML, уровень визуальной композиции и обработку ввода, поставлялась как неотъемлемая часть Windows.</span><span class="sxs-lookup"><span data-stu-id="39c69-297">Since Windows 8, the Windows UI platform, including the XAML UI framework, visual composition layer, and input processing has been shipped as an integral part of Windows.</span></span> <span data-ttu-id="39c69-298">Значит, чтобы воспользоваться преимуществами последних улучшений в технологиях пользовательского интерфейса, необходимо выполнить обновление до последней версии пользовательского интерфейса, что замедляет темпы инноваций при разработке приложений.</span><span class="sxs-lookup"><span data-stu-id="39c69-298">This means that to benefit from the latest improvements on UI technologies, you must upgrade to the latest version of the UI, slowing down the pace of innovation when you develop your apps.</span></span> <span data-ttu-id="39c69-299">Для отделения этих двух циклов развития и стимуляции инноваций Майкрософт активно работает над проектом WinUI.</span><span class="sxs-lookup"><span data-stu-id="39c69-299">To decouple these two evolution cycles and foster innovation, Microsoft is actively working on the WinUI project.</span></span>

<span data-ttu-id="39c69-300">Начиная с WinUI 2 в 2018 г. корпорация Майкрософт приступила к отправке некоторых новых элементов управления и функций пользовательского интерфейса XAML в виде отдельных пакетов NuGet, которые создаются на основе пакета SDK для UWP.</span><span class="sxs-lookup"><span data-stu-id="39c69-300">Starting with WinUI 2 in 2018, Microsoft started shipping some new XAML UI controls and features as separate NuGet packages that build on top of the UWP SDK.</span></span>

![Структура WinUI 2.0](./media/windows-migration/winui2.png)

<span data-ttu-id="39c69-302">WinUI 3 находится в активной разработке и значительно расширяет область применения WinUI, с включением полной платформы пользовательского интерфейса, которая будет полностью отделена от пакета SDK для UWP:</span><span class="sxs-lookup"><span data-stu-id="39c69-302">WinUI 3 is under active development and will greatly expand the scope of WinUI to include the full UI platform, which will be fully decoupled from the UWP SDK:</span></span>

![Структура WinUI 3.0](./media/windows-migration/winui3.png)

<span data-ttu-id="39c69-304">Платформа XAML теперь будет разрабатываться на сайте GitHub и поставляться извне в качестве пакетов [NuGet](/nuget/what-is-nuget).</span><span class="sxs-lookup"><span data-stu-id="39c69-304">XAML framework will now be developed on GitHub and shipped out of band as [NuGet](/nuget/what-is-nuget) packages.</span></span>

<span data-ttu-id="39c69-305">Существующие API XAML UWP, поставляемые в составе ОС, больше не будут получать обновления возможностей.</span><span class="sxs-lookup"><span data-stu-id="39c69-305">The existing UWP XAML APIs that ship as part of the OS will no longer receive new feature updates.</span></span> <span data-ttu-id="39c69-306">Они и дальше будут получать обновления безопасности и критические исправления в соответствии с жизненным циклом поддержки Windows 10.</span><span class="sxs-lookup"><span data-stu-id="39c69-306">They will still receive security updates and critical fixes according to the Windows 10 support lifecycle.</span></span>

<span data-ttu-id="39c69-307">Универсальная платформа Windows содержит не только платформу XAML (включая модели приложений и безопасности, а также конвейеры мультимедиа, интеграцию с оболочкой Xbox и Windows 10 и поддержку разных устройств). Мы планируем и дальше развивать это решение.</span><span class="sxs-lookup"><span data-stu-id="39c69-307">The Universal Windows Platform contains more than just the XAML framework (for example, application and security model, media pipeline, Xbox and Windows 10 shell integrations, broad device support) and will continue to evolve.</span></span> <span data-ttu-id="39c69-308">Все новые функции XAML будут просто разрабатываться и поставляться как часть WinUI.</span><span class="sxs-lookup"><span data-stu-id="39c69-308">All new XAML features will just be developed and ship as part of WinUI instead.</span></span>

#### <a name="winui-3-in-desktop-app-and-winui-xaml-islands"></a><span data-ttu-id="39c69-309">WinUI 3 в классических приложениях и WinUI XAML Islands</span><span class="sxs-lookup"><span data-stu-id="39c69-309">WinUI 3 in desktop app and WinUI XAML Islands</span></span>

<span data-ttu-id="39c69-310">Как видите, WinUI 3 — это эволюция XAML UWP, который естественным образом работает в модели приложений UWP и всех ее требований (пакетный идентификатор MSIX, песочница, CoreWindow и т. д.).</span><span class="sxs-lookup"><span data-stu-id="39c69-310">As you can see, WinUI 3 is the evolution of UWP XAML and it works naturally within the UWP app model and all its requirements (MSIX packaged ID, sandbox, CoreWindow, and so on.</span></span> <span data-ttu-id="39c69-311">Чтобы использовать только WinUI 3 в модели приложений Win32, содержимое WinUI должно размещаться на другой платформе пользовательского интерфейса (Windows Forms, WPF и т. д.) с помощью **WinUI XAML Islands**.</span><span class="sxs-lookup"><span data-stu-id="39c69-311">To use just WinUI 3 in a Win32 app model, the WinUI content should be hosted by another UI Framework (Windows Forms, WPF, and so on) using **WinUI XAML Islands**.</span></span> <span data-ttu-id="39c69-312">Это правильный путь, если вы хотите развивать свои приложения и технологии Mix.</span><span class="sxs-lookup"><span data-stu-id="39c69-312">This is the right path if you want to evolve your app and mix technologies.</span></span> <span data-ttu-id="39c69-313">Однако если вы хотите заменить весь старый пользовательский интерфейс для WinUI, приложение не должно загружать платформы пользовательского интерфейса для простого размещения WinUI.</span><span class="sxs-lookup"><span data-stu-id="39c69-313">However, if you want to replace your entire old UI for WinUI, your app shouldn't load UI Frameworks for just hosting WinUI.</span></span>

<span data-ttu-id="39c69-314">WinUI 3 будет включать в себя реакцию на эти ключевые отзывы, добавление **WinUI в приложения для настольных компьютеров**.</span><span class="sxs-lookup"><span data-stu-id="39c69-314">WinUI 3 will address this critical feedback adding **WinUI in desktop apps**.</span></span> <span data-ttu-id="39c69-315">Это позволит приложениям Win32 использовать WinUI 3 в качестве изолированной платформы пользовательского интерфейса, без необходимости загружать Windows Forms или WPF.</span><span class="sxs-lookup"><span data-stu-id="39c69-315">This will allow that Win32 apps can use WinUI 3 as standalone UI Framework; no need to load Windows Forms or WPF.</span></span>

<span data-ttu-id="39c69-316">В рамках этого агрегата WinUI 3 позволяет разработчикам легко формировать правильные сочетания:</span><span class="sxs-lookup"><span data-stu-id="39c69-316">Within this aggregation, WinUI 3 will let developers easily mix and match the right combination of:</span></span>

* <span data-ttu-id="39c69-317">Модель приложения: UWP, Win32</span><span class="sxs-lookup"><span data-stu-id="39c69-317">App model: UWP, Win32</span></span>
* <span data-ttu-id="39c69-318">Платформа: .NET или собственная</span><span class="sxs-lookup"><span data-stu-id="39c69-318">Platform: .NET or Native</span></span>
* <span data-ttu-id="39c69-319">Язык: .NET (C\#, Visual Basic), стандартный C++</span><span class="sxs-lookup"><span data-stu-id="39c69-319">Language: .NET (C\#, Visual Basic), standard C++</span></span>
* <span data-ttu-id="39c69-320">Упаковка: MSIX, AppX для Microsoft Store, распакованный</span><span class="sxs-lookup"><span data-stu-id="39c69-320">Packaging: MSIX, AppX for the Microsoft Store, unpackaged</span></span>
* <span data-ttu-id="39c69-321">Взаимодействие. Используйте WinUI 3 для расширения существующих приложений WPF, WinForms и MFC с помощью WinUI XAML Islands.</span><span class="sxs-lookup"><span data-stu-id="39c69-321">Interop: use WinUI 3 to extend existing WPF, WinForms, and MFC apps using WinUI XAML Islands.</span></span>

<span data-ttu-id="39c69-322">Если вы хотите получить дополнительные сведения, корпорация Майкрософт выложила эту схему в общий доступ в <https://github.com/microsoft/microsoft-ui-xaml/blob/master/docs/roadmap.md>.</span><span class="sxs-lookup"><span data-stu-id="39c69-322">If you want to know more details, Microsoft is sharing this roadmap in <https://github.com/microsoft/microsoft-ui-xaml/blob/master/docs/roadmap.md>.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="39c69-323">[Назад](migrate-modern-applications.md)
>[Вперед](example-migration.md)</span><span class="sxs-lookup"><span data-stu-id="39c69-323">[Previous](migrate-modern-applications.md)
[Next](example-migration.md)</span></span>
