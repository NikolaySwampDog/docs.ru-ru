---
title: Различия в запуске приложений между ASP.NET MVC и ASP.NET Core
description: ASP.NET MVC и ASP.NET Core значительно различаются в процессе запуска приложений. Узнайте о важных различиях и способах перехода с ASP.NET MVC на ASP.NET Core.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: eaf8d8fac42ddebbb944273b672666e0bd2b1a67
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401823"
---
# <a name="app-startup-differences-between-aspnet-mvc-and-aspnet-core"></a><span data-ttu-id="c555c-104">Различия в запуске приложений между ASP.NET MVC и ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c555c-104">App startup differences between ASP.NET MVC and ASP.NET Core</span></span>

<span data-ttu-id="c555c-105">ASP.NET приложения MVC, существовавшие полностью в Internet Information Server (IIS), это основной веб-сервер, доступный в операционных системах Windows.</span><span class="sxs-lookup"><span data-stu-id="c555c-105">ASP.NET MVC apps lived entirely within Internet Information Server (IIS), the primary web server available on Windows operating systems.</span></span> <span data-ttu-id="c555c-106">В отличие от ASP.NET MVC, ASP.NET Core приложения являются исполняемыми приложениями.</span><span class="sxs-lookup"><span data-stu-id="c555c-106">Unlike ASP.NET MVC, ASP.NET Core apps are executable apps.</span></span> <span data-ttu-id="c555c-107">Их можно запустить из командной строки с помощью `dotnet run` .</span><span class="sxs-lookup"><span data-stu-id="c555c-107">You can run them from the command line, using `dotnet run`.</span></span> <span data-ttu-id="c555c-108">Они имеют метод точки входа, например все программы на языке C#, обычно `public static void Main()` или аналогичные вариации (возможно, с аргументами или `async` поддержкой).</span><span class="sxs-lookup"><span data-stu-id="c555c-108">They have an entry point method like all C# programs, typically `public static void Main()` or a similar variation (perhaps with arguments or `async` support).</span></span> <span data-ttu-id="c555c-109">Это, вероятно, наибольшее различие в архитектуре между ASP.NET Core и ASP.NET MVC и является одним из нескольких отличий, которые позволяют ASP.NET Core работать в системах, отличных от Windows.</span><span class="sxs-lookup"><span data-stu-id="c555c-109">This is perhaps the biggest architectural difference between ASP.NET Core and ASP.NET MVC, and is one of several differences that allows ASP.NET Core to run on non-Windows systems.</span></span>

## <a name="aspnet-mvc-startup"></a><span data-ttu-id="c555c-110">Запуск ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="c555c-110">ASP.NET MVC Startup</span></span>

<span data-ttu-id="c555c-111">Приложения ASP.NET, размещенные в службах IIS, используют службы IIS для создания экземпляров определенных объектов и вызова определенных методов при поступлении запроса.</span><span class="sxs-lookup"><span data-stu-id="c555c-111">Hosted within IIS, ASP.NET apps rely on IIS to instantiate certain objects and call certain methods when a request arrives.</span></span> <span data-ttu-id="c555c-112">ASP.NET создает экземпляр класса *Global. asax* , который является производным от `HttpApplication` .</span><span class="sxs-lookup"><span data-stu-id="c555c-112">ASP.NET creates an instance of the *Global.asax* file's class, which derives from `HttpApplication`.</span></span> <span data-ttu-id="c555c-113">При получении первого запроса перед обработкой запроса ASP.NET вызывает `Application_Start` метод в классе файла *Global. asax* .</span><span class="sxs-lookup"><span data-stu-id="c555c-113">When the first request is received, before handling the request itself, ASP.NET calls the `Application_Start` method in the *Global.asax* file's class.</span></span> <span data-ttu-id="c555c-114">Любая логика, которая должна выполняться при запуске приложения ASP.NET MVC, может быть добавлена в этот метод.</span><span class="sxs-lookup"><span data-stu-id="c555c-114">Any logic that needs to run when the ASP.NET MVC app begins can be added to this method.</span></span>

<span data-ttu-id="c555c-115">Многие пакеты NuGet для ASP.NET MVC и Web API используют пакет веб- [активатора](https://github.com/davidebbo/WebActivator) , чтобы позволить им выполнять некоторый код во время запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="c555c-115">Many NuGet packages for ASP.NET MVC and Web API use the [WebActivator](https://github.com/davidebbo/WebActivator) package to let them run some code during app startup.</span></span> <span data-ttu-id="c555c-116">По соглашению этот код обычно добавляется в папку *App_Start* и настраивается с помощью атрибута для запуска непосредственно до или сразу после `Application_Start` .</span><span class="sxs-lookup"><span data-stu-id="c555c-116">By convention, this code would typically be added to an *App_Start* folder and would be configured via attribute to run either immediately before or just after `Application_Start`.</span></span>

<span data-ttu-id="c555c-117">Также можно использовать [открытый веб-интерфейс для .NET (OWIN) и Project Katana с ASP.NET MVC](/aspnet/aspnet/overview/owin-and-katana/getting-started-with-owin-and-katana).</span><span class="sxs-lookup"><span data-stu-id="c555c-117">It's also possible to use the [Open Web Interface for .NET (OWIN) and Project Katana with ASP.NET MVC](/aspnet/aspnet/overview/owin-and-katana/getting-started-with-owin-and-katana).</span></span> <span data-ttu-id="c555c-118">При этом приложение будет включать файл *Startup.CS* , который отвечает за настройку по промежуточного слоя запроса, что очень похоже на то, как работает ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="c555c-118">When doing so, the app will include a *Startup.cs* file that is responsible for setting up request middleware in a way that's very similar to how ASP.NET Core behaves.</span></span>

<span data-ttu-id="c555c-119">Если необходимо выполнить код при запуске приложения ASP.NET MVC, обычно используется один из этих подходов.</span><span class="sxs-lookup"><span data-stu-id="c555c-119">If you need to run code when your ASP.NET MVC app starts up, it will typically use one of these approaches.</span></span>

## <a name="aspnet-core-startup"></a><span data-ttu-id="c555c-120">Запуск ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c555c-120">ASP.NET Core Startup</span></span>

<span data-ttu-id="c555c-121">Как отмечалось ранее, ASP.NET Core приложения являются автономными программами.</span><span class="sxs-lookup"><span data-stu-id="c555c-121">As noted previously, ASP.NET Core apps are standalone programs.</span></span> <span data-ttu-id="c555c-122">Таким образом, обычно они включают файл *Program.CS* , содержащий точку входа для приложения.</span><span class="sxs-lookup"><span data-stu-id="c555c-122">As such, they typically include a *Program.cs* file containing the entry point for the app.</span></span> <span data-ttu-id="c555c-123">Типичный пример этого файла приведен на рис. 2-1.</span><span class="sxs-lookup"><span data-stu-id="c555c-123">A typical example of this file is shown in Figure 2-1.</span></span>

```csharp
public class Program
{
    public static void Main(string[] args)
    {
        CreateHostBuilder(args).Build().Run();
    }

    public static IHostBuilder CreateHostBuilder(string[] args) =>
        Host.CreateDefaultBuilder(args)
            .ConfigureWebHostDefaults(webBuilder =>
            {
                webBuilder.UseStartup<Startup>();
            });
}
```

<span data-ttu-id="c555c-124">**Рис. 2-1**.</span><span class="sxs-lookup"><span data-stu-id="c555c-124">**Figure 2-1**.</span></span> <span data-ttu-id="c555c-125">Типичный файл ASP.NET Core *Program.CS* .</span><span class="sxs-lookup"><span data-stu-id="c555c-125">A typical ASP.NET Core *Program.cs* file.</span></span>

<span data-ttu-id="c555c-126">Код, показанный на рисунке 2-1, создает *узел* для приложения, выполняет его сборку и выполняет.</span><span class="sxs-lookup"><span data-stu-id="c555c-126">The code shown in Figure 2-1 creates a *host* for the app, builds it, and runs it.</span></span> <span data-ttu-id="c555c-127">ASP.NET Core приложение выполняется на узле, настроенном указанным на `IHostBuilder` рисунке.</span><span class="sxs-lookup"><span data-stu-id="c555c-127">The ASP.NET Core app runs within the host configured by the `IHostBuilder` shown.</span></span> <span data-ttu-id="c555c-128">Хотя можно полностью настроить ASP.NET Core приложение с помощью `IHostBuilder` , обычно основная часть этой работы выполняется в `Startup` классе.</span><span class="sxs-lookup"><span data-stu-id="c555c-128">While it's possible to completely configure an ASP.NET Core app using the `IHostBuilder`, typically the bulk of this work is done in a `Startup` class.</span></span>

<span data-ttu-id="c555c-129">`Startup`Класс предоставляет два метода для узла: `ConfigureServices` и `Configure` .</span><span class="sxs-lookup"><span data-stu-id="c555c-129">The `Startup` class exposes two methods to the host: `ConfigureServices` and `Configure`.</span></span> <span data-ttu-id="c555c-130">`ConfigureServices`Метод используется для определения служб, которые будут использоваться приложением, и их времени существования.</span><span class="sxs-lookup"><span data-stu-id="c555c-130">The `ConfigureServices` method is used to define the services the app will use and their respective lifetimes.</span></span> <span data-ttu-id="c555c-131">`Configure`Метод используется для определения того, как будет обрабатываться каждый запрос к приложению путем настройки конвейера запросов, состоящего из по промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="c555c-131">The `Configure` method is used to define how each request to the app will be handled by setting up a request pipeline composed of middleware.</span></span>

<span data-ttu-id="c555c-132">В дополнение к коду, связанному с настройкой служб или конвейера запросов приложения, приложения могут иметь другой код, который должен выполняться при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="c555c-132">In addition to code related to configuring the app's services or request pipeline, apps may have other code that must run when the app begins.</span></span> <span data-ttu-id="c555c-133">Такой код обычно размещается в *Program.CS* или регистрируется как `IHostedService` , который будет запускаться [универсальным узлом](/aspnet/core/fundamentals/host/generic-host?preserve-view=true&view=aspnetcore-3.1) при запуске приложения.</span><span class="sxs-lookup"><span data-stu-id="c555c-133">Such code is typically placed in *Program.cs* or registered as an `IHostedService`, which will be started by the [generic host](/aspnet/core/fundamentals/host/generic-host?preserve-view=true&view=aspnetcore-3.1) when the app starts.</span></span>

<span data-ttu-id="c555c-134">`IHostedService`Интерфейс просто предоставляет два метода: `StartAsync` и `StopAsync` .</span><span class="sxs-lookup"><span data-stu-id="c555c-134">The `IHostedService` interface just exposes two methods, `StartAsync` and `StopAsync`.</span></span> <span data-ttu-id="c555c-135">Вы регистрируете интерфейс в `ConfigureServices` , и узел выполняет остальные действия, вызывая `StartAsync` метод перед запуском приложения.</span><span class="sxs-lookup"><span data-stu-id="c555c-135">You register the interface in `ConfigureServices` and the host does the rest, calling the `StartAsync` method before the app starts up.</span></span>

## <a name="porting-considerations"></a><span data-ttu-id="c555c-136">Рекомендации по переносу</span><span class="sxs-lookup"><span data-stu-id="c555c-136">Porting considerations</span></span>

<span data-ttu-id="c555c-137">Группы, которым требуется перенести свои приложения из ASP.NET MVC в ASP.NET Core необходимо определить, какой код выполняется при запуске приложения, и определить соответствующее расположение для такого кода в своем ASP.NET Core приложении.</span><span class="sxs-lookup"><span data-stu-id="c555c-137">Teams looking to migrate their apps from ASP.NET MVC to ASP.NET Core need to identify what code is being run when their app starts up and determine the appropriate location for such code in their ASP.NET Core app.</span></span> <span data-ttu-id="c555c-138">Для пользовательского кода, необходимого для запуска при запуске приложения, особенно асинхронного кода, рекомендуемый подход обычно заключается в помещении этого кода в `IHostedService` реализации.</span><span class="sxs-lookup"><span data-stu-id="c555c-138">For custom code needed to run when the app starts up, especially async code, the recommended approach is typically to put such code into `IHostedService` implementations.</span></span>

## <a name="references"></a><span data-ttu-id="c555c-139">Ссылки</span><span class="sxs-lookup"><span data-stu-id="c555c-139">References</span></span>

- <span data-ttu-id="c555c-140">[Общие сведения о жизненном цикле приложения ASP.NET для IIS 7](/previous-versions/aspnet/bb470252(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="c555c-140">[ASP.NET Application Life Cycle Overview for IIS 7](/previous-versions/aspnet/bb470252(v=vs.100))</span></span>
- <span data-ttu-id="c555c-141">[Общие сведения о жизненном цикле приложения ASP.NET для IIS 5 и 6](/previous-versions/aspnet/ms178473(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="c555c-141">[ASP.NET Application Life Cycle Overview for IIS 5 and 6](/previous-versions/aspnet/ms178473(v=vs.100))</span></span>
- [<span data-ttu-id="c555c-142">Начало работы с OWIN и Katana</span><span class="sxs-lookup"><span data-stu-id="c555c-142">Getting Started with OWIN and Katana</span></span>](/aspnet/aspnet/overview/owin-and-katana/getting-started-with-owin-and-katana)
- [<span data-ttu-id="c555c-143">Активатор</span><span class="sxs-lookup"><span data-stu-id="c555c-143">WebActivator</span></span>](https://github.com/davidebbo/WebActivator)
- [<span data-ttu-id="c555c-144">Запуск приложения в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c555c-144">App Startup in ASP.NET Core</span></span>](/aspnet/core/fundamentals/startup?preserve-view=true&view=aspnetcore-3.1)
- [<span data-ttu-id="c555c-145">Универсальный узел .NET в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="c555c-145">.NET Generic Host in ASP.NET Core</span></span>](/aspnet/core/fundamentals/host/generic-host?preserve-view=true&view=aspnetcore-3.1)
- [<span data-ttu-id="c555c-146">IHostedService</span><span class="sxs-lookup"><span data-stu-id="c555c-146">IHostedService</span></span>](../microservices/multi-container-microservice-net-applications/background-tasks-with-ihostedservice.md)

>[!div class="step-by-step"]
><span data-ttu-id="c555c-147">[Назад](architectural-differences.md)
>[Вперед](hosting-differences.md)</span><span class="sxs-lookup"><span data-stu-id="c555c-147">[Previous](architectural-differences.md)
[Next](hosting-differences.md)</span></span>
