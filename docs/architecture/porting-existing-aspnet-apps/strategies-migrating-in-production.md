---
title: Стратегии миграции для решений в рабочей среде
description: Возможно, не удастся тенабле перенос большого приложения из ASP.NET MVC в ASP.NET Core все одновременно. Узнайте о некоторых стратегиях переноса приложения в ASP.NET Core, не прерывая работу и в рабочей среде для существующих пользователей.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 4910984cb281139493aa5424809ba3eedab776e9
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401691"
---
# <a name="strategies-for-migrating-while-running-in-production"></a><span data-ttu-id="fc3b9-104">Стратегии миграции для решений в рабочей среде</span><span class="sxs-lookup"><span data-stu-id="fc3b9-104">Strategies for migrating while running in production</span></span>

<span data-ttu-id="fc3b9-105">Многие команды имеют платформа .NET Framework приложения, которые планируется перенести в .NET Core, но приложение настолько велико, что для выполнения миграции требуется значительное время.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-105">Many teams have .NET Framework apps they plan to migrate to .NET Core, but the app is so large that the migration requires a significant amount of time to complete.</span></span> <span data-ttu-id="fc3b9-106">Исходное приложение должно быть включено, пока миграция выполняется частью.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-106">The original app needs to live on while the migration is done piece by piece.</span></span> <span data-ttu-id="fc3b9-107">Чтобы старые и новые версии приложения работали параллельно, а также для старой версии, необходимо, по крайней мере, какой-либо другой способ, не нарушая его.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-107">There needs to be a way for the old and new versions of the app to work together side-by-side, or for the old version to be migrated in-place, at least some of the way, without breaking it.</span></span> <span data-ttu-id="fc3b9-108">Для поддержки этих целей команды могут использовать множество различных стратегий.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-108">Teams can employ many different strategies to support these goals.</span></span>

## <a name="refactor-the-net-framework-solution"></a><span data-ttu-id="fc3b9-109">Рефакторинг решения платформа .NET Framework</span><span class="sxs-lookup"><span data-stu-id="fc3b9-109">Refactor the .NET Framework solution</span></span>

<span data-ttu-id="fc3b9-110">Если вы планируете перенести приложение платформа .NET Framework в .NET Core, лучше всего запустить его, чтобы лучше работать с .NET Core.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-110">A good place to start if you plan to port a .NET Framework app to .NET Core is to refactor it to work better with .NET Core.</span></span> <span data-ttu-id="fc3b9-111">Это означает, что вы обновляете отдельные библиотеки классов для .NET Standard и перемещаете как можно больше логики из проектов ASP.NET MVC и в эти библиотеки классов.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-111">This means updating individual class libraries to target .NET Standard and moving as much logic out of your ASP.NET MVC projects and into these class libraries.</span></span> <span data-ttu-id="fc3b9-112">Любой код, имеющийся в .NET Standard библиотеках, должен относительно легко перемещаться от платформа .NET Framework к .NET Core.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-112">Any code you have in .NET Standard libraries should move relatively easily from .NET Framework to .NET Core.</span></span>

<span data-ttu-id="fc3b9-113">При рефакторинге убедитесь, что вы используете оптимальные основы рефакторинга.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-113">When refactoring, make sure you're following good refactoring fundamentals.</span></span> <span data-ttu-id="fc3b9-114">Например, создайте тесты, которые проверяют, что делает система, перед началом рефакторинга.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-114">For example, create tests that verify what the system does before you start refactoring.</span></span> <span data-ttu-id="fc3b9-115">Выполните эти тесты, когда вы закончите, чтобы подтвердить, что поведение системы не изменилось.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-115">Run these tests when you're done to confirm you didn't change the system's behavior.</span></span> <span data-ttu-id="fc3b9-116">Если у вас еще нет хорошего набора автоматических тестов, вам может потребоваться добавить в систему тестовые проверки на символы.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-116">You may need to add characterization tests to the system if you don't already have a good suite of automated tests you can rely on.</span></span>

## <a name="extract-front-end-assets-to-a-cdn"></a><span data-ttu-id="fc3b9-117">Извлечение интерфейсных ресурсов в CDN</span><span class="sxs-lookup"><span data-stu-id="fc3b9-117">Extract front-end assets to a CDN</span></span>

<span data-ttu-id="fc3b9-118">Если приложения платформа .NET Framework включают в себя множество статических ресурсов, таких как сценарии, CSS-файлы или изображения, их можно перенести в отдельную сеть CDN.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-118">If your .NET Framework apps include a lot of static assets, like scripts, CSS files, or images, you may be able to migrate these to a separate CDN.</span></span> <span data-ttu-id="fc3b9-119">Затем обновите существующее приложение, чтобы оно ссылалось на ссылки CDN для этих ресурсов.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-119">Then, update the existing app to reference the CDN links for these assets.</span></span> <span data-ttu-id="fc3b9-120">При переносе приложения в .NET Core эти статические файлы не будут входить в миграцию, и вы просто продолжите ссылаться на них из CDN в ASP.NET Core приложении.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-120">When you port the app to .NET Core, these static files won't be part of the migration, and you'll just continue referencing them from the CDN in the ASP.NET Core app.</span></span>

## <a name="extract-and-migrate-individual-microservices"></a><span data-ttu-id="fc3b9-121">Извлечение и перенос отдельных микрослужб</span><span class="sxs-lookup"><span data-stu-id="fc3b9-121">Extract and migrate individual microservices</span></span>

<span data-ttu-id="fc3b9-122">Крупные платформа .NET Framework приложения могут уже состоять из отдельных интерфейсных систем, которые можно перенести отдельно.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-122">Large .NET Framework apps may already be comprised of separate front-end systems that can be migrated individually.</span></span> <span data-ttu-id="fc3b9-123">Или они могут быть кандидатами на миграцию в архитектуру микрослужб, при этом некоторые части существующих приложений MVC ASP.NET будут извлечены в новые ASP.NET Core реализации микрослужб.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-123">Or they may be candidates for migration to a microservices architecture, with some pieces of existing ASP.NET MVC apps being pulled out into new ASP.NET Core microservice implementations.</span></span> <span data-ttu-id="fc3b9-124">Дополнительные сведения о микрослужбах см. в связанной электронной книге, [микрослужбах .NET — архитектуре для контейнерных приложений .NET](https://aka.ms/microservicesebook).</span><span class="sxs-lookup"><span data-stu-id="fc3b9-124">You can learn more about microservices in the associated ebook, [.NET Microservices: Architecture for Containerized .NET Applications](https://aka.ms/microservicesebook).</span></span>

<span data-ttu-id="fc3b9-125">Например, имеющееся приложение может иметь набор используемых им функций, связанных с входом и регистрацией пользователя.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-125">For example, the existing app might have a set of features it uses related to user sign-in and registration.</span></span> <span data-ttu-id="fc3b9-126">Их можно перенести в отдельную микрослужбу, которая может быть создана и развернута с помощью ASP.NET Core а затем интегрирована в устаревшее платформа .NET Framework приложение.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-126">These could be migrated to a separate microservice, which could be built and deployed using ASP.NET Core and then integrated into the legacy .NET Framework app.</span></span> <span data-ttu-id="fc3b9-127">Теперь у приложения может быть несколько страниц, предназначенных для отслеживания покупательской корзины отдельного пользователя.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-127">Next, the app might have a few pages dedicated to tracking the individual user's shopping cart.</span></span> <span data-ttu-id="fc3b9-128">Эти страницы также можно извлечь в отдельную микрослужбу и снова интегрировать в существующее приложение.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-128">These pages could also be pulled out into their own separate microservice and again integrated into the existing app.</span></span> <span data-ttu-id="fc3b9-129">Таким образом, исходное приложение платформа .NET Framework продолжит работать в рабочей среде, но с другими функциями, поступающими от современных микрослужб .NET Core.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-129">In this way, the original .NET Framework app continues running in production, but with more and more of its features coming from modernized .NET Core microservices.</span></span>

## <a name="deploy-multiple-versions-of-the-app-side-by-side-in-iis"></a><span data-ttu-id="fc3b9-130">Параллельное развертывание нескольких версий приложения в службах IIS</span><span class="sxs-lookup"><span data-stu-id="fc3b9-130">Deploy multiple versions of the app side-by-side in IIS</span></span>

<span data-ttu-id="fc3b9-131">Используя сочетание заголовков узлов и перенаправлений, существующее приложение ASP.NET MVC можно настроить для параллельного выполнения с ASP.NET Coreным приложением на том же сервере IIS.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-131">Using a combination of host headers and redirects, an existing ASP.NET MVC app can be configured to run side by side with an ASP.NET Core app on the same IIS server.</span></span> <span data-ttu-id="fc3b9-132">Как части функциональности, такие как отдельные контроллеры, переносятся в ASP.NET Core, их маршруты и URL-адреса сопоставляются в службах IIS для целевого веб-сайта ASP.NET Core или дочернего приложения (виртуальные каталоги IIS не поддерживаются в приложениях ASP.NET Core).</span><span class="sxs-lookup"><span data-stu-id="fc3b9-132">As pieces of functionality, such as individual controllers, are ported to ASP.NET Core, their routes and URLs are mapped within IIS to target the ASP.NET Core web site or sub-application (IIS virtual directories aren't supported with ASP.NET Core apps).</span></span> <span data-ttu-id="fc3b9-133">Приложение ASP.NET Core можно разместить как вложенное приложение IIS.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-133">An ASP.NET Core app can be hosted as an IIS sub-application (sub-app).</span></span> <span data-ttu-id="fc3b9-134">Путь к вложенному приложению становится частью URL-адреса главного приложения.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-134">The sub-app's path becomes part of the root app's URL.</span></span>

## <a name="apply-the-strangler-pattern"></a><span data-ttu-id="fc3b9-135">Применение шаблона подавления</span><span class="sxs-lookup"><span data-stu-id="fc3b9-135">Apply the Strangler pattern</span></span>

<span data-ttu-id="fc3b9-136">Крупные ASP.NET приложения MVC можно постепенно заменить новым приложением ASP.NET Core путем постепенного переноса компонентов функциональности.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-136">Large ASP.NET MVC apps can be gradually replaced with a new ASP.NET Core app by incrementally migrating pieces of functionality.</span></span> <span data-ttu-id="fc3b9-137">Одним из подходов к этому называется [шаблон подавления](/azure/architecture/patterns/strangler), именуемый для подавления Vines, которые странгле и в конечном итоге перерывают деревья.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-137">One approach to this is called the [strangler pattern](/azure/architecture/patterns/strangler), named for strangler vines that strangle and eventually tear down trees.</span></span> <span data-ttu-id="fc3b9-138">Этот подход основан на первой реализации слоя фасадной поверх существующего решения.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-138">This approach relies on first implementing a facade layer over top of the existing solution.</span></span> <span data-ttu-id="fc3b9-139">Этот фасадной должен быть создан с помощью нового подхода к проблеме или готового решения, такого как шлюз API.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-139">This facade should be built using the new approach to the problem, or an off-the-shelf solution such as an API gateway.</span></span>

<span data-ttu-id="fc3b9-140">После фасадной можно направить его часть в новое приложение ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-140">Once the facade is in place, you can route part of it to a new ASP.NET Core app.</span></span> <span data-ttu-id="fc3b9-141">Когда вы переносите больше исходного приложения платформа .NET Framework в .NET Core, вы продолжаете обновлять слой фасадной соответствующим образом, отправляя в новую систему больше функций фаçаде'с.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-141">As you port more of the original .NET Framework app to .NET Core, you continue to update the facade layer accordingly, sending more of the facade's total functionality to the new system.</span></span> <span data-ttu-id="fc3b9-142">На рис. 3-5 показан ход выполнения шаблона подавления с течением времени.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-142">Figure 3-5 shows the strangler pattern progression over time.</span></span>

## <a name="multi-targeting-approaches"></a><span data-ttu-id="fc3b9-143">Подходы к многоплатформенному нацеливанию</span><span class="sxs-lookup"><span data-stu-id="fc3b9-143">Multi-targeting approaches</span></span>

<span data-ttu-id="fc3b9-144">Большие приложения, предназначенные для платформа .NET Framework, могут быть перенесены в ASP.NET Core с течением времени с использованием различных версий и отдельных путей кода для каждой платформы.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-144">Large apps that target .NET Framework may be migrated to ASP.NET Core over time by using multi-targeting and separate code paths for each framework.</span></span> <span data-ttu-id="fc3b9-145">Например, код, который должен выполняться в обеих средах, можно изменить с помощью директив [препроцессора `#if` ](../../csharp/language-reference/preprocessor-directives/preprocessor-if.md) , чтобы реализовать различные функциональные возможности или использовать разные зависимости при запуске в платформа .NET Framework и .NET Core.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-145">For example, code that must run in both environments could be modified with [preprocessor `#if`](../../csharp/language-reference/preprocessor-directives/preprocessor-if.md) directives to implement different functionality or use different dependencies when run in .NET Framework versus .NET Core.</span></span> <span data-ttu-id="fc3b9-146">Другим вариантом является изменение файлов проекта для включения различных наборов файлов в зависимости от целевой платформы.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-146">Another option is to modify project files to include different sets of files based on which framework is being targeted.</span></span> <span data-ttu-id="fc3b9-147">Файлы проектов могут использовать различные шаблоны глобализации, например `*.core.cs` , для включения различных наборов исходных файлов в зависимости от целевой платформы.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-147">Project files can use different globbing patterns, such as `*.core.cs`, to include different sets of source files depending on the framework being targeted.</span></span>

<span data-ttu-id="fc3b9-148">Эти методы позволяют поддерживать единую общую базу кода при добавлении новых функций и (части) приложения переноситься на использование .NET Core.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-148">These techniques allow a single common codebase to be maintained while new functionality is added and (parts of) the app are ported to use .NET Core.</span></span>

![Рис. 3-5](media/Figure3-5.png)

<span data-ttu-id="fc3b9-150">**Рис. 3-5.**</span><span class="sxs-lookup"><span data-stu-id="fc3b9-150">**Figure 3-5.**</span></span> <span data-ttu-id="fc3b9-151">Шаблон подавления с течением времени.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-151">The Strangler pattern over time.</span></span>

<span data-ttu-id="fc3b9-152">Со временем весь слой фасадной соответствует новой современной реализации.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-152">Eventually, the entire facade layer corresponds to the new, modern implementation.</span></span> <span data-ttu-id="fc3b9-153">На этом этапе можно снять с учета как устаревшую систему, так и слой лицевой стороны.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-153">At this point, both the legacy system and the face layer can be retired.</span></span>

## <a name="summary"></a><span data-ttu-id="fc3b9-154">Итоги</span><span class="sxs-lookup"><span data-stu-id="fc3b9-154">Summary</span></span>

<span data-ttu-id="fc3b9-155">Часто крупные ASP.NET MVC и приложения веб-API не переносятся в ASP.NET Core все сразу, но будут постепенно переноситься по времени.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-155">Frequently, large ASP.NET MVC and Web API apps won't be ported to ASP.NET Core all at once, but will migrate incrementally over time.</span></span> <span data-ttu-id="fc3b9-156">В этом разделе предлагается несколько стратегий выполнения этой добавочной миграции.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-156">This section offers several strategies for performing this incremental migration.</span></span> <span data-ttu-id="fc3b9-157">Выберите один из них (ы), который будет работать лучше для вашей организации и приложения.</span><span class="sxs-lookup"><span data-stu-id="fc3b9-157">Choose the one(s) that will work best for your organization and app.</span></span>

## <a name="references"></a><span data-ttu-id="fc3b9-158">Ссылки</span><span class="sxs-lookup"><span data-stu-id="fc3b9-158">References</span></span>

- [<span data-ttu-id="fc3b9-159">Микрослужбы .NET: архитектура контейнерных приложений .NET</span><span class="sxs-lookup"><span data-stu-id="fc3b9-159">.NET Microservices: Architecture for Containerized .NET Applications</span></span>](https://aka.ms/microservicesebook)
- [<span data-ttu-id="fc3b9-160">Приложение микрослужб для ссылки на eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="fc3b9-160">eShopOnContainers Reference Microservices Application</span></span>](https://github.com/dotnet-architecture/eShopOnContainers)
- [<span data-ttu-id="fc3b9-161">Размещение ASP.NET Core в Windows со службами IIS</span><span class="sxs-lookup"><span data-stu-id="fc3b9-161">Host ASP.NET Core on Windows with IIS</span></span>](/aspnet/core/host-and-deploy/iis/)
- [<span data-ttu-id="fc3b9-162">Шаблон подавления</span><span class="sxs-lookup"><span data-stu-id="fc3b9-162">Strangler pattern</span></span>](/azure/architecture/patterns/strangler)

>[!div class="step-by-step"]
><span data-ttu-id="fc3b9-163">[Назад](understand-update-dependencies.md)
>[Вперед](example-migration-eshop.md)</span><span class="sxs-lookup"><span data-stu-id="fc3b9-163">[Previous](understand-update-dependencies.md)
[Next](example-migration-eshop.md)</span></span>
