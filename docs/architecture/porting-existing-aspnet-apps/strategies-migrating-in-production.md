---
title: Стратегии миграции для решений в рабочей среде
description: Возможно, не удастся тенабле перенос большого приложения из ASP.NET MVC в ASP.NET Core все одновременно. Узнайте о некоторых стратегиях переноса приложения в ASP.NET Core, не прерывая работу и в рабочей среде для существующих пользователей.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: e9dcdb3594cc431f3fd7e71b16e0d806ab8d1ba6
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2021
ms.locfileid: "105637095"
---
# <a name="strategies-for-migrating-while-running-in-production"></a>Стратегии миграции для решений в рабочей среде

Многие команды имеют платформа .NET Framework приложения, которые планируется перенести в .NET Core, но приложение настолько велико, что для выполнения миграции требуется значительное время. Исходное приложение должно быть включено, пока миграция выполняется частью. Чтобы старые и новые версии приложения работали параллельно, а также для старой версии, необходимо, по крайней мере, какой-либо другой способ, не нарушая его. Для поддержки этих целей команды могут использовать множество различных стратегий.

## <a name="refactor-the-net-framework-solution"></a>Рефакторинг решения платформа .NET Framework

Если вы планируете перенести приложение платформа .NET Framework в .NET Core, лучше всего запустить его, чтобы лучше работать с .NET Core. Это означает, что вы обновляете отдельные библиотеки классов для .NET Standard и перемещаете как можно больше логики из проектов ASP.NET MVC и в эти библиотеки классов. Любой код, имеющийся в .NET Standard библиотеках, должен относительно легко перемещаться от платформа .NET Framework к .NET Core.

При рефакторинге убедитесь, что вы используете оптимальные основы рефакторинга. Например, создайте тесты, которые проверяют, что делает система, перед началом рефакторинга. Выполните эти тесты, когда вы закончите, чтобы подтвердить, что поведение системы не изменилось. Если у вас еще нет хорошего набора автоматических тестов, вам может потребоваться добавить в систему тестовые проверки на символы.

## <a name="extract-front-end-assets-to-a-cdn"></a>Извлечение интерфейсных ресурсов в CDN

Если приложения платформа .NET Framework включают в себя множество статических ресурсов, таких как сценарии, CSS-файлы или изображения, их можно перенести в отдельную сеть CDN. Затем обновите существующее приложение, чтобы оно ссылалось на ссылки CDN для этих ресурсов. При переносе приложения в .NET Core эти статические файлы не будут входить в миграцию, и вы просто продолжите ссылаться на них из CDN в ASP.NET Core приложении.

## <a name="extract-and-migrate-individual-microservices"></a>Извлечение и перенос отдельных микрослужб

Крупные платформа .NET Framework приложения могут уже состоять из отдельных интерфейсных систем, которые можно перенести отдельно. Или они могут быть кандидатами на миграцию в архитектуру микрослужб, при этом некоторые части существующих приложений MVC ASP.NET будут извлечены в новые ASP.NET Core реализации микрослужб. Дополнительные сведения о микрослужбах см. в связанной электронной книге, [микрослужбах .NET — архитектуре для контейнерных приложений .NET](https://aka.ms/microservicesebook).

Например, имеющееся приложение может иметь набор используемых им функций, связанных с входом и регистрацией пользователя. Их можно перенести в отдельную микрослужбу, которая может быть создана и развернута с помощью ASP.NET Core а затем интегрирована в устаревшее платформа .NET Framework приложение. Теперь у приложения может быть несколько страниц, предназначенных для отслеживания покупательской корзины отдельного пользователя. Эти страницы также можно извлечь в отдельную микрослужбу и снова интегрировать в существующее приложение. Таким образом, исходное приложение платформа .NET Framework продолжит работать в рабочей среде, но с другими функциями, поступающими от современных микрослужб .NET Core.

## <a name="deploy-multiple-versions-of-the-app-side-by-side-in-iis"></a>Параллельное развертывание нескольких версий приложения в службах IIS

Используя сочетание заголовков узлов и перенаправлений, существующее приложение ASP.NET MVC можно настроить для параллельного выполнения с ASP.NET Coreным приложением на том же сервере IIS. Как части функциональности, такие как отдельные контроллеры, переносятся в ASP.NET Core, их маршруты и URL-адреса сопоставляются в службах IIS для целевого веб-сайта ASP.NET Core или дочернего приложения (виртуальные каталоги IIS не поддерживаются в приложениях ASP.NET Core). Приложение ASP.NET Core можно разместить как вложенное приложение IIS. Путь к вложенному приложению становится частью URL-адреса главного приложения.

## <a name="apply-the-strangler-pattern"></a>Применение шаблона подавления

Крупные ASP.NET приложения MVC можно постепенно заменить новым приложением ASP.NET Core путем постепенного переноса компонентов функциональности. Одним из подходов к этому называется [шаблон подавления](/azure/architecture/patterns/strangler), именуемый для подавления Vines, которые странгле и в конечном итоге перерывают деревья. Этот подход основан на первой реализации слоя фасадной поверх существующего решения. Этот фасадной должен быть создан с помощью нового подхода к проблеме или готового решения, такого как шлюз API.

После фасадной можно направить его часть в новое приложение ASP.NET Core. Когда вы переносите больше исходного приложения платформа .NET Framework в .NET Core, вы продолжаете обновлять слой фасадной соответствующим образом, отправляя в новую систему больше функций фаçаде'с. На рис. 3-5 показан ход выполнения шаблона подавления с течением времени.

## <a name="multi-targeting-approaches"></a>Подходы к многоплатформенному нацеливанию

Большие приложения, предназначенные для платформа .NET Framework, могут быть перенесены в ASP.NET Core с течением времени с использованием различных версий и отдельных путей кода для каждой платформы. Например, код, который должен выполняться в обеих средах, можно изменить с помощью директив [препроцессора `#if` ](../../csharp/language-reference/preprocessor-directives.md#conditional-compilation) , чтобы реализовать различные функциональные возможности или использовать разные зависимости при запуске в платформа .NET Framework и .NET Core. Другим вариантом является изменение файлов проекта для включения различных наборов файлов в зависимости от целевой платформы. Файлы проектов могут использовать различные шаблоны глобализации, например `*.core.cs` , для включения различных наборов исходных файлов в зависимости от целевой платформы.

Эти методы позволяют поддерживать единую общую базу кода при добавлении новых функций и (части) приложения переноситься на использование .NET Core.

![Рис. 3-5](media/Figure3-5.png)

**Рис. 3-5.** Шаблон подавления с течением времени.

Со временем весь слой фасадной соответствует новой современной реализации. На этом этапе можно снять с учета как устаревшую систему, так и слой лицевой стороны.

## <a name="summary"></a>Сводка

Часто крупные ASP.NET MVC и приложения веб-API не переносятся в ASP.NET Core все сразу, но будут постепенно переноситься по времени. В этом разделе предлагается несколько стратегий выполнения этой добавочной миграции. Выберите один из них (ы), который будет работать лучше для вашей организации и приложения.

## <a name="references"></a>Ссылки

- [Микрослужбы .NET: архитектура контейнерных приложений .NET](https://aka.ms/microservicesebook)
- [Приложение микрослужб для ссылки на eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers)
- [Размещение ASP.NET Core в Windows со службами IIS](/aspnet/core/host-and-deploy/iis/)
- [Шаблон подавления](/azure/architecture/patterns/strangler)

>[!div class="step-by-step"]
>[Назад](understand-update-dependencies.md)
>[Вперед](example-migration-eshop.md)
