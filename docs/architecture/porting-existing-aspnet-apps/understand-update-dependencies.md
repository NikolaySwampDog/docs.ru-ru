---
title: Общие сведения о зависимостях и их обновление
description: Чтобы перенести платформа .NET Framework проект в .NET Core, его зависимости необходимо обновить для работы с .NET Core. В этом разделе рассматриваются средства и подходы, которые можно использовать для планирования миграции для больших приложений.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 484691496d3691151fd3ca83ec776dbb31327c09
ms.sourcegitcommit: b5d2290673e1c91260c9205202dd8b95fbab1a0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2021
ms.locfileid: "106122759"
---
# <a name="understand-and-update-dependencies"></a><span data-ttu-id="a0e31-104">Общие сведения о зависимостях и их обновление</span><span class="sxs-lookup"><span data-stu-id="a0e31-104">Understand and update dependencies</span></span>

<span data-ttu-id="a0e31-105">После определения последовательности, в которой необходимо перенести отдельные проекты приложения, следует понять зависимости каждого проекта и при необходимости обновить их.</span><span class="sxs-lookup"><span data-stu-id="a0e31-105">After identifying the sequence in which the app's individual projects must be migrated, the next step is to understand each project's dependencies and update them if necessary.</span></span> <span data-ttu-id="a0e31-106">Для зависимостей платформы лучше всего запустить [анализатор переносимости .NET](../../standard/analyzers/portability-analyzer.md) для рассматриваемой сборки, а затем просмотреть подробные полученные результаты.</span><span class="sxs-lookup"><span data-stu-id="a0e31-106">For platform dependencies, the best way to start is to run the [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) on the assembly in question, and then look at the detailed results that are generated.</span></span> <span data-ttu-id="a0e31-107">Вы настраиваете средство для указания одной или нескольких целевых платформ, таких как .NET Core 3,1 или .NET Standard 2,0.</span><span class="sxs-lookup"><span data-stu-id="a0e31-107">You configure the tool to specify one or more target platforms, such as .NET Core 3.1 or .NET Standard 2.0.</span></span> <span data-ttu-id="a0e31-108">Результаты предоставляются с подробностями для каждой целевой платформы.</span><span class="sxs-lookup"><span data-stu-id="a0e31-108">Results are provided with details for each platform targeted.</span></span> <span data-ttu-id="a0e31-109">На рис. 3-4 показан пример выходных данных средства.</span><span class="sxs-lookup"><span data-stu-id="a0e31-109">Figure 3-4 shows an example of the tool's output.</span></span>

![Сведения о отчете анализатора переносимости .NET](./media/Figure3-4.png)

<span data-ttu-id="a0e31-111">**Рис. 3-4.**</span><span class="sxs-lookup"><span data-stu-id="a0e31-111">**Figure 3-4.**</span></span> <span data-ttu-id="a0e31-112">Сведения о отчете анализатора переносимости .NET.</span><span class="sxs-lookup"><span data-stu-id="a0e31-112">.NET Portability Analyzer report details.</span></span>

## <a name="update-class-library-dependencies"></a><span data-ttu-id="a0e31-113">Обновить зависимости библиотеки классов</span><span class="sxs-lookup"><span data-stu-id="a0e31-113">Update class library dependencies</span></span>

<span data-ttu-id="a0e31-114">Крупные приложения обычно используют несколько проектов, и большинство проектов, отличных от веб-проекта ASP.NET MVC, скорее всего, являются библиотеками классов.</span><span class="sxs-lookup"><span data-stu-id="a0e31-114">Large apps typically involve multiple projects, and most projects other than the ASP.NET MVC web project are likely to be class libraries.</span></span> <span data-ttu-id="a0e31-115">Библиотеки классов, как правило, представляют собой самый простой способ переноса между платформами .NET, особенно по сравнению с проектами ASP.NET, которые являются наиболее сложными (и обычно требуют повторного создания).</span><span class="sxs-lookup"><span data-stu-id="a0e31-115">Class libraries tend to be the easiest to port between .NET platforms, especially compared to ASP.NET projects, which are among the most difficult (and typically need to be re-created).</span></span>

<span data-ttu-id="a0e31-116">Для переноса библиотек классов в .NET Core команды могут использовать [средство "try-Convert](https://github.com/dotnet/try-convert) " или " [Помощник по обновлению .NET](https://aka.ms/dotnet-upgrade-assistant) ".</span><span class="sxs-lookup"><span data-stu-id="a0e31-116">Teams can consider the [try-convert tool](https://github.com/dotnet/try-convert) or the [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) for migrating class libraries to .NET Core.</span></span> <span data-ttu-id="a0e31-117">Эти средства анализируют файл проекта платформа .NET Framework и пытаются перенести его в формат файла проекта .NET Core, делая любые изменения, которые он может безопасно выполнять в процессе.</span><span class="sxs-lookup"><span data-stu-id="a0e31-117">These tools analyze a .NET Framework project file and attempt to migrate it to the .NET Core project file format, making any modifications it can safely perform in the process.</span></span> <span data-ttu-id="a0e31-118">Средствам может потребоваться ручная помощь по работе с проектами ASP.NET, но обычно они помогают ускорить процесс миграции библиотек классов.</span><span class="sxs-lookup"><span data-stu-id="a0e31-118">The tools may require some manual assistance to work with ASP.NET projects, but can usually help speed up the process of migrating class libraries.</span></span>

<span data-ttu-id="a0e31-119">Средства "попробовать-преобразовать" и "помощник по обновлению" развертываются в виде средств командной строки .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a0e31-119">The try-convert and Upgrade Assistant tools are deployed as .NET Core command line tools.</span></span> <span data-ttu-id="a0e31-120">Они работают только в Windows, так как они предназначены для работы с платформа .NET Framework приложениями.</span><span class="sxs-lookup"><span data-stu-id="a0e31-120">They only run on Windows, since they're designed to work with .NET Framework apps.</span></span> <span data-ttu-id="a0e31-121">Можно установить команду try-Convert, выполнив следующую команду из командной строки:</span><span class="sxs-lookup"><span data-stu-id="a0e31-121">You can install try-convert by running the following command from a command prompt:</span></span>

```dotnetcli
dotnet tool install -g try-convert
```

<span data-ttu-id="a0e31-122">После успешной установки средства можно запустить `try-convert` в папке, в которой находится файл проекта библиотеки классов.</span><span class="sxs-lookup"><span data-stu-id="a0e31-122">Once you've successfully installed the tool, you can run `try-convert` in the folder where the class library's project file is located.</span></span>

<span data-ttu-id="a0e31-123">Установите помощник по обновлению .NET с помощью следующей команды (после установки try-Convert):</span><span class="sxs-lookup"><span data-stu-id="a0e31-123">Install the .NET Upgrade Assistant with the following command (after installing try-convert):</span></span>

```dotnetcli
dotnet tool install -g upgrade-assistant
```

<span data-ttu-id="a0e31-124">Запустите средство с помощью команды `upgrade-assistant <project>` в папке, в которой находится файл проекта.</span><span class="sxs-lookup"><span data-stu-id="a0e31-124">Run the tool with the command `upgrade-assistant <project>` in the folder where the project file is located.</span></span>

## <a name="update-nuget-package-dependencies"></a><span data-ttu-id="a0e31-125">Обновление зависимостей пакета NuGet</span><span class="sxs-lookup"><span data-stu-id="a0e31-125">Update NuGet package dependencies</span></span>

<span data-ttu-id="a0e31-126">Анализируйте использование сторонних пакетов NuGet и определите, не поддерживают ли они какие-либо из них .NET Standard (или они поддерживаются только с новой версией).</span><span class="sxs-lookup"><span data-stu-id="a0e31-126">Analyze your use of third-party NuGet packages and determine if any of them don't yet support .NET Standard (or do support it but only with a new version).</span></span> <span data-ttu-id="a0e31-127">Может быть полезно [обновить пакеты NuGet, чтобы использовать `<PackageReference>` синтаксис с помощью средства преобразования Visual Studio](/nuget/consume-packages/migrate-packages-config-to-package-reference), чтобы были видны зависимости верхнего уровня.</span><span class="sxs-lookup"><span data-stu-id="a0e31-127">It can be helpful to [update NuGet packages to use `<PackageReference>` syntax using Visual Studio's converter tool](/nuget/consume-packages/migrate-packages-config-to-package-reference), so that top-level dependencies are visible.</span></span> <span data-ttu-id="a0e31-128">Затем проверьте, поддерживают ли текущая или более поздние версии этих пакетов .NET Core или .NET Standard.</span><span class="sxs-lookup"><span data-stu-id="a0e31-128">Next, check whether the current or later versions of these packages support .NET Core or .NET Standard.</span></span> <span data-ttu-id="a0e31-129">Эти сведения можно найти в [nuget.org] или в Visual Studio для каждого пакета.</span><span class="sxs-lookup"><span data-stu-id="a0e31-129">This information can be found on [nuget.org] or within Visual Studio for each package.</span></span>

<span data-ttu-id="a0e31-130">Если поддержка существует с использованием версии пакета, используемой в настоящее время приложением, отлично!</span><span class="sxs-lookup"><span data-stu-id="a0e31-130">If support exists using the version of the package the app currently uses, great!</span></span> <span data-ttu-id="a0e31-131">Если это не так, проверьте, есть ли у более поздней версии пакета поддержка и исследование того, что будет вовлечено в обновление.</span><span class="sxs-lookup"><span data-stu-id="a0e31-131">If not, see if a more recent version of the package has the support and research what would be involved in upgrading.</span></span> <span data-ttu-id="a0e31-132">В пакете могут присутствовать критические изменения, особенно если основной номер версии пакета изменяется между текущей используемой версией и той, до которой выполняется обновление.</span><span class="sxs-lookup"><span data-stu-id="a0e31-132">There may be breaking changes in the package, especially if the major version of the package changes between your currently used version and the one to which you're upgrading.</span></span>

<span data-ttu-id="a0e31-133">В некоторых случаях версия данного пакета не работает с .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a0e31-133">In some cases, no version of a given package works with .NET Core.</span></span> <span data-ttu-id="a0e31-134">В этом случае команды имеют несколько вариантов.</span><span class="sxs-lookup"><span data-stu-id="a0e31-134">In that case, teams have a couple options.</span></span> <span data-ttu-id="a0e31-135">Они могут продолжать работу в зависимости от версии платформа .NET Framework, но это имеет ограничения.</span><span class="sxs-lookup"><span data-stu-id="a0e31-135">They can continue depending on the .NET Framework version, but this has limitations.</span></span> <span data-ttu-id="a0e31-136">Приложение может работать только в Windows, и группа может захотеть запустить анализатор переносимости в двоичных файлах пакета, чтобы узнать, есть ли проблемы, которые могут возникнуть.</span><span class="sxs-lookup"><span data-stu-id="a0e31-136">The app may only run on Windows, and the team may want to run Portability Analyzer on the package's binaries to see if there are any issues likely to be encountered.</span></span> <span data-ttu-id="a0e31-137">Безусловно, команда будет тщательно тестироваться, так как при использовании платформа .NET Framework пакетов, которые ссылаются на API, недоступные в .NET Core, возникнет исключение времени выполнения.</span><span class="sxs-lookup"><span data-stu-id="a0e31-137">Certainly the team will want to test thoroughly, since if .NET Framework packages are used that reference APIs not available in .NET Core, a runtime exception will occur.</span></span> <span data-ttu-id="a0e31-138">Другой вариант — найти другой пакет или, если требуемый пакет является открытым исходным кодом, обновите его до .NET Standard или .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a0e31-138">The other option is to find a different package or, if the required package is open source, upgrade it to .NET Standard or .NET Core themselves.</span></span>

## <a name="migrate-aspnet-mvc-projects"></a><span data-ttu-id="a0e31-139">Миграция проектов ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="a0e31-139">Migrate ASP.NET MVC projects</span></span>

<span data-ttu-id="a0e31-140">`System.Web`Пространство имен и типы не существуют в .NET Core.</span><span class="sxs-lookup"><span data-stu-id="a0e31-140">The `System.Web` namespace and types don't exist in .NET Core.</span></span> <span data-ttu-id="a0e31-141">При анализе зависимостей и использовании таких средств, как `try-convert` , вы обнаружите, что они не предлагают много предложений по автоматическому переносу проектов ASP.NET MVC и любому коду в них, на который ссылается `System.Web` .</span><span class="sxs-lookup"><span data-stu-id="a0e31-141">When you're analyzing dependencies and using tools like `try-convert`, you'll find they don't offer many suggestions for automatic migration of ASP.NET MVC projects and any code in them that references `System.Web`.</span></span> <span data-ttu-id="a0e31-142">Для этих проектов необходимо начать с нового веб-проекта ASP.NET Core и вручную перенести файлы в этот проект.</span><span class="sxs-lookup"><span data-stu-id="a0e31-142">For these projects, you'll need to start with a new ASP.NET Core web project and manually migrate files to this project.</span></span>

<span data-ttu-id="a0e31-143">Как правило, рекомендуется максимально точно ограничить объем бизнес-логики приложения на уровне пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="a0e31-143">In general, it's a good practice to minimize how much of an app's business logic lives in its user interface layer.</span></span> <span data-ttu-id="a0e31-144">Также лучше использовать небольшие контроллеры и представления.</span><span class="sxs-lookup"><span data-stu-id="a0e31-144">It's also best to keep controllers and views small.</span></span> <span data-ttu-id="a0e31-145">Приложения, которые соблюдают это руководство, проще переносить, чем те, которые имеют значительный объем логики в веб-проекте ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a0e31-145">Apps that have followed this guidance will be easier to port than those that have a significant amount of their logic in the ASP.NET web project.</span></span> <span data-ttu-id="a0e31-146">Если у вас есть приложение, которое вы планируете перенести, но еще не начали его, помните об этом при его обслуживании.</span><span class="sxs-lookup"><span data-stu-id="a0e31-146">If you have an app you're considering porting, but haven't begun the process yet, keep this in mind as you maintain it.</span></span> <span data-ttu-id="a0e31-147">Любые усилия, позволяющие свести к минимуму объем кода в проекте ASP.NET MVC или веб-API, скорее всего, приведут к меньшей работе, когда наступает время на перенос приложения.</span><span class="sxs-lookup"><span data-stu-id="a0e31-147">Any effort you put toward minimizing how much code is in the ASP.NET MVC or Web API project will likely result in less work when the time comes to port the app.</span></span>

<span data-ttu-id="a0e31-148">В следующей главе углубляется сведения о переходе с проектов ASP.NET MVC и веб-API на ASP.NET Core проектов.</span><span class="sxs-lookup"><span data-stu-id="a0e31-148">The next chapter digs into details of how to migrate from ASP.NET MVC and Web API projects to ASP.NET Core projects.</span></span> <span data-ttu-id="a0e31-149">В предыдущей главе назывались наиболее существенные различия между приложениями.</span><span class="sxs-lookup"><span data-stu-id="a0e31-149">The previous chapter called out the biggest differences between the apps.</span></span> <span data-ttu-id="a0e31-150">После того как базовая структура проекта уже размещается, миграция отдельных контроллеров и представлений обычно выполняется просто, особенно если они в основном нацелены на веб-обязанности.</span><span class="sxs-lookup"><span data-stu-id="a0e31-150">Once the basic project structure is in place, migrating individual controllers and views is usually straightforward, especially if they're mainly focused on web responsibilities.</span></span>

## <a name="references"></a><span data-ttu-id="a0e31-151">Ссылки</span><span class="sxs-lookup"><span data-stu-id="a0e31-151">References</span></span>

- [<span data-ttu-id="a0e31-152">Помощник по обновлению .NET</span><span class="sxs-lookup"><span data-stu-id="a0e31-152">.NET Upgrade Assistant tool</span></span>](https://aka.ms/dotnet-upgrade-assistant)
- [<span data-ttu-id="a0e31-153">средство try-Convert</span><span class="sxs-lookup"><span data-stu-id="a0e31-153">try-convert tool</span></span>](https://github.com/dotnet/try-convert)
- [<span data-ttu-id="a0e31-154">средство apiport</span><span class="sxs-lookup"><span data-stu-id="a0e31-154">apiport tool</span></span>](https://github.com/microsoft/dotnet-apiport)

>[!div class="step-by-step"]
><span data-ttu-id="a0e31-155">[Назад](identify-migration-sequence.md)
>[Вперед](strategies-migrating-in-production.md)</span><span class="sxs-lookup"><span data-stu-id="a0e31-155">[Previous](identify-migration-sequence.md)
[Next](strategies-migrating-in-production.md)</span></span>
