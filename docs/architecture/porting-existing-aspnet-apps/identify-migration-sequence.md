---
title: Определение последовательности переносимых проектов
description: Крупные приложения обычно не переносятся на новые платформы одновременно, но в ряде небольших этапов. Узнайте, как спланировать шаги для переноса приложения ASP.NET MVC в ASP.NET Core.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 452898da5839f8979a5e4f9ebf5d4c21b250e1fa
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401763"
---
# <a name="identify-sequence-of-projects-to-migrate"></a><span data-ttu-id="a5037-104">Определение последовательности переносимых проектов</span><span class="sxs-lookup"><span data-stu-id="a5037-104">Identify sequence of projects to migrate</span></span>

<span data-ttu-id="a5037-105">Для решений, использующих несколько интерфейсных приложений, лучше перенести приложения по одному.</span><span class="sxs-lookup"><span data-stu-id="a5037-105">For solutions that involve multiple front-end apps, it's best to migrate the apps one by one.</span></span> <span data-ttu-id="a5037-106">Например, создайте решение, которое включает только одно приложение внешнего интерфейса и его зависимости, чтобы можно было легко определить объем выполняемой работы.</span><span class="sxs-lookup"><span data-stu-id="a5037-106">For example, create a solution that only includes one front-end app and its dependencies so you can easily identify the scope of work involved.</span></span> <span data-ttu-id="a5037-107">Решения являются упрощенными, и при необходимости можно включать проекты в несколько решений.</span><span class="sxs-lookup"><span data-stu-id="a5037-107">Solutions are lightweight, and you can include projects in multiple solutions if needed.</span></span> <span data-ttu-id="a5037-108">Воспользуйтесь преимуществами решений в качестве организационного средства при миграции.</span><span class="sxs-lookup"><span data-stu-id="a5037-108">Take advantage of solutions as an organizational tool when migrating.</span></span>

<span data-ttu-id="a5037-109">Определив приложение ASP.NET для переноса и настроив его зависимые проекты (в идеале в решении), следующим этапом является определение зависимостей платформы и NuGet.</span><span class="sxs-lookup"><span data-stu-id="a5037-109">Once you've identified the ASP.NET app to migrate and have its dependent projects located with it (ideally in a solution), the next step is to identify framework and NuGet dependencies.</span></span> <span data-ttu-id="a5037-110">Определив все зависимости, простейший подход к миграции — это «снизу вверх» подход.</span><span class="sxs-lookup"><span data-stu-id="a5037-110">Having identified all dependencies, the simplest migration approach is a "bottom up" approach.</span></span> <span data-ttu-id="a5037-111">При таком подходе сначала переносится самый низкий уровень зависимостей.</span><span class="sxs-lookup"><span data-stu-id="a5037-111">With this approach, the lowest level of dependencies is migrated first.</span></span> <span data-ttu-id="a5037-112">Затем переносится следующий уровень зависимостей, вплоть до конца остается только клиентское приложение.</span><span class="sxs-lookup"><span data-stu-id="a5037-112">Then the next level of dependencies is migrated, until eventually the only thing left is the front-end app.</span></span> <span data-ttu-id="a5037-113">На рис. 3-1 показан пример набора проектов, составляющих приложение.</span><span class="sxs-lookup"><span data-stu-id="a5037-113">Figure 3-1 shows an example set of projects composing an app.</span></span> <span data-ttu-id="a5037-114">Низкоуровневые библиотеки классов находятся внизу, а проект ASP.NET MVC находится в верхней части.</span><span class="sxs-lookup"><span data-stu-id="a5037-114">The low-level class libraries are at the bottom, and the ASP.NET MVC project is at the top.</span></span>

![Зависимости проектов](./media/Figure3-1.png)

<span data-ttu-id="a5037-116">**Рис. 3-1**.</span><span class="sxs-lookup"><span data-stu-id="a5037-116">**Figure 3-1.**</span></span> <span data-ttu-id="a5037-117">Граф зависимостей проекта.</span><span class="sxs-lookup"><span data-stu-id="a5037-117">Project dependencies graph.</span></span>

<span data-ttu-id="a5037-118">Выберите конкретное клиентское приложение, проект ASP.NET MVC 5/Web API 2.</span><span class="sxs-lookup"><span data-stu-id="a5037-118">Choose a particular front-end app, an ASP.NET MVC 5 / Web API 2 project.</span></span> <span data-ttu-id="a5037-119">Определить его зависимости в решении и сопоставлять их зависимости, пока не появится полный список.</span><span class="sxs-lookup"><span data-stu-id="a5037-119">Identify its dependencies in the solution, and map out their dependencies until you have a complete list.</span></span> <span data-ttu-id="a5037-120">Схема, подобная показанной на рисунке 3-1, может быть полезной при сопоставлении зависимостей проекта.</span><span class="sxs-lookup"><span data-stu-id="a5037-120">A diagram like the one shown in Figure 3-1 may be useful when mapping out project dependencies.</span></span> <span data-ttu-id="a5037-121">Visual Studio может создать [схему зависимостей для вашего решения](/visualstudio/modeling/create-layer-diagrams-from-your-code)в зависимости от используемого выпуска.</span><span class="sxs-lookup"><span data-stu-id="a5037-121">Visual Studio can produce a [dependency diagram for your solution](/visualstudio/modeling/create-layer-diagrams-from-your-code), depending on which edition you're using.</span></span> <span data-ttu-id="a5037-122">[Анализатор переносимости .NET](../../standard/analyzers/portability-analyzer.md) также может создавать схемы зависимостей.</span><span class="sxs-lookup"><span data-stu-id="a5037-122">[The .NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) can also produce dependency diagrams.</span></span>

<span data-ttu-id="a5037-123">На рис. 3-2 показан установщик для [расширения Visual Studio анализатора переносимости .NET](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer):</span><span class="sxs-lookup"><span data-stu-id="a5037-123">Figure 3-2 shows the installer for the [.NET Portability Analyzer Visual Studio extension](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer):</span></span>

![Установка расширения анализатора переносимости .NET](./media/Figure3-2.png)

<span data-ttu-id="a5037-125">**Рис. 3-2.**</span><span class="sxs-lookup"><span data-stu-id="a5037-125">**Figure 3-2.**</span></span> <span data-ttu-id="a5037-126">Установщик анализатора переносимости .NET.</span><span class="sxs-lookup"><span data-stu-id="a5037-126">.NET Portability Analyzer installer.</span></span>

<span data-ttu-id="a5037-127">Расширение поддерживает Visual Studio 2017 и более поздние версии.</span><span class="sxs-lookup"><span data-stu-id="a5037-127">The extension supports Visual Studio 2017 and later.</span></span> <span data-ttu-id="a5037-128">После установки его необходимо настроить из меню **анализ**  >  **параметров анализатора переносимости** , как показано на рис. 3-3.</span><span class="sxs-lookup"><span data-stu-id="a5037-128">Once installed, you configure it from the **Analyze** > **Portability Analyzer Settings** menu, as shown in Figure 3-3.</span></span>

![Настройка расширения анализатора переносимости .NET](./media/Figure3-3.png)

<span data-ttu-id="a5037-130">**Рис. 3-3.**</span><span class="sxs-lookup"><span data-stu-id="a5037-130">**Figure 3-3.**</span></span> <span data-ttu-id="a5037-131">Настройка анализатора переносимости .NET.</span><span class="sxs-lookup"><span data-stu-id="a5037-131">Configure the .NET Portability Analyzer.</span></span>

<span data-ttu-id="a5037-132">Анализатор создает подробный отчет для каждой сборки.</span><span class="sxs-lookup"><span data-stu-id="a5037-132">The analyzer produces a detailed report for each assembly.</span></span> <span data-ttu-id="a5037-133">Отчет:</span><span class="sxs-lookup"><span data-stu-id="a5037-133">The report:</span></span>

* <span data-ttu-id="a5037-134">Описание совместимости каждого проекта с заданной целевой платформой, например .NET Core 3,1 или .NET Standard 2,0.</span><span class="sxs-lookup"><span data-stu-id="a5037-134">Describes how compatible each project is with a given target framework, such as .NET Core 3.1 or .NET Standard 2.0.</span></span>
* <span data-ttu-id="a5037-135">Помогает группам оценивать усилия, необходимые для переноса определенного проекта на определенную целевую платформу.</span><span class="sxs-lookup"><span data-stu-id="a5037-135">Helps teams assess the effort required to port a particular project to a particular target framework.</span></span>

<span data-ttu-id="a5037-136">Сведения об этом анализе рассматриваются в следующем разделе.</span><span class="sxs-lookup"><span data-stu-id="a5037-136">The details of this analysis are covered in the next section.</span></span>

<span data-ttu-id="a5037-137">После того как вы сопоставили проекты и их связи друг с другом, вы можете определить порядок, в котором будут перенесены проекты.</span><span class="sxs-lookup"><span data-stu-id="a5037-137">Once you've mapped out the projects and their relationships with one another, you're ready to determine the order in which you'll migrate the projects.</span></span> <span data-ttu-id="a5037-138">Начните с проектов, которые не имеют зависимостей.</span><span class="sxs-lookup"><span data-stu-id="a5037-138">Begin with projects that have no dependencies.</span></span> <span data-ttu-id="a5037-139">Затем проработайте дерево с проектами, которые зависят от этих проектов.</span><span class="sxs-lookup"><span data-stu-id="a5037-139">Then, work your way up the tree to the projects that depend on these projects.</span></span>

<span data-ttu-id="a5037-140">В примере, показанном на рис. 3-1, следует начать с проекта *contoso. utils* , так как он не зависит от других проектов.</span><span class="sxs-lookup"><span data-stu-id="a5037-140">In the example shown in Figure 3-1, you would start with the *Contoso.Utils* project, since it doesn't depend on any other projects.</span></span> <span data-ttu-id="a5037-141">После этого *contoso. Data* зависит только от "utils".</span><span class="sxs-lookup"><span data-stu-id="a5037-141">Next, *Contoso.Data* since it only depends on "Utils".</span></span> <span data-ttu-id="a5037-142">Затем перенесите библиотеку «сборки businesslogic» и, наконец, проект веб-интерфейса ASP.NET «Web».</span><span class="sxs-lookup"><span data-stu-id="a5037-142">Then migrate the "BusinessLogic" library, and finally the front-end ASP.NET "Web" project.</span></span> <span data-ttu-id="a5037-143">При этом подходе "снизу вверх" хорошо подходит для сравнительно мелких и хорошо организованных приложений, которые можно перенести как единое целое после переноса всех проектов.</span><span class="sxs-lookup"><span data-stu-id="a5037-143">Following this "bottom up" approach works well for relatively small and well-factored apps that can be migrated as a unit once all of their projects have migrated.</span></span> <span data-ttu-id="a5037-144">Более крупные приложения с большей степенью сложности или кодом, который занимает больше времени на миграцию, может потребовать больше добавочных стратегий.</span><span class="sxs-lookup"><span data-stu-id="a5037-144">Larger apps with more complexity, or more code that will take longer to migrate, may need to consider more incremental strategies.</span></span>

## <a name="unit-tests"></a><span data-ttu-id="a5037-145">Модульные тесты</span><span class="sxs-lookup"><span data-stu-id="a5037-145">Unit tests</span></span>

<span data-ttu-id="a5037-146">На предыдущих диаграммах отсутствуют проекты модульных тестов.</span><span class="sxs-lookup"><span data-stu-id="a5037-146">Missing from the previous diagrams are unit test projects.</span></span> <span data-ttu-id="a5037-147">Будем надеяться, что есть тесты, охватывающие по крайней мере некоторые из существующих поведений библиотек, для которых выполняется перенос.</span><span class="sxs-lookup"><span data-stu-id="a5037-147">Hopefully there are tests covering at least some of the existing behavior of the libraries being ported.</span></span>

<span data-ttu-id="a5037-148">При наличии модульных тестов рекомендуется сначала преобразовать эти проекты.</span><span class="sxs-lookup"><span data-stu-id="a5037-148">If you have unit tests, it's best to convert those projects first.</span></span> <span data-ttu-id="a5037-149">Необходимо продолжить тестирование изменений в проекте, над которым вы работаете.</span><span class="sxs-lookup"><span data-stu-id="a5037-149">You'll want to continue testing changes in the project you're working on.</span></span> <span data-ttu-id="a5037-150">Помните, что перенос в .NET Core является значительным изменением в базе кода.</span><span class="sxs-lookup"><span data-stu-id="a5037-150">Remember that porting to .NET Core is a significant change to your codebase.</span></span>

<span data-ttu-id="a5037-151">.NET Core поддерживает все основные платформы: MSTest, xUnit и NUnit.</span><span class="sxs-lookup"><span data-stu-id="a5037-151">MSTest, xUnit, and NUnit all work on .NET Core.</span></span> <span data-ttu-id="a5037-152">Если в настоящее время тесты для приложения отсутствуют, рассмотрите возможность создания некоторых тестовых проверок, которые проверяют текущее поведение системы.</span><span class="sxs-lookup"><span data-stu-id="a5037-152">If you don't currently have tests for your app, consider building some characterization tests that verify the system's current behavior.</span></span> <span data-ttu-id="a5037-153">Преимущество заключается в том, что после завершения миграции можно подтвердить, что поведение приложения остается неизменным.</span><span class="sxs-lookup"><span data-stu-id="a5037-153">The benefit is that once the migration is complete, you can confirm the app's behavior remains unchanged.</span></span>

## <a name="considerations-for-migrating-many-apps"></a><span data-ttu-id="a5037-154">Рекомендации по миграции многих приложений</span><span class="sxs-lookup"><span data-stu-id="a5037-154">Considerations for migrating many apps</span></span>

<span data-ttu-id="a5037-155">В некоторых организациях будет несколько различных приложений для миграции, и перенос каждого из них может потребовать тенабле слишком большого количества ресурсов.</span><span class="sxs-lookup"><span data-stu-id="a5037-155">Some organizations will have many different apps to migrate, and migrating each one by hand may require too many resources to be tenable.</span></span> <span data-ttu-id="a5037-156">В таких ситуациях рекомендуется использовать некоторый уровень автоматизации.</span><span class="sxs-lookup"><span data-stu-id="a5037-156">In these situations, some degree of automation is recommended.</span></span> <span data-ttu-id="a5037-157">Шаги, описанные в этой главе, можно автоматизировать.</span><span class="sxs-lookup"><span data-stu-id="a5037-157">The steps followed in this chapter can be automated.</span></span> <span data-ttu-id="a5037-158">Структурные изменения, такие как различия в файлах проекта и обновления для общих пакетов, могут применяться скриптами.</span><span class="sxs-lookup"><span data-stu-id="a5037-158">Structural changes, like project file differences and updates to common packages, can be applied by scripts.</span></span> <span data-ttu-id="a5037-159">Эти скрипты можно уточнять, так как они выполняются итеративно для нескольких проектов.</span><span class="sxs-lookup"><span data-stu-id="a5037-159">These scripts can be refined as they're run iteratively on more projects.</span></span> <span data-ttu-id="a5037-160">При каждом запуске изучите, какие действия необходимо выполнить вручную для каждого проекта.</span><span class="sxs-lookup"><span data-stu-id="a5037-160">On each run, examine whatever manual steps are required for each project.</span></span> <span data-ttu-id="a5037-161">Автоматизируйте эти ручные действия, если это возможно.</span><span class="sxs-lookup"><span data-stu-id="a5037-161">Automate those manual steps, if possible.</span></span> <span data-ttu-id="a5037-162">При таком подходе Организация должна увеличиваться быстрее и лучше при переносе приложений с течением времени, в то время как улучшенная поддержка автоматизации выполняется каждый шаг.</span><span class="sxs-lookup"><span data-stu-id="a5037-162">Using this approach, the organization should grow faster and better at porting their apps over time, with improved automation support each step of the way.</span></span>

<span data-ttu-id="a5037-163">Просмотрите общие сведения о том, как использовать этот подход в [дотнетконф презентации Лиззи Галлагхер MasterCard](https://www.youtube.com/watch?v=C-2haqb60No).</span><span class="sxs-lookup"><span data-stu-id="a5037-163">Watch an overview of how to employ this approach in this [dotNetConf presentation by Lizzy Gallagher of Mastercard](https://www.youtube.com/watch?v=C-2haqb60No).</span></span> <span data-ttu-id="a5037-164">В этой презентации участвуют пять этапов.</span><span class="sxs-lookup"><span data-stu-id="a5037-164">The five phases employed in this presentation included:</span></span>

- <span data-ttu-id="a5037-165">Перенос сторонних зависимостей NuGet</span><span class="sxs-lookup"><span data-stu-id="a5037-165">Migrate third-party NuGet dependencies</span></span>
- <span data-ttu-id="a5037-166">Перенос приложений для использования нового формата файла *. csproj*</span><span class="sxs-lookup"><span data-stu-id="a5037-166">Migrate apps to use new *.csproj* file format</span></span>
- <span data-ttu-id="a5037-167">Перенос приложений в ASP.NET Core (нацеливание платформа .NET Framework)</span><span class="sxs-lookup"><span data-stu-id="a5037-167">Migrate apps to ASP.NET Core (targeting .NET Framework)</span></span>
- <span data-ttu-id="a5037-168">Обновление внутренних зависимостей NuGet для .NET Standard</span><span class="sxs-lookup"><span data-stu-id="a5037-168">Update internal NuGet dependencies to .NET Standard</span></span>
- <span data-ttu-id="a5037-169">Обновите все приложения, чтобы они нацелились на .NET Core 3,1</span><span class="sxs-lookup"><span data-stu-id="a5037-169">Update all apps to target .NET Core 3.1</span></span>

<span data-ttu-id="a5037-170">При автоматизации большого набора приложений это значительно упрощается при соблюдении нормативных руководств по написанию кода и организации проекта.</span><span class="sxs-lookup"><span data-stu-id="a5037-170">When automating a large suite of apps, it helps significantly if they follow consistent coding guidelines and project organization.</span></span> <span data-ttu-id="a5037-171">Эффективность автоматизации зависит от этой согласованности.</span><span class="sxs-lookup"><span data-stu-id="a5037-171">Automation efforts rely on this consistency to be effective.</span></span> <span data-ttu-id="a5037-172">Помимо анализа и переноса файлов проекта, распространенные шаблоны кода могут быть перенесены автоматически.</span><span class="sxs-lookup"><span data-stu-id="a5037-172">In addition to parsing and migrating project files, common code patterns can be migrated automatically.</span></span> <span data-ttu-id="a5037-173">Некоторые примеры шаблонов кода включают различия в объявлении действий контроллера или о том, как они возвращают результаты.</span><span class="sxs-lookup"><span data-stu-id="a5037-173">Some code pattern examples include differences in how controller actions are declared or how they return results.</span></span>

<span data-ttu-id="a5037-174">Например, скрипт миграции может искать файлы, соответствующие *Controller.CS* , для строк кода, соответствующих одному из следующих шаблонов:</span><span class="sxs-lookup"><span data-stu-id="a5037-174">For example, a migration script could search files matching *Controller.cs* for lines of code matching one of these patterns:</span></span>

```csharp
   return new HttpStatusCodeResult(200);
   // or
   return new HttpStatusCodeResult(HttpStatusCode.OK);
```

<span data-ttu-id="a5037-175">В ASP.NET Core любая из приведенных выше строк кода может быть заменена на:</span><span class="sxs-lookup"><span data-stu-id="a5037-175">In ASP.NET Core, either of the preceding lines of code can be replaced with:</span></span>

```csharp
    return Ok();
```

## <a name="summary"></a><span data-ttu-id="a5037-176">Итоги</span><span class="sxs-lookup"><span data-stu-id="a5037-176">Summary</span></span>

<span data-ttu-id="a5037-177">Лучшим подходом к переносу большого платформа .NET Framework приложения в .NET Core является:</span><span class="sxs-lookup"><span data-stu-id="a5037-177">The best approach to porting a large .NET Framework app to .NET Core is to:</span></span>

1. <span data-ttu-id="a5037-178">Выявление зависимостей проекта.</span><span class="sxs-lookup"><span data-stu-id="a5037-178">Identify project dependencies.</span></span>
1. <span data-ttu-id="a5037-179">Анализируйте, что требуется для переноса каждого проекта.</span><span class="sxs-lookup"><span data-stu-id="a5037-179">Analyze what's required to port each project.</span></span>
1. <span data-ttu-id="a5037-180">Начните с нижнего края.</span><span class="sxs-lookup"><span data-stu-id="a5037-180">Start from the bottom up.</span></span>

<span data-ttu-id="a5037-181">Анализатор переносимости .NET можно использовать для определения того, как совместимые существующие библиотеки могут быть назначены целевым платформам.</span><span class="sxs-lookup"><span data-stu-id="a5037-181">You can use the .NET Portability Analyzer to determine how compatible existing libraries may be with target platforms.</span></span> <span data-ttu-id="a5037-182">Автоматические тесты помогут гарантировать, что при переносе приложения не будут введены критические изменения.</span><span class="sxs-lookup"><span data-stu-id="a5037-182">Automated tests will help ensure no breaking changes are introduced as the app is ported.</span></span> <span data-ttu-id="a5037-183">Эти тестовые проекты должны быть между первыми перенесенными проектами.</span><span class="sxs-lookup"><span data-stu-id="a5037-183">These test projects should be among the first projects ported.</span></span>

## <a name="references"></a><span data-ttu-id="a5037-184">Ссылки</span><span class="sxs-lookup"><span data-stu-id="a5037-184">References</span></span>

- [<span data-ttu-id="a5037-185">Перенос кода в .NET Core из .NET Framework</span><span class="sxs-lookup"><span data-stu-id="a5037-185">Porting from .NET Framework to .NET Core</span></span>](../../core/porting/index.md)
- [<span data-ttu-id="a5037-186">Анализатор переносимости .NET</span><span class="sxs-lookup"><span data-stu-id="a5037-186">The .NET Portability Analyzer</span></span>](../../standard/analyzers/portability-analyzer.md)
- [<span data-ttu-id="a5037-187">Канал 9. Краткий обзор анализатора переносимости .NET (видео)</span><span class="sxs-lookup"><span data-stu-id="a5037-187">Channel 9: A Brief Look at the .NET Portability Analyzer (Video)</span></span>](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer)
- [<span data-ttu-id="a5037-188">2 года, 200 приложений: миграция .NET Core в масштабе (видео)</span><span class="sxs-lookup"><span data-stu-id="a5037-188">2 Years, 200 Apps: A .NET Core Migration at Scale (Video)</span></span>](https://www.youtube.com/watch?v=C-2haqb60No)

>[!div class="step-by-step"]
><span data-ttu-id="a5037-189">[Назад](migrate-large-solutions.md)
>[Вперед](understand-update-dependencies.md)</span><span class="sxs-lookup"><span data-stu-id="a5037-189">[Previous](migrate-large-solutions.md)
[Next](understand-update-dependencies.md)</span></span>
