---
title: Стратегии постепенной миграции
description: Какие стратегии могут принять команды, позволяющие перенести большие приложения из ASP.NET MVC в .NET Core в пошаговом режиме?
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 615d2a853b698bfc752c3baf36f31ab2a4f2bab8
ms.sourcegitcommit: b5d2290673e1c91260c9205202dd8b95fbab1a0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2021
ms.locfileid: "106122889"
---
# <a name="strategies-for-migrating-incrementally"></a><span data-ttu-id="eec7d-103">Стратегии постепенной миграции</span><span class="sxs-lookup"><span data-stu-id="eec7d-103">Strategies for migrating incrementally</span></span>

<span data-ttu-id="eec7d-104">Крупнейшим сложностью при переносе любого крупного приложения является определение того, как разбить процесс на более мелкие задачи.</span><span class="sxs-lookup"><span data-stu-id="eec7d-104">The biggest challenge with migrating any large app is determining how to break the process into smaller tasks.</span></span> <span data-ttu-id="eec7d-105">Для этой цели можно применить несколько стратегий, включая перенос приложения на горизонтальные уровни, такие как пользовательский интерфейс, доступ к данным, бизнес-логику, или разбиение приложения на отдельные небольшие приложения.</span><span class="sxs-lookup"><span data-stu-id="eec7d-105">There are several strategies that can be applied for this purpose, including breaking the app into horizontal layers such as UI, data access, business logic, or breaking up the app into separate, smaller apps.</span></span> <span data-ttu-id="eec7d-106">Другая стратегия состоит в том, чтобы обновить некоторые или все приложения до различных версий платформы, чтобы перейти к недавнему выпуску .NET Core.</span><span class="sxs-lookup"><span data-stu-id="eec7d-106">Another strategy is to upgrade some or all of the app to different framework versions on the way to a recent .NET Core release.</span></span> <span data-ttu-id="eec7d-107">Одним из подходов является перенос [вертикальных срезов](https://deviq.com/practices/vertical-slices) приложения, а не попытка миграции по горизонтали на один слой.</span><span class="sxs-lookup"><span data-stu-id="eec7d-107">One approach you could use is to migrate [vertical slices](https://deviq.com/practices/vertical-slices) of the app, rather than attempting to migrate one horizontal layer at a time.</span></span> <span data-ttu-id="eec7d-108">Давайте рассмотрим каждый из этих различных подходов.</span><span class="sxs-lookup"><span data-stu-id="eec7d-108">Let's consider each of these different approaches.</span></span>

## <a name="migrating-slice-by-slice"></a><span data-ttu-id="eec7d-109">Перенос среза по срезу</span><span class="sxs-lookup"><span data-stu-id="eec7d-109">Migrating slice by slice</span></span>

<span data-ttu-id="eec7d-110">Одним из успешных подходов к миграции является определение вертикальных срезов функциональности и их перенос на целевую платформу по одному.</span><span class="sxs-lookup"><span data-stu-id="eec7d-110">One successful approach to migrating is to identify vertical slices of functionality and migrate them to the target platform one by one.</span></span> <span data-ttu-id="eec7d-111">Первым шагом является создание нового приложения ASP.NET Core 3,1 или 5.</span><span class="sxs-lookup"><span data-stu-id="eec7d-111">The first step is to create a new ASP.NET Core 3.1 or 5 app.</span></span> <span data-ttu-id="eec7d-112">Затем найдите отдельную страницу или конечную точку API, которая будет перенесена первыми.</span><span class="sxs-lookup"><span data-stu-id="eec7d-112">Next, identify the individual page or API endpoint that will be migrated first.</span></span> <span data-ttu-id="eec7d-113">Создайте только необходимые функции для поддержки этого маршрута в ASP.NET Core приложении.</span><span class="sxs-lookup"><span data-stu-id="eec7d-113">Build out just the necessary functionality to support this one route in the ASP.NET Core app.</span></span> <span data-ttu-id="eec7d-114">Затем используйте переписывание HTTP и (или) обратный прокси-сервер, чтобы начать отправку запросов к этим страницам или конечным точкам в новое приложение, а не в приложение ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="eec7d-114">Then use HTTP rewriting and/or a reverse proxy to start sending requests for these pages or endpoints to the new app rather than the ASP.NET app.</span></span> <span data-ttu-id="eec7d-115">Этот подход хорошо подходит для проектов API, но также может работать и для многих приложений MVC.</span><span class="sxs-lookup"><span data-stu-id="eec7d-115">This approach is well-suited to API projects, but can also work for many MVC apps.</span></span>

<span data-ttu-id="eec7d-116">При переносе среза по срезу весь стек отдельной конечной точки API или запрошенного маршрута воссоздается в новом проекте или решении.</span><span class="sxs-lookup"><span data-stu-id="eec7d-116">When migrating slice by slice, the entire stack of the individual API endpoint or requested route is recreated in the new project or solution.</span></span> <span data-ttu-id="eec7d-117">Первый такой срез обычно требует наибольшего усилий, поскольку обычно требуется создать несколько проектов и принимать решения о доступе к данным и организации решения.</span><span class="sxs-lookup"><span data-stu-id="eec7d-117">The very first such slice typically requires the most effort, since it will typically need several projects to be created and decisions to be made about data access and solution organization.</span></span> <span data-ttu-id="eec7d-118">После того как функциональность первого среза отражает существующее приложение, ее можно развернуть, и существующее приложение сможет выполнить его перенаправление или просто удалить.</span><span class="sxs-lookup"><span data-stu-id="eec7d-118">Once the first slice's functionality mirrors the existing app's, it can be deployed and the existing app can redirect to it or simply be removed.</span></span> <span data-ttu-id="eec7d-119">Этот подход повторяется до тех пор, пока все приложение не будет перенесено в новую структуру.</span><span class="sxs-lookup"><span data-stu-id="eec7d-119">This approach is then repeated until the entire app has been ported to the new structure.</span></span>

<span data-ttu-id="eec7d-120">Некоторые конкретные рекомендации по обеспечению этой стратегии с помощью IIS см. в [главе 5, сценарии развертывания](deployment-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="eec7d-120">Some specific guidance on how to follow this strategy using IIS is covered in [Chapter 5, Deployment Scenarios](deployment-scenarios.md).</span></span>

## <a name="migrating-layer-by-layer"></a><span data-ttu-id="eec7d-121">Перенос слоя по слою</span><span class="sxs-lookup"><span data-stu-id="eec7d-121">Migrating layer by layer</span></span>

<span data-ttu-id="eec7d-122">Рассмотрим задачу переноса большого приложения ASP.NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="eec7d-122">Consider the challenge of migrating a large ASP.NET 4.5 app.</span></span> <span data-ttu-id="eec7d-123">Один из подходов заключается в переносе всего приложения непосредственно из платформа .NET Framework 4,5 в .NET Core 3,1.</span><span class="sxs-lookup"><span data-stu-id="eec7d-123">One approach is to migrate the entire app directly from .NET Framework 4.5 to .NET Core 3.1.</span></span> <span data-ttu-id="eec7d-124">Однако этот подход должен учитывать все критические изменения между двумя платформами и версиями, которые являются значительными.</span><span class="sxs-lookup"><span data-stu-id="eec7d-124">However, this approach needs to account for every breaking change between the two frameworks and versions, which are substantial.</span></span> <span data-ttu-id="eec7d-125">Выполнение этой операции над одним проектом за раз предоставляет набор пошаговых фишек, чтобы все решение не перемещалось одновременно.</span><span class="sxs-lookup"><span data-stu-id="eec7d-125">Performing this work on one project at a time provides a set of stepping stones so that the entire solution doesn't need to be moved at once.</span></span>

<span data-ttu-id="eec7d-126">Одной из недавних дополнений к экосистеме .NET, которая помогает в взаимодействии различных платформ .NET, является [.NET Standard](https://dotnet.microsoft.com/platform/dotnet-standard).</span><span class="sxs-lookup"><span data-stu-id="eec7d-126">One recent addition to the .NET ecosystem that helps with interoperability between different .NET frameworks is [.NET Standard](https://dotnet.microsoft.com/platform/dotnet-standard).</span></span> <span data-ttu-id="eec7d-127">.NET Standard позволяет библиотекам выполнять сборку по согласованному набору общих API-интерфейсов, что гарантирует их использование в любом приложении .NET.</span><span class="sxs-lookup"><span data-stu-id="eec7d-127">.NET Standard allows libraries to build against the agreed upon set of common APIs, ensuring they can be used in any .NET app.</span></span> <span data-ttu-id="eec7d-128">.NET Standard 2,0 важна, так как она охватывает большинство функций библиотеки базовых классов, используемых большинством платформа .NET Framework и приложениями .NET Core.</span><span class="sxs-lookup"><span data-stu-id="eec7d-128">.NET Standard 2.0 is notable because it covers most base class library functionality used by most .NET Framework and .NET Core apps.</span></span> <span data-ttu-id="eec7d-129">К сожалению, самая ранняя версия .NET с поддержкой .NET Standard 2,0 — платформа .NET Framework 4.6.1, а в платформа .NET Framework 4,8 существует ряд обновлений, которые делают его привлекательным выбором для первоначального обновления.</span><span class="sxs-lookup"><span data-stu-id="eec7d-129">Unfortunately, the earliest version of .NET with support for .NET Standard 2.0 is .NET Framework 4.6.1, and there are a number of updates in .NET Framework 4.8 that make it a compelling choice for initial upgrades.</span></span>

<span data-ttu-id="eec7d-130">Один из подходов к постепенному обновлению платформа .NET Framework 4,5 системы уровня по уровням заключается в том, чтобы сначала обновить свои зависимости библиотеки классов до платформа .NET Framework 4,8.</span><span class="sxs-lookup"><span data-stu-id="eec7d-130">One approach to incrementally upgrade a .NET Framework 4.5 system layer-by-layer is to first update its class library dependencies to .NET Framework 4.8.</span></span> <span data-ttu-id="eec7d-131">Затем измените эти библиотеки, чтобы они были .NET Standard библиотеками классов.</span><span class="sxs-lookup"><span data-stu-id="eec7d-131">Then, modify these libraries to be .NET Standard class libraries.</span></span> <span data-ttu-id="eec7d-132">При необходимости используйте множественную нацеливание и условную компиляцию.</span><span class="sxs-lookup"><span data-stu-id="eec7d-132">Use multi-targeting and conditional compilation, if necessary.</span></span> <span data-ttu-id="eec7d-133">Этот шаг может быть полезен в сценариях, где зависимости приложений требуются платформа .NET Framework и не могут быть легко перенесены напрямую для использования .NET Standard и .NET Core.</span><span class="sxs-lookup"><span data-stu-id="eec7d-133">This step can be helpful in scenarios where app dependencies require .NET Framework and cannot easily be ported directly to use .NET Standard and .NET Core.</span></span> <span data-ttu-id="eec7d-134">Так как платформа .NET Framework библиотеки могут использоваться приложениями ASP.NET Core 2,1, следующим шагом является перенос некоторых или всех веб-функций приложения в ASP.NET Core 2,1 (как описано в [предыдущей главе](choose-net-core-version.md)).</span><span class="sxs-lookup"><span data-stu-id="eec7d-134">Since .NET Framework libraries can be consumed by ASP.NET Core 2.1 apps, the next step is to migrate some or all of the web functionality of the app to ASP.NET Core 2.1 (as described in the [previous chapter](choose-net-core-version.md)).</span></span> <span data-ttu-id="eec7d-135">Это подход "снизу вверх", начиная с зависимостей библиотеки классов низкого уровня и работающих с точкой входа веб-приложения.</span><span class="sxs-lookup"><span data-stu-id="eec7d-135">This is a "bottom up" approach, starting with low level class library dependencies and working up to the web app entry point.</span></span>

<span data-ttu-id="eec7d-136">После запуска приложения на ASP.NET Core 2,1 его миграция на ASP.NET Core 3,1 в изоляции сравнительно проста.</span><span class="sxs-lookup"><span data-stu-id="eec7d-136">Once the app is running on ASP.NET Core 2.1, migrating it to ASP.NET Core 3.1 in isolation is relatively straightforward.</span></span> <span data-ttu-id="eec7d-137">Наиболее вероятной проблемой на этом этапе является обновление несовместимых зависимостей для поддержки .NET Core и, возможно, более поздних версий .NET Standard.</span><span class="sxs-lookup"><span data-stu-id="eec7d-137">The most likely challenge during this step is updating incompatible dependencies to support .NET Core and possibly higher versions of .NET Standard.</span></span> <span data-ttu-id="eec7d-138">Для приложений, не имеющих проблемных зависимостей с библиотеками только для платформа .NET Framework, существует небольшая причина обновления до ASP.NET Core 2,1.</span><span class="sxs-lookup"><span data-stu-id="eec7d-138">For apps that don't have problematic dependencies on .NET Framework-only libraries, there's little reason to upgrade to ASP.NET Core 2.1.</span></span> <span data-ttu-id="eec7d-139">Перенос непосредственно в ASP.NET Core 3,1 имеет более осмысленный смысл и требует меньше усилий.</span><span class="sxs-lookup"><span data-stu-id="eec7d-139">Porting directly to ASP.NET Core 3.1 makes more sense and requires less effort.</span></span>

<span data-ttu-id="eec7d-140">К моменту запуска приложения в .NET Core 3,1 переход на текущую версию .NET 5 относительно безболезнен.</span><span class="sxs-lookup"><span data-stu-id="eec7d-140">By the time the app is running on .NET Core 3.1, migrating to the current .NET 5 release is relatively painless.</span></span> <span data-ttu-id="eec7d-141">Процесс в основном включает обновление целевой платформы файлов проекта и связанных с ними зависимостей пакетов NuGet.</span><span class="sxs-lookup"><span data-stu-id="eec7d-141">The process primarily involves updating the target framework of your project files and their associated NuGet package dependencies.</span></span> <span data-ttu-id="eec7d-142">Хотя существует несколько [критических изменений](../../core/compatibility/5.0.md), которые следует учитывать, большинство приложений не требует значительных изменений для перехода с .net Core 3,1 на .NET 5.</span><span class="sxs-lookup"><span data-stu-id="eec7d-142">While there are several [breaking changes to consider](../../core/compatibility/5.0.md), most apps don't require significant modifications to move from .NET Core 3.1 to .NET 5.</span></span> <span data-ttu-id="eec7d-143">Основной фактор [выбора между .NET Core 3,1 и .NET 5, скорее всего, будет поддерживаться](choose-net-core-version.md).</span><span class="sxs-lookup"><span data-stu-id="eec7d-143">The primary deciding factor in [choosing between .NET Core 3.1 and .NET 5 is likely to be support](choose-net-core-version.md).</span></span>

<span data-ttu-id="eec7d-144">Вместо подхода "снизу вверх" можно начать с веб-приложения (или даже всего решения) и использовать автоматизированное средство для помощи при обновлении.</span><span class="sxs-lookup"><span data-stu-id="eec7d-144">Instead of a "bottom up" approach, another alternative is to start with the web app (or even the entire solution) and use an automated tool to assist with the upgrade.</span></span> <span data-ttu-id="eec7d-145">[Средство "помощник по обновлению .NET](https://aka.ms/dotnet-upgrade-assistant) " можно использовать для обновления платформа .NET Framework приложений до .NET Core или .NET 5.</span><span class="sxs-lookup"><span data-stu-id="eec7d-145">The [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) can be used to help upgrade .NET Framework apps to .NET Core / .NET 5.</span></span> <span data-ttu-id="eec7d-146">Она автоматизирует многие из распространенных задач, связанных с обновлением приложений, таких как изменение формата файлов проекта, настройка соответствующих целевых платформ, Обновление зависимостей NuGet и многое другое.</span><span class="sxs-lookup"><span data-stu-id="eec7d-146">It automates many of the common tasks related to upgrading apps, such as modifying project file format, setting appropriate target frameworks, updating NuGet dependencies, and more.</span></span>

<span data-ttu-id="eec7d-147">Вместо подхода "снизу вверх" можно начать с веб-приложения (или даже всего решения) и использовать автоматизированное средство для помощи при обновлении.</span><span class="sxs-lookup"><span data-stu-id="eec7d-147">Instead of a "bottom up" approach, another alternative is to start with the web app (or even the entire solution) and use an automated tool to assist with the upgrade.</span></span> <span data-ttu-id="eec7d-148">[Средство "помощник по обновлению .NET](https://aka.ms/dotnet-upgrade-assistant) " можно использовать для обновления платформа .NET Framework приложений до .NET Core или .NET 5.</span><span class="sxs-lookup"><span data-stu-id="eec7d-148">The [.NET Upgrade Assistant tool](https://aka.ms/dotnet-upgrade-assistant) can be used to help upgrade .NET Framework apps to .NET Core / .NET 5.</span></span> <span data-ttu-id="eec7d-149">Она автоматизирует многие из распространенных задач, связанных с обновлением приложений, таких как изменение формата файлов проекта, настройка соответствующих целевых платформ, Обновление зависимостей NuGet и многое другое.</span><span class="sxs-lookup"><span data-stu-id="eec7d-149">It automates many of the common tasks related to upgrading apps, such as modifying project file format, setting appropriate target frameworks, updating NuGet dependencies, and more.</span></span>

## <a name="references"></a><span data-ttu-id="eec7d-150">Ссылки</span><span class="sxs-lookup"><span data-stu-id="eec7d-150">References</span></span>

- [<span data-ttu-id="eec7d-151">Что такое .NET Standard?</span><span class="sxs-lookup"><span data-stu-id="eec7d-151">What is .NET Standard?</span></span>](https://dotnet.microsoft.com/platform/dotnet-standard)
- [<span data-ttu-id="eec7d-152">Знакомство с .NET 5</span><span class="sxs-lookup"><span data-stu-id="eec7d-152">Introducing .NET 5</span></span>](https://devblogs.microsoft.com/dotnet/introducing-net-5/)
- [<span data-ttu-id="eec7d-153">Миграция с ASP.NET Core 3,1 на 5,0</span><span class="sxs-lookup"><span data-stu-id="eec7d-153">Migrate from ASP.NET Core 3.1 to 5.0</span></span>](/aspnet/core/migration/31-to-50)
- [<span data-ttu-id="eec7d-154">Помощник по обновлению .NET</span><span class="sxs-lookup"><span data-stu-id="eec7d-154">.NET Upgrade Assistant tool</span></span>](https://aka.ms/dotnet-upgrade-assistant)

>[!div class="step-by-step"]
><span data-ttu-id="eec7d-155">[Назад](choose-net-core-version.md)
>[Вперед](migrate-web-forms.md)</span><span class="sxs-lookup"><span data-stu-id="eec7d-155">[Previous](choose-net-core-version.md)
[Next](migrate-web-forms.md)</span></span>
