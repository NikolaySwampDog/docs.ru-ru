---
title: Стратегии постепенной миграции
description: Какие стратегии могут принять команды, позволяющие перенести большие приложения из ASP.NET MVC в .NET Core в пошаговом режиме?
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 615d2a853b698bfc752c3baf36f31ab2a4f2bab8
ms.sourcegitcommit: b5d2290673e1c91260c9205202dd8b95fbab1a0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2021
ms.locfileid: "106122889"
---
# <a name="strategies-for-migrating-incrementally"></a>Стратегии постепенной миграции

Крупнейшим сложностью при переносе любого крупного приложения является определение того, как разбить процесс на более мелкие задачи. Для этой цели можно применить несколько стратегий, включая перенос приложения на горизонтальные уровни, такие как пользовательский интерфейс, доступ к данным, бизнес-логику, или разбиение приложения на отдельные небольшие приложения. Другая стратегия состоит в том, чтобы обновить некоторые или все приложения до различных версий платформы, чтобы перейти к недавнему выпуску .NET Core. Одним из подходов является перенос [вертикальных срезов](https://deviq.com/practices/vertical-slices) приложения, а не попытка миграции по горизонтали на один слой. Давайте рассмотрим каждый из этих различных подходов.

## <a name="migrating-slice-by-slice"></a>Перенос среза по срезу

Одним из успешных подходов к миграции является определение вертикальных срезов функциональности и их перенос на целевую платформу по одному. Первым шагом является создание нового приложения ASP.NET Core 3,1 или 5. Затем найдите отдельную страницу или конечную точку API, которая будет перенесена первыми. Создайте только необходимые функции для поддержки этого маршрута в ASP.NET Core приложении. Затем используйте переписывание HTTP и (или) обратный прокси-сервер, чтобы начать отправку запросов к этим страницам или конечным точкам в новое приложение, а не в приложение ASP.NET. Этот подход хорошо подходит для проектов API, но также может работать и для многих приложений MVC.

При переносе среза по срезу весь стек отдельной конечной точки API или запрошенного маршрута воссоздается в новом проекте или решении. Первый такой срез обычно требует наибольшего усилий, поскольку обычно требуется создать несколько проектов и принимать решения о доступе к данным и организации решения. После того как функциональность первого среза отражает существующее приложение, ее можно развернуть, и существующее приложение сможет выполнить его перенаправление или просто удалить. Этот подход повторяется до тех пор, пока все приложение не будет перенесено в новую структуру.

Некоторые конкретные рекомендации по обеспечению этой стратегии с помощью IIS см. в [главе 5, сценарии развертывания](deployment-scenarios.md).

## <a name="migrating-layer-by-layer"></a>Перенос слоя по слою

Рассмотрим задачу переноса большого приложения ASP.NET 4,5. Один из подходов заключается в переносе всего приложения непосредственно из платформа .NET Framework 4,5 в .NET Core 3,1. Однако этот подход должен учитывать все критические изменения между двумя платформами и версиями, которые являются значительными. Выполнение этой операции над одним проектом за раз предоставляет набор пошаговых фишек, чтобы все решение не перемещалось одновременно.

Одной из недавних дополнений к экосистеме .NET, которая помогает в взаимодействии различных платформ .NET, является [.NET Standard](https://dotnet.microsoft.com/platform/dotnet-standard). .NET Standard позволяет библиотекам выполнять сборку по согласованному набору общих API-интерфейсов, что гарантирует их использование в любом приложении .NET. .NET Standard 2,0 важна, так как она охватывает большинство функций библиотеки базовых классов, используемых большинством платформа .NET Framework и приложениями .NET Core. К сожалению, самая ранняя версия .NET с поддержкой .NET Standard 2,0 — платформа .NET Framework 4.6.1, а в платформа .NET Framework 4,8 существует ряд обновлений, которые делают его привлекательным выбором для первоначального обновления.

Один из подходов к постепенному обновлению платформа .NET Framework 4,5 системы уровня по уровням заключается в том, чтобы сначала обновить свои зависимости библиотеки классов до платформа .NET Framework 4,8. Затем измените эти библиотеки, чтобы они были .NET Standard библиотеками классов. При необходимости используйте множественную нацеливание и условную компиляцию. Этот шаг может быть полезен в сценариях, где зависимости приложений требуются платформа .NET Framework и не могут быть легко перенесены напрямую для использования .NET Standard и .NET Core. Так как платформа .NET Framework библиотеки могут использоваться приложениями ASP.NET Core 2,1, следующим шагом является перенос некоторых или всех веб-функций приложения в ASP.NET Core 2,1 (как описано в [предыдущей главе](choose-net-core-version.md)). Это подход "снизу вверх", начиная с зависимостей библиотеки классов низкого уровня и работающих с точкой входа веб-приложения.

После запуска приложения на ASP.NET Core 2,1 его миграция на ASP.NET Core 3,1 в изоляции сравнительно проста. Наиболее вероятной проблемой на этом этапе является обновление несовместимых зависимостей для поддержки .NET Core и, возможно, более поздних версий .NET Standard. Для приложений, не имеющих проблемных зависимостей с библиотеками только для платформа .NET Framework, существует небольшая причина обновления до ASP.NET Core 2,1. Перенос непосредственно в ASP.NET Core 3,1 имеет более осмысленный смысл и требует меньше усилий.

К моменту запуска приложения в .NET Core 3,1 переход на текущую версию .NET 5 относительно безболезнен. Процесс в основном включает обновление целевой платформы файлов проекта и связанных с ними зависимостей пакетов NuGet. Хотя существует несколько [критических изменений](../../core/compatibility/5.0.md), которые следует учитывать, большинство приложений не требует значительных изменений для перехода с .net Core 3,1 на .NET 5. Основной фактор [выбора между .NET Core 3,1 и .NET 5, скорее всего, будет поддерживаться](choose-net-core-version.md).

Вместо подхода "снизу вверх" можно начать с веб-приложения (или даже всего решения) и использовать автоматизированное средство для помощи при обновлении. [Средство "помощник по обновлению .NET](https://aka.ms/dotnet-upgrade-assistant) " можно использовать для обновления платформа .NET Framework приложений до .NET Core или .NET 5. Она автоматизирует многие из распространенных задач, связанных с обновлением приложений, таких как изменение формата файлов проекта, настройка соответствующих целевых платформ, Обновление зависимостей NuGet и многое другое.

Вместо подхода "снизу вверх" можно начать с веб-приложения (или даже всего решения) и использовать автоматизированное средство для помощи при обновлении. [Средство "помощник по обновлению .NET](https://aka.ms/dotnet-upgrade-assistant) " можно использовать для обновления платформа .NET Framework приложений до .NET Core или .NET 5. Она автоматизирует многие из распространенных задач, связанных с обновлением приложений, таких как изменение формата файлов проекта, настройка соответствующих целевых платформ, Обновление зависимостей NuGet и многое другое.

## <a name="references"></a>Ссылки

- [Что такое .NET Standard?](https://dotnet.microsoft.com/platform/dotnet-standard)
- [Знакомство с .NET 5](https://devblogs.microsoft.com/dotnet/introducing-net-5/)
- [Миграция с ASP.NET Core 3,1 на 5,0](/aspnet/core/migration/31-to-50)
- [Помощник по обновлению .NET](https://aka.ms/dotnet-upgrade-assistant)

>[!div class="step-by-step"]
>[Назад](choose-net-core-version.md)
>[Вперед](migrate-web-forms.md)
