---
title: Управление версиями языка C# — руководство по C#
description: Дополнительные сведения о том, как версия языка C# определяется на основе вашего проекта и какие причины лежат в основе этого решения. Сведения о ручном переопределении значения по умолчанию.
ms.custom: updateeachrelease
ms.date: 08/11/2020
ms.openlocfilehash: b7cb989224b2ed609051b4703ab852437c0774d0
ms.sourcegitcommit: 05d0087dfca85aac9ca2960f86c5efd218bf833f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2021
ms.locfileid: "105637524"
---
# <a name="c-language-versioning"></a>Управление версиями языка C#

Компилятор C# последней версии определяет версию языка по умолчанию на основе целевой платформы или платформ проекта. Visual Studio не предоставляет пользовательский интерфейс для изменения этого значения, но его можно изменить, отредактировав файл *CSPROJ*. Выбор значения по умолчанию гарантирует, что вы используете последнюю версию языка, совместимую с вашей целевой платформой. Вы получите преимущество в виде доступа к последним функциям языка, совместимым с целевым объектом проекта. Этот вариант по умолчанию также гарантирует, что вы не будете использовать язык, который требует такие типы или поведение во время выполнения, которые недоступны в целевой платформе. Выбор более новой версии языка, чем значение по умолчанию, может усложнить диагностику ошибок во время компиляции и выполнения.

Приведенные в этой статье правила относятся к компилятору, поставляемому с Visual Studio 2019, или к пакету SDK для .NET. Компиляторы C#, которые являются частью установки Visual Studio 2017 или более ранних версий пакета SDK для .NET Core предназначены для C# 7.0 по умолчанию.

C# 8.0 поддерживается только в .NET Core 3.x и более поздних версиях. Для многих новых функций нужны функции среды выполнения и библиотеки, появившиеся в .NET Core 3. x:

- [Для реализации интерфейса по умолчанию](../whats-new/csharp-8.md#default-interface-methods) требуются новые функции в среде CLR .NET Core 3.0.
- Для [асинхронных потоков](../whats-new/csharp-8.md#asynchronous-streams) требуются новые типы <xref:System.IAsyncDisposable?displayProperty=nameWithType>, <xref:System.Collections.Generic.IAsyncEnumerable%601?displayProperty=nameWithType> и <xref:System.Collections.Generic.IAsyncEnumerator%601?displayProperty=nameWithType>.
- Для [индексов и диапазонов](../whats-new/csharp-8.md#indices-and-ranges) требуются новые типы <xref:System.Index?displayProperty=nameWithType> и <xref:System.Range?displayProperty=nameWithType>.
- [Ссылочные типы, допускающие значение NULL](../whats-new/csharp-8.md#nullable-reference-types), используют несколько [атрибутов](attributes/nullable-analysis.md) для предоставления улучшенных предупреждений. Эти атрибуты были добавлены в .NET Core 3.0. Другие целевые платформы не были помечены ни одним из этих атрибутов. Это означает, что предупреждения, допускающие значение NULL, могут неточно отражать потенциальные проблемы.

C# 9.0 поддерживается только в .NET 5 и более поздних версиях.

## <a name="defaults"></a>Значения по умолчанию

Компилятор определяет значение по умолчанию на основе следующих правил:

| Целевая платформа | version | Версия языка C# по умолчанию |
|------------------|---------|-----------------------------|
| .NET             | 5.x     | C# 9.0                      |
| .NET Core        | 3.x     | C# 8.0                      |
| .NET Core        | 2.x     | C# 7.3                      |
| .NET Standard    | 2.1     | C# 8.0                      |
| .NET Standard    | 2.0     | C# 7.3                      |
| .NET Standard    | 1.x     | C# 7.3                      |
| .NET Framework   | все     | C# 7.3                      |

Если проект предназначен для платформы в предварительной версии с поддержкой соответствующего языка в предварительной версии, будет использоваться язык, поддерживаемый в предварительной версии. Вы можете использовать новейшие возможности в этой предварительной версии в любой среде, не затрагивая проекты, предназначенные для выпущенной версии .NET Core.

> [!IMPORTANT]
> В Visual Studio 2017 во все создаваемые файлы проектов добавлялась запись `<LangVersion>latest</LangVersion>`. На момент добавления последней считалась версия *C# 7.0*. Но после обновления до Visual Studio 2019 эта запись указывает на последнюю выпущенную версию, независимо от целевой платформы. Теперь для этих проектов [переопределяется поведение по умолчанию](#override-a-default). Вам нужно изменить файл проекта и удалить этот узел. После этого проект будет использовать версию компилятора, рекомендованную для вашей целевой платформы.

## <a name="override-a-default"></a>Переопределение значения по умолчанию

Если необходимо явно указать версию C#, это можно сделать несколькими способами:

- Вручную изменить [файл проекта](#edit-the-project-file).
- Задать версию языка [для нескольких проектов в подкаталоге](#configure-multiple-projects).
- Настроить [параметр компилятора **LangVersion**](compiler-options/language.md#langversion).

> [!TIP]
> Чтобы узнать, какую версию языка вы используете в данный момент, поставьте `#error version` (с учетом регистра) в коде. Это позволяет компилятору вывести ошибку CS8304 с сообщением, содержащим сведения об используемой версии компилятора и текущей выбранной версии языка. Дополнительные сведения см. в статье [#error (справочник по C#)](preprocessor-directives.md#error-and-warning-information).

### <a name="edit-the-project-file"></a>Изменение файла проекта

Версию языка можно задать в файле проекта. Например, если доступ к предварительной версии функций должен быть задан явным образом, можно добавить следующий элемент:

```xml
<PropertyGroup>
   <LangVersion>preview</LangVersion>
</PropertyGroup>
```

Значение `preview` использует последнюю предварительную версию языка C#, которую поддерживает компилятор.

### <a name="configure-multiple-projects"></a>Настройка нескольких проектов

Чтобы настроить несколько проектов, вы можете создать файл **Directory.Build.props**, содержащий элемент `<LangVersion>`. Обычно это делается в каталоге решения. Добавьте следующий код в файл **Directory.Build.props** в каталоге решения:

```xml
<Project>
 <PropertyGroup>
   <LangVersion>preview</LangVersion>
 </PropertyGroup>
</Project>
```

Сборки во всех подкаталогах каталога, который содержит этот файл, будут использовать предварительную версию C#. Дополнительные сведения см. в статье [Настройка сборки](/visualstudio/msbuild/customize-your-build).

## <a name="c-language-version-reference"></a>Справочник по версиям языка C#

В следующей таблице показаны все текущие версии языка C#. Ваш компилятор может не распознавать все значения, если имеет более раннюю версию. При установке .последней версии пакета SDK для .NET вы получаете доступ ко всем значениям в таблице.

[!INCLUDE [langversion-table](includes/langversion-table.md)]

> [!TIP]
> Откройте [Командную строку разработчика или PowerShell для разработчиков в Visual Studio](/visualstudio/ide/reference/command-prompt-powershell) и выполните следующую команду, чтобы просмотреть список версий языка, доступных на вашем компьютере.
>
> ```CMD
> csc -langversion:?
> ```
>
> В ответ на запрос параметра компиляции [**LangVersion](compiler-options/language.md#langversion) такого типа выводится примерно следующее:
>
> ```CMD
> Supported language versions:
> default
> 1
> 2
> 3
> 4
> 5
> 6
> 7.0
> 7.1
> 7.2
> 7.3
> 8.0
> 9.0 (default)
> latestmajor
> preview
> latest
> ```
