---
description: Параметры компилятора C# для управления созданием кода. Эти параметры влияют на код, создаваемый компилятором для указанной компиляции.
title: Параметры компилятора C# — параметры создания кода
ms.date: 03/12/2021
f1_keywords:
- cs.build.options
helpviewer_keywords:
- DebugType compiler option [C#]
- Optimize compiler option [C#]
- Deterministic compiler option [C#]
- ProduceOnlyReferenceAssembly compiler option [C#]
ms.openlocfilehash: a846bc515c501ec5a14069dd3b312b5e2df43d25
ms.sourcegitcommit: 5ce37699c2a51ed173171813be68ef7577b1aba5
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/23/2021
ms.locfileid: "104881149"
---
# <a name="c-compiler-options-that-control-code-generation"></a>Параметры компилятора C#, которые управляют созданием кода

Следующие параметры управляют созданием кода в компиляторе. Новый синтаксис MSBuild выделен **полужирным шрифтом**. Для старого синтаксиса *csc.exe* используется формат `code style`.

- **DebugType** / `-debug`: выдача (или невыдача) отладочных сведений.
- **Optimize** / `-optimize`: включение оптимизаций.
- **Deterministic** / `-deterministic`: создание эквивалентных (побайтовое сравнение) выходных данных для одного источника входных данных.
- **ProduceOnlyReferenceAssembly** / `-refonly`: создание базовой сборки вместо полной сборки в качестве основного выходного файла.

## <a name="debugtype"></a>DebugType

При использовании параметра **DebugType** компилятор создает отладочные сведения и помещает их в выходном файле или файлах. Отладочные сведения добавляются по умолчанию для конфигурации сборки *отладки*. По умолчанию этот параметр отключен для конфигурации сборки *выпуска*.

```xml
<DebugType>pdbonly</DebugType>
```

Для всех версий компилятора, начиная с C# 6.0, разницы между *pdbonly* и *full* нет. Выберите *pdbonly*. Чтобы изменить расположение файла с расширением *.pdb*, см. раздел [**PdbFile**](./advanced.md#pdbfile).

> [!IMPORTANT]
> Этот раздел относится только к компиляторам более ранних версий, чем C# 6.0.
> Значение этого элемента может быть либо `full`, либо `pdbonly`. Аргумент *full*, действующий при отсутствии *pdbonly*, позволяет присоединить отладчик к выполняющейся программе. Определение *pdbonly* позволяет выполнять отладку исходного кода при запуске программы в отладчике, но при этом ассемблер отображается только при подключении выполняющейся программы к отладчику. Используйте этот параметр для создания отладочных сборок. При использовании параметра *full* нужно учитывать некоторое влияние на скорость и размер оптимизированного кода JIT и незначительное влияние на качество кода с *full*. Для создания кода выпуска рекомендуется использовать *pdbonly* или не использовать PDB. Разница между *pdbonly* и *full* заключается в том, что компилятор с *full* создает <xref:System.Diagnostics.DebuggableAttribute>, чтобы сообщить JIT-компилятору о доступности отладочных сведений. Поэтому если при использовании *full* код содержит <xref:System.Diagnostics.DebuggableAttribute> со значением false, вы получите сообщение об ошибке. Дополнительные сведения о настройке производительности отладки для приложения см. в разделе [Упрощение отладки образов](../../../framework/debug-trace-profile/making-an-image-easier-to-debug.md).

## <a name="optimize"></a>Оптимизация

Параметр **Optimize** включает или отключает оптимизацию кода компилятором, чтобы сделать код более быстрым, коротким и эффективным. Параметр *Optimize* включен по умолчанию для конфигурации сборки *выпуска*. По умолчанию этот параметр отключен для конфигурации сборки *отладки*.

```xml
<Optimize>true</Optimize>
```

Параметр **Optimize** можно задать на странице свойств **сборки** для проекта в Visual Studio.

Кроме того, параметр **Optimize** включает оптимизацию кода во время выполнения в общеязыковой среде выполнения. По умолчанию оптимизация отключена. Чтобы включить оптимизацию, укажите **Optimize+** . При создании модуля для сборки используйте те же настройки **Optimize**, что и для сборки. Параметры **Optimize** и [**Debug**](#debugtype) можно комбинировать.

## <a name="deterministic"></a>Детерминированное

Указывает компилятору на необходимость создания сборки, чьи побайтовые выходные данные идентичны в разных компиляциях, если входные данные идентичны.

```xml
<Deterministic>true</Deterministic>
```

По умолчанию выходные данные компилятора из заданного набора входных данных являются уникальными, так как компилятор добавляет метку времени и идентификатор MVID, который создается из случайных чисел. Вы можете использовать параметр `<Deterministic>` для создания *детерминированной сборки*, двоичное содержимое которой идентично в разных компиляциях при условии, что входные данные не изменяются. В такой сборке поля timestamp и MVID будут заменены значениями, полученными из хэша всех входных данных компиляции. Компилятор рассматривает следующие входные данные, которые влияют на детерминированность:

- Последовательность параметров командной строки.
- Содержимое RSP-файла ответов в компиляторе.
- Точная версия компилятора и его связанные сборки.
- Текущий путь к каталогу.
- Двоичное содержимое всех файлов, явным образом переданных компилятору прямо или косвенно, в том числе:
  - Исходные файлы
  - Связанные сборки
  - Связанные модули
  - Ресурсы
  - Файл ключа строгого имени
  - Файлы ответов @
  - Анализаторы
  - Наборы правил
  - Другие файлы, которые могут использоваться анализаторами
- Текущий язык и региональные параметры (для языка сообщений о диагностике и исключениях).
- Кодировка по умолчанию (или текущая кодовая страница), если кодировка не указана.
- Наличие, отсутствие и содержимое файлов на пути поиска компилятора (задается, например, с помощью `-lib` или `-recurse`).
- Платформа общеязыковой среды выполнения (CLR), на которой выполняется компилятор.
- Значение `%LIBPATH%`, которое может повлиять на загрузку зависимостей анализатора.

Детерминированную компиляцию можно использовать, чтобы определить, компилируются ли двоичные данные из надежного источника. Детерминированные выходные данные могут быть полезны, если источник является общедоступным. Также с их помощью можно определить, будут ли шаги сборки, зависящие от изменений в двоичном файле, использоваться в процессе сборки.

## <a name="produceonlyreferenceassembly"></a>ProduceOnlyReferenceAssembly

Параметр **ProduceOnlyReferenceAssembly** указывает на то, что в качестве основных выходных данных должна быть выведена базовая сборка, а не сборка реализации. Параметр **ProduceOnlyReferenceAssembly** автоматически отключает вывод PDB, так как базовые сборки не могут выполняться.

```xml
<ProduceOnlyReferenceAssembly>true</ProduceOnlyReferenceAssembly>
```

Базовые сборки являются особым типом сборки, которая содержит только минимальный объем метаданных, необходимый для представления общедоступного API библиотеки. Такие сборки включают в себя объявления для всех элементов, которые важны при указании ссылки на сборку в средствах сборки, но исключают все реализации элементов, а также объявления закрытых элементов, не имеющих наблюдаемого влияния на их контракт API. Дополнительные сведения см. в статье [Базовые сборки](../../../standard/assembly/reference-assemblies.md).

Параметры **ProduceOnlyReferenceAssembly** и [**ProduceReferenceAssembly**](output.md#producereferenceassembly) являются взаимоисключающими.
