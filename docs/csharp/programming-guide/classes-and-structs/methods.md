---
title: Методы. Руководство по программированию на C#
description: Метод в C# — это блок кода, содержащий ряд инструкций. Программа выполняет инструкции путем вызова метода и указания аргументов.
ms.date: 03/08/2021
helpviewer_keywords:
- methods [C#]
- C# language, methods
ms.assetid: cc738f07-e8cd-4683-9585-9f40c0667c37
ms.openlocfilehash: d503c394e02f6f384e63de4fcd9cc8d2eec43da0
ms.sourcegitcommit: 1dbe25ff484a02025d5c34146e517c236f7161fb
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/19/2021
ms.locfileid: "104653508"
---
# <a name="methods-c-programming-guide"></a>Методы (Руководство по программированию на C#)

Метод — это блок кода, содержащий ряд инструкций. Программа инициирует выполнение инструкций, вызывая метод и указывая все аргументы, необходимые для этого метода. В C# все инструкции выполняются в контексте метода.

Метод `Main` является точкой входа для каждого приложения C# и вызывается общеязыковой средой выполнения (CLR) при запуске программы. В приложении, использующем [инструкции верхнего уровня](../main-and-command-args/top-level-statements.md), метод `Main` создается компилятором и содержит все инструкции верхнего уровня.

> [!NOTE]
> В этой статье рассматриваются названные методы. Сведения об анонимных функциях см. в разделе [Анонимные функции](../statements-expressions-operators/anonymous-functions.md).

## <a name="method-signatures"></a>Сигнатуры методов

Методы объявляются в [классе](../../language-reference/keywords/class.md), [структуре](../../language-reference/builtin-types/struct.md) или [интерфейсе](../interfaces/index.md) путем указания уровня доступа, такого как `public` или `private`, необязательных модификаторов, таких как `abstract` или `sealed`, возвращаемого значения, имени метода и всех параметров этого метода. Все эти части вместе представляют собой сигнатуру метода.

> [!IMPORTANT]
> Тип возврата метода не является частью сигнатуры метода в целях перегрузки метода. Однако он является частью сигнатуры метода при определении совместимости между делегатом и методом, который он указывает.

Параметры метода заключаются в скобки и разделяются запятыми. Пустые скобки указывают, что параметры методу не требуются. Этот класс содержит четыре метода:

[!code-csharp[DifferentModifiersOnMethods#1](snippets/methods/Program.cs#1)]

## <a name="method-access"></a>Доступ к методу

Вызов метода в объекте аналогичен доступу к полю. После имени объекта добавьте точку, имя метода и круглые скобки. Аргументы перечисляются в этих скобках и разделяются запятыми. Таким образом, методы класса `Motorcycle` могут вызываться, как показано в следующем примере:

[!code-csharp[CallingMethods#2](snippets/methods/Program.cs#2)]

## <a name="method-parameters-vs-arguments"></a>Параметры и аргументы метода

Определение метода задает имена и типы всех необходимых параметров. Когда вызывающий код вызывает метод, он предоставляет конкретные значения, называемые аргументами, для каждого параметра. Аргументы должны быть совместимы с типом параметра, но имя аргумента (если есть), используемое в вызывающем коде, не обязательно должно совпадать с именем параметра, указанным в методе. Пример:

[!code-csharp[MethodExamples#3](snippets/methods/Program.cs#3)]

## <a name="passing-by-reference-vs-passing-by-value"></a>Передача по ссылке и передача по значению

По умолчанию при передаче в метод экземпляра [типа значения](../../language-reference/builtin-types/value-types.md) вместо самого этого экземпляра передается его копия. Поэтому изменения в аргументе не оказывают влияния на исходный экземпляр в вызывающем методе. Чтобы передать экземпляр типа значения по ссылке, используйте ключевое слово `ref`. Дополнительные сведения см. в разделе [Передача параметров типа значения](./passing-value-type-parameters.md).

При передаче в метод объекта ссылочного типа передается ссылка на этот объект. То есть метод получает не сам объект, а аргумент, который указывает расположение объекта. При изменении члена объекта с помощью этой ссылки это изменение отражается в аргументе в вызывающем методе, даже если объект передается по значению.

Ссылочный тип создается с помощью ключевого слова `class`, как показано в следующем примере.

[!code-csharp[SampleRefTypeClass#4](snippets/methods/Program.cs#4)]

Теперь, если передать объект, основанный на этом типе, в метод, то будет передана ссылка на объект. В следующем примере объект типа `SampleRefType` передается в метод `ModifyObject`:

[!code-csharp[PassingAReferenceType#5](snippets/methods/Program.cs#5)]

В этом примере, в сущности, делается то же, что и в предыдущем примере, — аргумент по значению передается в метод. Но поскольку здесь используется ссылочный тип, результат будет другим. В данном случае в методе `ModifyObject` изменено поле `value` параметра `obj`, а также изменено поле `value` аргумента, `rt`в методе `TestRefType` . В качестве выходных данных метод `TestRefType` отображает 33.

Дополнительные сведения о передаче ссылочных типов по ссылке и по значению см. в разделах [Передача параметров ссылочного типа](./passing-reference-type-parameters.md) и [Ссылочные типы](../../language-reference/keywords/reference-types.md).

## <a name="return-values"></a>Возвращаемые значения

Методы могут возвращать значение вызывающему объекту. Если тип возврата, указываемый перед именем метода, не `void`, этот метод может возвращать значение с помощью ключевого слова `return` . Инструкция с ключевым словом `return` , за которым следует значение, соответствующее типу возврата, будет возвращать это значение объекту, вызвавшему метод.

Значение может возвращаться вызывающему объекту по значению или, начиная с C# версии 7.0, [по ссылке](ref-returns.md). Значения возвращаются вызывающему объекту по ссылке, если ключевое слово `ref` используется в сигнатуре метода и указывается после каждого ключевого слова `return`. Например, следующая сигнатура метода и оператор return указывают, что метод возвращает имена переменных `estDistance` вызывающему объекту по ссылке.

```csharp
public ref double GetEstimatedDistance()
{
    return ref estDistance;
}
```

Ключевое слове `return` также останавливает выполнение метода. Если тип возврата — `void`, инструкцию `return` без значения по-прежнему можно использовать для завершения выполнения метода. Без ключевого слова `return` этот метод будет останавливать выполнение при достижении конца блока кода. Методы с типом возврата, отличным от void, должны использовать ключевое слово `return` для возврата значения. Например, в следующих двух методах ключевое слово `return` используется для возврата целочисленных значений.

[!code-csharp[SimpleMathClass#6](snippets/methods/Program.cs#6)]

Чтобы использовать значение, возвращаемое из метода, вызывающий метод может применять сам вызов метода везде, где будет достаточно значения того же типа. Можно также назначить возвращаемое значение переменной. Например, следующие два примера кода достигают одной и той же цели.

[!code-csharp[SquareANumberWithAddTwoNumbersUsingLocalVariable#7](snippets/methods/Program.cs#7)]

[!code-csharp[SquareANumberWithAddTwoNumbersInTheSameLine#8](snippets/methods/Program.cs#8)]

Использование локальной переменной, в данном случае `result`, для сохранения значения является необязательным. Это может улучшить читаемость кода или может оказаться необходимым, если нужно сохранить исходное значение аргумента для всей области метода.

Чтобы использовать значение, возвращаемое по ссылке из метода, необходимо объявить [локальную ссылочную переменную](ref-returns.md#ref-locals), если планируется изменение значения. Например, если метод `Planet.GetEstimatedDistance` возвращает значение <xref:System.Double> по ссылке, можно определить его как локальную ссылочную переменную с использованием кода следующего вида:

```csharp
ref int distance = plant
```

Возвращать многомерный массив из метода `M`, который изменяет содержимое массива, необязательно, если вызывающая функция передает массив в `M`.  В целях оптимизации можно возвращать полученный массив из `M` или функциональный поток значений, однако это необязательно. Это связано с тем, что C# передает все ссылочные типы по значению, а значение ссылки на массив представляет собой указатель на массив. В методе `M` любые изменения содержимого массива отслеживаются любым кодом, имеющим ссылку на массив, как показано в приведенном ниже примере:

```csharp
static void Main(string[] args)
{
    int[,] matrix = new int[2, 2];
    FillMatrix(matrix);
    // matrix is now full of -1
}

public static void FillMatrix(int[,] matrix)
{
    for (int i = 0; i < matrix.GetLength(0); i++)
    {
        for (int j = 0; j < matrix.GetLength(1); j++)
        {
            matrix[i, j] = -1;
        }
    }
}
```

Для получения дополнительной информации см. [return](../../language-reference/keywords/return.md).

## <a name="async-methods"></a>Асинхронные методы

С помощью функции async можно вызывать асинхронные методы, не прибегая к использованию явных обратных вызовов или ручному разделению кода между несколькими методами или лямбда-выражениями.

Если пометить метод с помощью модификатора [async](../../language-reference/keywords/async.md) , можно использовать в этом методе инструкцию [await](../../language-reference/operators/await.md) . Когда управление достигает выражения await в асинхронном методе, управление возвращается вызывающему объекту и выполнение метода приостанавливается до завершения выполнения ожидающей задачи. После завершения задачи можно возобновить выполнение в методе.

> [!NOTE]
> Асинхронный метод возвращается в вызывающий объект, когда он встречает первый ожидаемый объект, выполнение которого еще не завершено, или когда выполнение асинхронного метода доходит до конца — в зависимости от того, что происходит раньше.

Асинхронный метод обычно имеет тип возвращаемого значения <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.Task>, <xref:System.Collections.Generic.IAsyncEnumerable%601> или `void`. Тип возвращаемого значения `void` в основном используется для определения обработчиков событий, где требуется возвращать тип `void`. Асинхронный метод, который возвращает тип `void`, не может быть ожидающим. Вызывающий объект метода, возвращающего значение типа void, не может перехватывать исключения, которые выдает этот метод. Начиная с C# 7.0 асинхронный метод может возвращать [любой тип вида задачи](../../whats-new/csharp-7.md#generalized-async-return-types).

В следующем примере `DelayAsync` является асинхронным методом с типом возврата <xref:System.Threading.Tasks.Task%601>. `DelayAsync` имеет инструкцию `return` , которая возвращает целое число. Поэтому объявление метода `DelayAsync` должно иметь тип возврата `Task<int>`. Поскольку тип возврата — `Task<int>`, вычисление выражения `await` в `DoSomethingAsync` создает целое число, как показывает следующая инструкция: `int result = await delayTask`.

В следующем примере метод `Main` служит примером асинхронного метода с типом возврата <xref:System.Threading.Tasks.Task>. Он переходит к методу `DoSomethingAsync` и, поскольку он выражается в одной строке, он может опустить ключевые слова `async` и `await`. Поскольку `DoSomethingAsync` является асинхронным методом, задача для вызова `DoSomethingAsync` должна быть ожидаемой, как показывает следующая инструкция: `await DoSomethingAsync();`.

:::code language="csharp" source="snippets/classes-and-structs/methods/Program.cs":::

Асинхронный метод не может объявить все параметры [ref](../../language-reference/keywords/ref.md) или [out](../../language-reference/keywords/out-parameter-modifier.md) , но может вызывать методы, которые имеют такие параметры.

Дополнительные сведения об асинхронных методах см. в разделах [Асинхронное программирование с использованием ключевых слов async и await (C#)](../concepts/async/index.md) и [Типы возвращаемых значений асинхронных операций](../concepts/async/async-return-types.md).

## <a name="expression-body-definitions"></a>Определения текста выражений

Часто используются определения методов, которые просто немедленно возвращаются с результатом выражения или которые имеют единственную инструкцию в тексте метода. Для определения таких методов существует сокращенный синтаксис с использованием `=>`:

```csharp
public Point Move(int dx, int dy) => new Point(x + dx, y + dy);
public void Print() => Console.WriteLine(First + " " + Last);
// Works with operators, properties, and indexers too.
public static Complex operator +(Complex a, Complex b) => a.Add(b);
public string Name => First + " " + Last;
public Customer this[long id] => store.LookupCustomer(id);
```

Если метод возвращает `void` или является асинхронным методом, то текст метода должен быть выражением инструкции (так же, как при использовании лямбда-выражений). Свойства и индексаторы должны быть только для чтения, и вы не должны использовать ключевое слово `get` метода доступа.

## <a name="iterators"></a>Iterators

Итератор выполняет настраиваемую итерацию по коллекции, например по списку или массиву. Итератор использует инструкцию [yield return](../../language-reference/keywords/yield.md) для возврата всех элементов по одному. Когда достигается инструкция [yield return](../../language-reference/keywords/yield.md) , текущее расположение в коде запоминается. При следующем вызове итератора выполнение возобновляется с этого места.

Итератор вызывается из клиентского кода с помощью инструкции [foreach](../../language-reference/keywords/foreach-in.md) .

Тип возврата итератора может быть <xref:System.Collections.IEnumerable>, <xref:System.Collections.Generic.IEnumerable%601>, <xref:System.Collections.IEnumerator> или <xref:System.Collections.Generic.IEnumerator%601>.

Дополнительные сведения см. в разделе [Итераторы](../concepts/iterators.md).

## <a name="c-language-specification"></a>Спецификация языка C#

[!INCLUDE[CSharplangspec](~/includes/csharplangspec-md.md)]

## <a name="see-also"></a>См. также

- [Руководство по программированию на C#](../index.md)
- [Классы и структуры](index.md)
- [Модификаторы доступа](access-modifiers.md)
- [Статические классы и члены статических классов](static-classes-and-static-class-members.md)
- [Наследование](inheritance.md)
- [Абстрактные и запечатанные классы и члены классов](abstract-and-sealed-classes-and-class-members.md)
- [params](../../language-reference/keywords/params.md)
- [return](../../language-reference/keywords/return.md)
- [out](../../language-reference/keywords/out.md)
- [ref](../../language-reference/keywords/ref.md)
- [Передача параметров](passing-parameters.md)
