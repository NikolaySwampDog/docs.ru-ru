---
title: Операторы верхнего уровня. Руководство по программированию на C#
description: Узнайте об операторах верхнего уровня в C# 9 и более поздних версиях.
ms.date: 03/08/2021
helpviewer_keywords:
- C# language, top-level statements
- C# language, Main method
ms.openlocfilehash: 69ff5fd606f5e12f55bd3e6dfc15fc7e64d8352b
ms.sourcegitcommit: e3cf8227573e13b8e1f4e3dc007404881cdafe47
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/11/2021
ms.locfileid: "103190449"
---
# <a name="top-level-statements-c-programming-guide"></a>Операторы верхнего уровня (руководство по программированию на C#)

Начиная с версии C# 9, метод `Main` не нужно явно включать в проект консольного приложения. Вместо этого можно использовать *операторы верхнего уровня* для минимизации объема создаваемого кода. В этом случае компилятор создает класс и точку входа метода `Main` для приложения.

Ниже приведен файл *Program.cs*, который является полноценной программой C# (версия С# 9):

:::code language="csharp" source="snippets/top-level-statements-1/Program.cs":::

Операторы верхнего уровня позволяют создавать простой программный код для небольших служебных программ, таких как Функции Azure и GitHub Actions. Они также помогают начинающим программистам C# начать обучение и приступить к написанию кода.

В следующих разделах описываются правила, которые определяют использование операторов верхнего уровня.

## <a name="only-one-top-level-file"></a>Только один файл верхнего уровня

Приложение должно иметь только одну точку входа, поэтому проект может содержать только один файл с операторами верхнего уровня. Размещение операторов верхнего уровня в нескольких файлах в проекте приводит к следующей ошибке компилятора:

> CS8802 Only one compilation unit can have top-level statements (Только одна единица компиляции может содержать операторы верхнего уровня).

В проекте может содержаться любое количество дополнительных файлов с исходным кодом, в которых нет операторов верхнего уровня.

## <a name="no-other-entry-points"></a>Другие точки входа отсутствуют

Метод `Main` можно написать явным образом, но он не может функционировать как точка входа. Компилятор выдает следующее предупреждение:

> CS7022 The entry point of the program is global code; ignoring 'Main()' entry point (Точка входа программы является глобальным кодом; точка входа Main() игнорируется).

В проекте с операторами верхнего уровня нельзя использовать параметр компилятора [-main](../../language-reference/compiler-options/main-compiler-option.md) для выбора точки входа, даже если в проекте есть один или несколько методов `Main`.

## <a name="using-directives"></a>Директивы `using`

Если вы включаете директивы using, они должны быть первыми в файле, как показано в следующем примере:

:::code language="csharp" source="snippets/top-level-statements-1/Program.cs":::

## <a name="global-namespace"></a>Глобальное пространство имен

Операторы верхнего уровня неявно находятся в глобальном пространстве имен.

## <a name="namespaces-and-type-definitions"></a>Пространства имен и определения типов

Файл с операторами верхнего уровня может также содержать пространства имен и определения типов, но они должны следовать за операторами верхнего уровня. Пример:

:::code language="csharp" source="snippets/top-level-statements-2/Program.cs":::

## `args`

Операторы верхнего уровня могут ссылаться на переменную `args` для обращения к любым введенным аргументам командной строки. Переменная `args` никогда не имеет значение NULL, но ее значение `Length` равно нулю, если не были предоставлены аргументы командной строки. Пример:

:::code language="csharp" source="snippets/top-level-statements-3/Program.cs":::

## `await`

Асинхронный метод можно вызвать с помощью `await`. Пример:

:::code language="csharp" source="snippets/top-level-statements-4/Program.cs":::

## <a name="exit-code-for-the-process"></a>Код завершения для процесса

Чтобы вернуть значение `int` при завершении работы приложения, используйте оператор `return`, как в методе `Main`, который возвращает `int`. Пример:

:::code language="csharp" source="snippets/top-level-statements-5/Program.cs":::

## <a name="implicit-entry-point-method"></a>Неявный метод точки входа

Компилятор создает метод, используемый в качестве точки входа программы для проекта с операторами верхнего уровня. Имя этого метода на самом деле не `Main`, это описание реализации, на которое код не может ссылаться напрямую. Сигнатура метода зависит от того, содержат ли операторы верхнего уровня ключевое слово `await` или оператор `return`. В следующей таблице показано, как будет выглядеть сигнатура метода; имя метода `Main` в таблице используется для удобства.

| Код верхнего уровня содержит| Неявная сигнатура `Main`                    |
|------------------------|----------------------------------------------|
| `await` и `return`   | `static async Task<int> Main(string[] args)` |
| `await`                | `static async Task Main(string[] args)`      |
| `return`               | `static int Main(string[] args)`             |
| Ни `await`, ни `return` | `static void Main(string[] args)`            |

## <a name="c-language-specification"></a>Спецификация языка C#

[!INCLUDE[CSharplangspec](~/includes/csharplangspec-md.md)]
[Инструкции верхнего уровня](~/_csharplang/proposals/csharp-9.0/top-level-statements.md)

## <a name="see-also"></a>См. также раздел

- [Руководство по программированию на C#](../index.md)
- [Методы](../classes-and-structs/methods.md)
- [Структура программы C#](../inside-a-program/index.md)
