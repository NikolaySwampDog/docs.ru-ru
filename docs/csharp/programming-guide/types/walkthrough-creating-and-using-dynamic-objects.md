---
title: Пошаговое руководство. Создание и использование динамических объектов (C# и Visual Basic)
description: Узнайте, как создавать и использовать динамические объекты. Создайте настраиваемый динамический объект и проект, использующий библиотеку IronPython.
ms.date: 03/24/2021
dev_langs:
- csharp
- vb
helpviewer_keywords:
- dynamic objects [Visual Basic]
- dynamic objects
- dynamic objects [C#]
ms.openlocfilehash: 3b342f23a2974affdcd7a1e91093aaef504afb63
ms.sourcegitcommit: e16315d9f1ff355f55ff8ab84a28915be0a8e42b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/25/2021
ms.locfileid: "105111027"
---
# <a name="walkthrough-creating-and-using-dynamic-objects-c-and-visual-basic"></a><span data-ttu-id="dc2f2-104">Пошаговое руководство. Создание и использование динамических объектов (C# и Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="dc2f2-104">Walkthrough: Creating and Using Dynamic Objects (C# and Visual Basic)</span></span>

<span data-ttu-id="dc2f2-105">Динамические объекты предоставляют такие элементы, как свойства и методы, во время выполнения, а не во время компиляции.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-105">Dynamic objects expose members such as properties and methods at run time, instead of at compile time.</span></span> <span data-ttu-id="dc2f2-106">Это позволяет создавать объекты для работы со структурами, не соответствующими статическому типу или формату.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-106">This enables you to create objects to work with structures that do not match a static type or format.</span></span> <span data-ttu-id="dc2f2-107">Например, можно использовать динамический объект для ссылки на модель DOM HTML, которая может содержать любую комбинацию допустимых элементов и атрибутов разметки HTML.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-107">For example, you can use a dynamic object to reference the HTML Document Object Model (DOM), which can contain any combination of valid HTML markup elements and attributes.</span></span> <span data-ttu-id="dc2f2-108">Поскольку каждый документ HTML является уникальным, элементы для конкретного документа HTML определяются во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-108">Because each HTML document is unique, the members for a particular HTML document are determined at run time.</span></span> <span data-ttu-id="dc2f2-109">Наиболее распространенный способ ссылки на атрибут элемента HTML заключается в передаче имени этого атрибута в метод `GetProperty` элемента.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-109">A common method to reference an attribute of an HTML element is to pass the name of the attribute to the `GetProperty` method of the element.</span></span> <span data-ttu-id="dc2f2-110">Для ссылки на атрибут `id` элемента HTML `<div id="Div1">` следует сначала получить ссылку на элемент `<div>`, а затем использовать `divElement.GetProperty("id")`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-110">To reference the `id` attribute of the HTML element `<div id="Div1">`, you first obtain a reference to the `<div>` element, and then use `divElement.GetProperty("id")`.</span></span> <span data-ttu-id="dc2f2-111">При использовании динамического объекта можно сослаться на атрибут `id` в виде `divElement.id`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-111">If you use a dynamic object, you can reference the `id` attribute as `divElement.id`.</span></span>

 <span data-ttu-id="dc2f2-112">Динамические объекты обеспечивают удобный доступ к динамическим языкам, таким как IronPython и IronRuby.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-112">Dynamic objects also provide convenient access to dynamic languages such as IronPython and IronRuby.</span></span> <span data-ttu-id="dc2f2-113">С помощью динамического объекта можно ссылаться на динамический скрипт, интерпретируемый во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-113">You can use a dynamic object to refer to a dynamic script that is interpreted at run time.</span></span>

 <span data-ttu-id="dc2f2-114">Ссылка на динамический объект выполняется с помощью позднего связывания.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-114">You reference a dynamic object by using late binding.</span></span> <span data-ttu-id="dc2f2-115">В C# тип объектов с поздним связыванием указывается как `dynamic`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-115">In C#, you specify the type of a late-bound object as `dynamic`.</span></span> <span data-ttu-id="dc2f2-116">В Visual Basic тип объектов с поздним связыванием указывается как `Object`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-116">In Visual Basic, you specify the type of a late-bound object as `Object`.</span></span> <span data-ttu-id="dc2f2-117">Дополнительные сведения см. в разделах [dynamic](../../language-reference/builtin-types/reference-types.md) и [Раннее и позднее связывание](../../../visual-basic/programming-guide/language-features/early-late-binding/index.md).</span><span class="sxs-lookup"><span data-stu-id="dc2f2-117">For more information, see [dynamic](../../language-reference/builtin-types/reference-types.md) and [Early and Late Binding](../../../visual-basic/programming-guide/language-features/early-late-binding/index.md).</span></span>

 <span data-ttu-id="dc2f2-118">Вы можете создавать настраиваемые динамические объекты, используя классы из пространства имен <xref:System.Dynamic?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-118">You can create custom dynamic objects by using the classes in the <xref:System.Dynamic?displayProperty=nameWithType> namespace.</span></span> <span data-ttu-id="dc2f2-119">Например, можно создать объект <xref:System.Dynamic.ExpandoObject> и задать члены этого объекта во время выполнения.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-119">For example, you can create an <xref:System.Dynamic.ExpandoObject> and specify the members of that object at run time.</span></span> <span data-ttu-id="dc2f2-120">Также можно создать собственный тип, наследующий класс <xref:System.Dynamic.DynamicObject>.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-120">You can also create your own type that inherits the <xref:System.Dynamic.DynamicObject> class.</span></span> <span data-ttu-id="dc2f2-121">Затем для обеспечения динамических функциональных возможностей во время выполнения можно переопределить члены класса <xref:System.Dynamic.DynamicObject>.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-121">You can then override the members of the <xref:System.Dynamic.DynamicObject> class to provide run-time dynamic functionality.</span></span>

 <span data-ttu-id="dc2f2-122">Эта статья содержит два независимых пошаговых руководства.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-122">This article contains two independent walkthroughs:</span></span>

- <span data-ttu-id="dc2f2-123">Создание пользовательского объекта, который динамически предоставляет содержимое текстового файла в виде свойств объекта.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-123">Create a custom object that dynamically exposes the contents of a text file as properties of an object.</span></span>

- <span data-ttu-id="dc2f2-124">Создание проекта, использующего библиотеку `IronPython`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-124">Create a project that uses an `IronPython` library.</span></span>

<span data-ttu-id="dc2f2-125">Вы можете выполнить одно из них или оба, в последнем случае порядок не имеет значения.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-125">You can do either one of these or both of them, and if you do both, the order doesn't matter.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="dc2f2-126">Предварительные требования</span><span class="sxs-lookup"><span data-stu-id="dc2f2-126">Prerequisites</span></span>

* <span data-ttu-id="dc2f2-127">[Visual Studio 2019 версии 16.9 или более поздней](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) с установленной рабочей нагрузкой **Разработка классических приложений .NET**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-127">[Visual Studio 2019 version 16.9 or a later version](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) with the **.NET desktop development** workload installed.</span></span> <span data-ttu-id="dc2f2-128">Пакет SDK для .NET 5.0 устанавливается автоматически при выборе этой рабочей нагрузки.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-128">The .NET 5.0 SDK is automatically installed when you select this workload.</span></span>

[!INCLUDE[note_settings_general](~/includes/note-settings-general-md.md)]

* <span data-ttu-id="dc2f2-129">Для второго пошагового руководства установите [IronPython](https://ironpython.net/) для .NET.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-129">For the second walkthrough, install [IronPython](https://ironpython.net/) for .NET.</span></span> <span data-ttu-id="dc2f2-130">Перейдите на [страницу загрузки](https://ironpython.net/download/) для получения последней версии.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-130">Go to their [Download page](https://ironpython.net/download/) to obtain the latest version.</span></span>

## <a name="create-a-custom-dynamic-object"></a><span data-ttu-id="dc2f2-131">Создание пользовательского динамического объекта</span><span class="sxs-lookup"><span data-stu-id="dc2f2-131">Create a Custom Dynamic Object</span></span>

<span data-ttu-id="dc2f2-132">В первом пошаговом руководстве определяется пользовательский динамический объект, выполняющий поиск по содержимому текстового файла.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-132">The first walkthrough defines a custom dynamic object that searches the contents of a text file.</span></span> <span data-ttu-id="dc2f2-133">Динамическое свойство указывает искомый текст.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-133">A dynamic property specifies the text to search for.</span></span> <span data-ttu-id="dc2f2-134">Например, если в вызывающем коде указано `dynamicFile.Sample`, динамический класс возвращает общий список строк, содержащий все строки из файла, которые начинаются со слова "Sample".</span><span class="sxs-lookup"><span data-stu-id="dc2f2-134">For example, if calling code specifies `dynamicFile.Sample`, the dynamic class returns a generic list of strings that contains all of the lines from the file that begin with "Sample".</span></span> <span data-ttu-id="dc2f2-135">При поиске не учитывается регистр.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-135">The search is case-insensitive.</span></span> <span data-ttu-id="dc2f2-136">Динамический класс также поддерживает два дополнительных аргумента.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-136">The dynamic class also supports two optional arguments.</span></span> <span data-ttu-id="dc2f2-137">Первый аргумент — это значение перечисления параметра поиска, задающее, где динамический класс должен искать соответствия: в начале строки, в конце строки или в любом месте строки.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-137">The first argument is a search option enum value that specifies that the dynamic class should search for matches at the start of the line, the end of the line, or anywhere in the line.</span></span> <span data-ttu-id="dc2f2-138">Второй аргумент задает, что динамический класс должен перед поиском отсекать начальные и конечные пробелы в каждой строке.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-138">The second argument specifies that the dynamic class should trim leading and trailing spaces from each line before searching.</span></span> <span data-ttu-id="dc2f2-139">Например, если в вызывающем коде указано `dynamicFile.Sample(StringSearchOption.Contains)`, динамический класс выполняет поиск слова "Sample" в любом месте строки.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-139">For example, if calling code specifies `dynamicFile.Sample(StringSearchOption.Contains)`, the dynamic class searches for "Sample" anywhere in a line.</span></span> <span data-ttu-id="dc2f2-140">Если в вызывающем коде указано `dynamicFile.Sample(StringSearchOption.StartsWith, false)`, динамический класс выполняет поиск слова "Sample" в начале каждой строки и не удаляет начальные и конечные пробелы в строках.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-140">If calling code specifies `dynamicFile.Sample(StringSearchOption.StartsWith, false)`, the dynamic class searches for "Sample" at the start of each line, and does not remove leading and trailing spaces.</span></span> <span data-ttu-id="dc2f2-141">По умолчанию динамический класс выполняет поиск соответствия в начале каждой строки, предварительно удаляя начальные и конечные пробелы.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-141">The default behavior of the dynamic class is to search for a match at the start of each line and to remove leading and trailing spaces.</span></span>

### <a name="to-create-a-custom-dynamic-class"></a><span data-ttu-id="dc2f2-142">Создание пользовательского динамического класса</span><span class="sxs-lookup"><span data-stu-id="dc2f2-142">To create a custom dynamic class</span></span>

1. <span data-ttu-id="dc2f2-143">Запустите Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-143">Start Visual Studio.</span></span>

1. <span data-ttu-id="dc2f2-144">Выберите **Создать новый проект**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-144">Select **Create a new project**.</span></span>

1. <span data-ttu-id="dc2f2-145">В диалоговом окне **Создание нового проекта** выберите C# или Visual Basic, выберите **Консольное приложение**, а затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-145">In the **Create a new project** dialog, select C# or Visual Basic, select **Console Application**, and then select **Next**.</span></span>

1. <span data-ttu-id="dc2f2-146">В диалоговом окне **Настройка нового проекта** введите значение `DynamicSample` для параметра **Имя проекта** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-146">In the **Configure your new project** dialog, enter `DynamicSample` for the **Project name**, and then select **Next**.</span></span>

1. <span data-ttu-id="dc2f2-147">В диалоговом окне **Дополнительные сведения** выберите значение **.NET 5.0 (текущая)** для параметра **Целевая платформа**, а затем нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-147">In the **Additional information** dialog, select **.NET 5.0 (Current)** for the **Target Framework**, and then select **Create**.</span></span>

   <span data-ttu-id="dc2f2-148">Создается новый проект.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-148">The new project is created.</span></span>

1. <span data-ttu-id="dc2f2-149">В **обозревателе решений** щелкните проект DynamicSample правой кнопкой мыши и выберите **Добавить** > **Класс**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-149">In **Solution Explorer**, right-click the DynamicSample project and select **Add** > **Class**.</span></span> <span data-ttu-id="dc2f2-150">В поле **Имя** введите `ReadOnlyFile`, а затем нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-150">In the **Name** box, type `ReadOnlyFile`, and then select **Add**.</span></span>

   <span data-ttu-id="dc2f2-151">Будет добавлен новый файл, содержащий класс ReadOnlyFile.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-151">A new file is added that contains the ReadOnlyFile class.</span></span>

1. <span data-ttu-id="dc2f2-152">В верхней части файла *ReadOnlyFile.cs* или *ReadOnlyFile.vb* добавьте следующий код для импорта пространств имен <xref:System.IO?displayProperty=nameWithType> и <xref:System.Dynamic?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-152">At the top of the *ReadOnlyFile.cs* or *ReadOnlyFile.vb* file, add the following code to import the <xref:System.IO?displayProperty=nameWithType> and <xref:System.Dynamic?displayProperty=nameWithType> namespaces.</span></span>

    [!code-csharp[VbDynamicWalkthrough#1](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#1)]
    [!code-vb[VbDynamicWalkthrough#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#1)]

1. <span data-ttu-id="dc2f2-153">Пользовательский динамический объект использует перечисление для определения условия поиска.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-153">The custom dynamic object uses an enum to determine the search criteria.</span></span> <span data-ttu-id="dc2f2-154">Перед оператором класса добавьте следующее определение перечисления.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-154">Before the class statement, add the following enum definition.</span></span>

    [!code-csharp[VbDynamicWalkthrough#2](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#2)]
    [!code-vb[VbDynamicWalkthrough#2](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#2)]

1. <span data-ttu-id="dc2f2-155">Обновите оператор класса, чтобы он наследовал класс `DynamicObject`, как показано в следующем примере кода.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-155">Update the class statement to inherit the `DynamicObject` class, as shown in the following code example.</span></span>

    [!code-csharp[VbDynamicWalkthrough#3](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#3)]
    [!code-vb[VbDynamicWalkthrough#3](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#3)]

1. <span data-ttu-id="dc2f2-156">Добавьте в класс `ReadOnlyFile` следующий код, чтобы задать закрытое поле для пути к файлу и конструктор для класса `ReadOnlyFile`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-156">Add the following code to the `ReadOnlyFile` class to define a private field for the file path and a constructor for the `ReadOnlyFile` class.</span></span>

    [!code-csharp[VbDynamicWalkthrough#4](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#4)]
    [!code-vb[VbDynamicWalkthrough#4](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#4)]

1. <span data-ttu-id="dc2f2-157">Добавьте следующий метод `GetPropertyValue` в класс `ReadOnlyFile`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-157">Add the following `GetPropertyValue` method to the `ReadOnlyFile` class.</span></span> <span data-ttu-id="dc2f2-158">Метод `GetPropertyValue` принимает в качестве входных данных условие поиска и возвращает строки текстового файла, соответствующие этому условию.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-158">The `GetPropertyValue` method takes, as input, search criteria and returns the lines from a text file that match that search criteria.</span></span> <span data-ttu-id="dc2f2-159">Динамический метод, предоставленный классом `ReadOnlyFile`, вызывает метод `GetPropertyValue` для извлечения соответствующих результатов.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-159">The dynamic methods provided by the `ReadOnlyFile` class call the `GetPropertyValue` method to retrieve their respective results.</span></span>

    [!code-csharp[VbDynamicWalkthrough#5](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#5)]
    [!code-vb[VbDynamicWalkthrough#5](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#5)]

1. <span data-ttu-id="dc2f2-160">После метода `GetPropertyValue` добавьте следующий код, чтобы переопределить метод <xref:System.Dynamic.DynamicObject.TryGetMember%2A> класса <xref:System.Dynamic.DynamicObject>.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-160">After the `GetPropertyValue` method, add the following code to override the <xref:System.Dynamic.DynamicObject.TryGetMember%2A> method of the <xref:System.Dynamic.DynamicObject> class.</span></span> <span data-ttu-id="dc2f2-161">Метод <xref:System.Dynamic.DynamicObject.TryGetMember%2A> вызывается при запросе члена динамического класса без указания аргументов.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-161">The <xref:System.Dynamic.DynamicObject.TryGetMember%2A> method is called when a member of a dynamic class is requested and no arguments are specified.</span></span> <span data-ttu-id="dc2f2-162">Аргумент `binder` содержит сведения об элементе, на который дается ссылка, а аргумент `result` ссылается на результат, возвращенный для указанного элемента.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-162">The `binder` argument contains information about the referenced member, and the `result` argument references the result returned for the specified member.</span></span> <span data-ttu-id="dc2f2-163">Метод <xref:System.Dynamic.DynamicObject.TryGetMember%2A> возвращает логическое значение `true`, если запрошенный элемент существует. В противном случае возвращается `false`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-163">The <xref:System.Dynamic.DynamicObject.TryGetMember%2A> method returns a Boolean value that returns `true` if the requested member exists; otherwise it returns `false`.</span></span>

    [!code-csharp[VbDynamicWalkthrough#6](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#6)]
    [!code-vb[VbDynamicWalkthrough#6](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#6)]

1. <span data-ttu-id="dc2f2-164">После метода `TryGetMember` добавьте следующий код, чтобы переопределить метод <xref:System.Dynamic.DynamicObject.TryInvokeMember%2A> класса <xref:System.Dynamic.DynamicObject>.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-164">After the `TryGetMember` method, add the following code to override the <xref:System.Dynamic.DynamicObject.TryInvokeMember%2A> method of the <xref:System.Dynamic.DynamicObject> class.</span></span> <span data-ttu-id="dc2f2-165">Метод <xref:System.Dynamic.DynamicObject.TryInvokeMember%2A> вызывается при запросе члена динамического класса с аргументами.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-165">The <xref:System.Dynamic.DynamicObject.TryInvokeMember%2A> method is called when a member of a dynamic class is requested with arguments.</span></span> <span data-ttu-id="dc2f2-166">Аргумент `binder` содержит сведения об элементе, на который дается ссылка, а аргумент `result` ссылается на результат, возвращенный для указанного элемента.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-166">The `binder` argument contains information about the referenced member, and the `result` argument references the result returned for the specified member.</span></span> <span data-ttu-id="dc2f2-167">Аргумент `args` содержит массив аргументов, передаваемых в элемент.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-167">The `args` argument contains an array of the arguments that are passed to the member.</span></span> <span data-ttu-id="dc2f2-168">Метод <xref:System.Dynamic.DynamicObject.TryInvokeMember%2A> возвращает логическое значение `true`, если запрошенный элемент существует. В противном случае возвращается `false`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-168">The <xref:System.Dynamic.DynamicObject.TryInvokeMember%2A> method returns a Boolean value that returns `true` if the requested member exists; otherwise it returns `false`.</span></span>

    <span data-ttu-id="dc2f2-169">Пользовательская версия метода `TryInvokeMember` ожидает, что первый аргумент будет значением из перечисления `StringSearchOption`, заданного на предыдущем шаге.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-169">The custom version of the `TryInvokeMember` method expects the first argument to be a value from the `StringSearchOption` enum that you defined in a previous step.</span></span> <span data-ttu-id="dc2f2-170">Метод `TryInvokeMember` ожидает, что второй аргумент будет логическим значением.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-170">The `TryInvokeMember` method expects the second argument to be a Boolean value.</span></span> <span data-ttu-id="dc2f2-171">Если один или оба элемента имеют допустимые значения, они передаются в метод `GetPropertyValue` для получения результатов.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-171">If one or both arguments are valid values, they are passed to the `GetPropertyValue` method to retrieve the results.</span></span>

    [!code-csharp[VbDynamicWalkthrough#7](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/readonlyfile.cs#7)]
    [!code-vb[VbDynamicWalkthrough#7](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/readonlyfile.vb#7)]

1. <span data-ttu-id="dc2f2-172">Сохраните и закройте файл.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-172">Save and close the file.</span></span>

### <a name="to-create-a-sample-text-file"></a><span data-ttu-id="dc2f2-173">Создание примера текстового файла</span><span class="sxs-lookup"><span data-stu-id="dc2f2-173">To create a sample text file</span></span>

1. <span data-ttu-id="dc2f2-174">В **обозревателе решений** щелкните проект DynamicSample правой кнопкой мыши и выберите **Добавить** > **Новый элемент**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-174">In **Solution Explorer**, right-click the DynamicSample project and select **Add** > **New Item**.</span></span> <span data-ttu-id="dc2f2-175">На панели **Установленные шаблоны** выберите **Общие**, а затем шаблон **Текстовый файл**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-175">In the **Installed Templates** pane, select **General**, and then select the **Text File** template.</span></span> <span data-ttu-id="dc2f2-176">В поле **Имя** оставьте имя по умолчанию *TextFile1.txt* и нажмите кнопку **Добавить**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-176">Leave the default name of *TextFile1.txt* in the **Name** box, and then click **Add**.</span></span> <span data-ttu-id="dc2f2-177">В проект добавится новый текстовый файл.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-177">A new text file is added to the project.</span></span>

1. <span data-ttu-id="dc2f2-178">Скопируйте в файл *TextFile1.txt* следующий текст.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-178">Copy the following text to the *TextFile1.txt* file.</span></span>

    ```text
    List of customers and suppliers

    Supplier: Lucerne Publishing (https://www.lucernepublishing.com/)
    Customer: Preston, Chris
    Customer: Hines, Patrick
    Customer: Cameron, Maria
    Supplier: Graphic Design Institute (https://www.graphicdesigninstitute.com/)
    Supplier: Fabrikam, Inc. (https://www.fabrikam.com/)
    Customer: Seubert, Roxanne
    Supplier: Proseware, Inc. (http://www.proseware.com/)
    Customer: Adolphi, Stephan
    Customer: Koch, Paul
    ```

1. <span data-ttu-id="dc2f2-179">Сохраните и закройте файл.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-179">Save and close the file.</span></span>

### <a name="to-create-a-sample-application-that-uses-the-custom-dynamic-object"></a><span data-ttu-id="dc2f2-180">Создание примера приложения, в котором применяется пользовательский динамический объект</span><span class="sxs-lookup"><span data-stu-id="dc2f2-180">To create a sample application that uses the custom dynamic object</span></span>

1. <span data-ttu-id="dc2f2-181">В **обозревателе решений** дважды щелкните файл *Program.vb*, если используется Visual Basic, или файл *Program.cs*, если используется Visual C#.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-181">In **Solution Explorer**, double-click the *Program.vb* file if you're using Visual Basic or the *Program.cs* file if you're using Visual C#.</span></span>

2. <span data-ttu-id="dc2f2-182">Добавьте следующий код в процедуру `Main`, чтобы создать экземпляр класса `ReadOnlyFile` для файла *TextFile1.txt*.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-182">Add the following code to the `Main` procedure to create an instance of the `ReadOnlyFile` class for the *TextFile1.txt* file.</span></span> <span data-ttu-id="dc2f2-183">В этом коде используется позднее связывание для вызова динамических элементов и извлечения строк текста, которые содержат строку "Customer".</span><span class="sxs-lookup"><span data-stu-id="dc2f2-183">The code uses late binding to call dynamic members and retrieve lines of text that contain the string "Customer".</span></span>

     [!code-csharp[VbDynamicWalkthrough#8](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthrough/cs/program.cs#8)]
     [!code-vb[VbDynamicWalkthrough#8](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthrough/vb/Program.vb#8)]

3. <span data-ttu-id="dc2f2-184">Сохраните файл и нажмите клавиши <kbd>CTRL</kdb>+<kbd>F5</kbd> для сборки и запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-184">Save the file and press <kbd>Ctrl</kdb>+<kbd>F5</kbd> to build and run the application.</span></span>

## <a name="call-a-dynamic-language-library"></a><span data-ttu-id="dc2f2-185">Вызов библиотеки динамического языка</span><span class="sxs-lookup"><span data-stu-id="dc2f2-185">Call a dynamic language library</span></span>

<span data-ttu-id="dc2f2-186">В следующем пошаговом руководстве создается проект, который осуществляет доступ к библиотеке, написанной на динамическом языке IronPython.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-186">The following walkthrough creates a project that accesses a library that is written in the dynamic language IronPython.</span></span>

### <a name="to-create-a-custom-dynamic-class"></a><span data-ttu-id="dc2f2-187">Создание пользовательского динамического класса</span><span class="sxs-lookup"><span data-stu-id="dc2f2-187">To create a custom dynamic class</span></span>

1. <span data-ttu-id="dc2f2-188">В Visual Studio выберите **Файл** > **Создать** > **Проект**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-188">In Visual Studio, select **File** > **New** > **Project**.</span></span>

1. <span data-ttu-id="dc2f2-189">В диалоговом окне **Создание нового проекта** выберите C# или Visual Basic, выберите **Консольное приложение**, а затем нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-189">In the **Create a new project** dialog, select C# or Visual Basic, select **Console Application**, and then select **Next**.</span></span>

1. <span data-ttu-id="dc2f2-190">В диалоговом окне **Настройка нового проекта** введите значение `DynamicIronPythonSample` для параметра **Имя проекта** и нажмите кнопку **Далее**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-190">In the **Configure your new project** dialog, enter `DynamicIronPythonSample` for the **Project name**, and then select **Next**.</span></span>

1. <span data-ttu-id="dc2f2-191">В диалоговом окне **Дополнительные сведения** выберите значение **.NET 5.0 (текущая)** для параметра **Целевая платформа**, а затем нажмите кнопку **Создать**.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-191">In the **Additional information** dialog, select **.NET 5.0 (Current)** for the **Target Framework**, and then select **Create**.</span></span>

   <span data-ttu-id="dc2f2-192">Создается новый проект.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-192">The new project is created.</span></span>

1. <span data-ttu-id="dc2f2-193">Установите пакет NuGet [IronPython](https://www.nuget.org/packages/IronPython).</span><span class="sxs-lookup"><span data-stu-id="dc2f2-193">Install the [IronPython](https://www.nuget.org/packages/IronPython) NuGet package.</span></span>

1. <span data-ttu-id="dc2f2-194">Если вы используете Visual Basic, отредактируйте файл *Program.vb*.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-194">If you're using Visual Basic, edit the *Program.vb* file.</span></span> <span data-ttu-id="dc2f2-195">Если вы используете Visual C#, отредактируйте файл *Program.cs*.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-195">If you're using Visual C#, edit the *Program.cs* file.</span></span>

1. <span data-ttu-id="dc2f2-196">В верхней части файла добавьте следующий код для импорта пространств имен `Microsoft.Scripting.Hosting` и `IronPython.Hosting` из библиотек IronPython и пространства имен `System.Linq`.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-196">At the top of the file, add the following code to import the `Microsoft.Scripting.Hosting` and `IronPython.Hosting` namespaces from the IronPython libraries and the `System.Linq` namespace.</span></span>

    [!code-csharp[VbDynamicWalkthroughIronPython#1](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthroughironpython/cs/program.cs#1)]
    [!code-vb[VbDynamicWalkthroughIronPython#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthroughironpython/vb/Program.vb#1)]

1. <span data-ttu-id="dc2f2-197">В методе Main добавьте следующий код, чтобы создать объект `Microsoft.Scripting.Hosting.ScriptRuntime`, в котором будут размещены библиотеки IronPython.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-197">In the Main method, add the following code to create a new `Microsoft.Scripting.Hosting.ScriptRuntime` object to host the IronPython libraries.</span></span> <span data-ttu-id="dc2f2-198">Объект `ScriptRuntime` загружает модуль библиотеки IronPython random.py.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-198">The `ScriptRuntime` object loads the IronPython library module random.py.</span></span>

     [!code-csharp[VbDynamicWalkthroughIronPython#2](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthroughironpython/cs/program.cs#2)]
     [!code-vb[VbDynamicWalkthroughIronPython#2](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthroughironpython/vb/Program.vb#2)]

1. <span data-ttu-id="dc2f2-199">После указания в коде необходимости загрузки модуля random.py добавьте следующий код, чтобы создать массив целых чисел.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-199">After the code to load the random.py module, add the following code to create an array of integers.</span></span> <span data-ttu-id="dc2f2-200">Массив передается методу `shuffle` модуля random.py, который произвольно сортирует значения в массиве.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-200">The array is passed to the `shuffle` method of the random.py module, which randomly sorts the values in the array.</span></span>

     [!code-csharp[VbDynamicWalkthroughIronPython#3](~/samples/snippets/csharp/VS_Snippets_VBCSharp/vbdynamicwalkthroughironpython/cs/program.cs#3)]
     [!code-vb[VbDynamicWalkthroughIronPython#3](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/vbdynamicwalkthroughironpython/vb/Program.vb#3)]

1. <span data-ttu-id="dc2f2-201">Сохраните файл и нажмите клавиши <kbd>CTRL</kdb>+<kbd>F5</kbd> для сборки и запуска приложения.</span><span class="sxs-lookup"><span data-stu-id="dc2f2-201">Save the file and press <kbd>Ctrl</kdb>+<kbd>F5</kbd> to build and run the application.</span></span>

## <a name="see-also"></a><span data-ttu-id="dc2f2-202">См. также</span><span class="sxs-lookup"><span data-stu-id="dc2f2-202">See also</span></span>

- <xref:System.Dynamic?displayProperty=nameWithType>
- <xref:System.Dynamic.DynamicObject?displayProperty=nameWithType>
- [<span data-ttu-id="dc2f2-203">Использование типа dynamic</span><span class="sxs-lookup"><span data-stu-id="dc2f2-203">Using Type dynamic</span></span>](./using-type-dynamic.md)
- [<span data-ttu-id="dc2f2-204">Раннее и позднее связывание</span><span class="sxs-lookup"><span data-stu-id="dc2f2-204">Early and Late Binding</span></span>](../../../visual-basic/programming-guide/language-features/early-late-binding/index.md)
- [<span data-ttu-id="dc2f2-205">dynamic</span><span class="sxs-lookup"><span data-stu-id="dc2f2-205">dynamic</span></span>](../../language-reference/builtin-types/reference-types.md)
- [<span data-ttu-id="dc2f2-206">Реализация динамических интерфейсов (документ в формате PDF на сайте Microsoft TechNet)</span><span class="sxs-lookup"><span data-stu-id="dc2f2-206">Implementing Dynamic Interfaces (downloadable PDF from Microsoft TechNet)</span></span>](https://download.microsoft.com/download/5/4/B/54B83DFE-D7AA-4155-9687-B0CF58FF65D7/implementing-dynamic-interfaces.pdf)
